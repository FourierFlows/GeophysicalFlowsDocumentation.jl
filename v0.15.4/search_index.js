var documenterSearchIndex = {"docs":
[{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"EditURL = \"../../../examples/twodnavierstokes_decaying.jl\"","category":"page"},{"location":"literated/twodnavierstokes_decaying/#twodnavierstokes_decaying_example","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"A simulation of decaying two-dimensional turbulence closely following the paper by McWilliams (1984).","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Install-dependencies","page":"2D decaying turbulence","title":"Install dependencies","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"using Pkg\npkg\"add GeophysicalFlows, CairoMakie\"","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Let's-begin","page":"2D decaying turbulence","title":"Let's begin","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"using GeophysicalFlows, Printf, Random, CairoMakie\n\nusing Random: seed!\nusing GeophysicalFlows: peakedisotropicspectrum","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Choosing-a-device:-CPU-or-GPU","page":"2D decaying turbulence","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Numerical,-domain,-and-simulation-parameters","page":"2D decaying turbulence","title":"Numerical, domain, and simulation parameters","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"First, we pick some numerical and physical parameters for our model.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"n, L  = 128, 2π             # grid resolution and domain length","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"Then we pick the time-stepper parameters","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"    dt = 1e-2  # timestep\nnsteps = 4000  # total number of steps\n nsubs = 20    # number of steps between each plot","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Problem-setup","page":"2D decaying turbulence","title":"Problem setup","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"We initialize a Problem by providing a set of keyword arguments. We use stepper = \"FilteredRK4\". Filtered timesteppers apply a wavenumber-filter at every time-step that removes enstrophy at high wavenumbers and, thereby, stabilize the problem, despite that we use the default viscosity coefficient ν=0.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"prob = TwoDNavierStokes.Problem(dev; nx=n, Lx=L, ny=n, Ly=L, dt, stepper=\"FilteredRK4\")","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"Next we define some shortcuts for convenience.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"sol, clock, vars, grid = prob.sol, prob.clock, prob.vars, prob.grid\nx,  y  = grid.x,  grid.y\nLx, Ly = grid.Lx, grid.Ly","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Setting-initial-conditions","page":"2D decaying turbulence","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"Our initial condition tries to reproduce the initial condition used by McWilliams (1984).","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"seed!(1234)\nk₀, E₀ = 6, 0.5\nζ₀ = peakedisotropicspectrum(grid, k₀, E₀, mask=prob.timestepper.filter)\nTwoDNavierStokes.set_ζ!(prob, ζ₀)","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"Let's plot the initial vorticity field. Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when vars live on the GPU.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"fig = Figure()\nax = Axis(fig[1, 1];\n          xlabel = \"x\",\n          ylabel = \"y\",\n          title = \"initial vorticity\",\n          aspect = 1,\n          limits = ((-L/2, L/2), (-L/2, L/2)))\n\nheatmap!(ax, x, y, Array(vars.ζ');\n         colormap = :balance, colorrange = (-40, 40))\n\nfig","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Diagnostics","page":"2D decaying turbulence","title":"Diagnostics","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"Create Diagnostics – energy and enstrophy functions are imported at the top.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"E = Diagnostic(TwoDNavierStokes.energy, prob; nsteps)\nZ = Diagnostic(TwoDNavierStokes.enstrophy, prob; nsteps)\ndiags = [E, Z] # A list of Diagnostics types passed to \"stepforward!\" will  be updated every timestep.","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Output","page":"2D decaying turbulence","title":"Output","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"We choose folder for outputing .jld2 files and snapshots (.png files).","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"filepath = \".\"\nplotpath = \"./plots_decayingTwoDNavierStokes\"\nplotname = \"snapshots\"\nfilename = joinpath(filepath, \"decayingTwoDNavierStokes.jld2\")","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"Do some basic file management","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"if isfile(filename); rm(filename); end\nif !isdir(plotpath); mkdir(plotpath); end","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"And then create Output","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"get_sol(prob) = prob.sol # extracts the Fourier-transformed solution\nget_u(prob) = irfft(im * prob.grid.l .* prob.grid.invKrsq .* prob.sol, prob.grid.nx)\n\nout = Output(prob, filename, (:sol, get_sol), (:u, get_u))\nsaveproblem(out)","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Visualizing-the-simulation","page":"2D decaying turbulence","title":"Visualizing the simulation","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"We initialize a plot with the vorticity field and the time-series of energy and enstrophy diagnostics.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"ζ = Observable(Array(vars.ζ))\ntitle_ζ = Observable(\"vorticity, t=\" * @sprintf(\"%.2f\", clock.t))\n\nenergy = Observable(Point2f[(E.t[1], E.data[1] / E.data[1])])\nenstrophy = Observable(Point2f[(Z.t[1], Z.data[1] / Z.data[1])])\n\nfig = Figure(resolution = (800, 360))\n\naxζ = Axis(fig[1, 1];\n           xlabel = \"x\",\n           ylabel = \"y\",\n           title = title_ζ,\n           aspect = 1,\n           limits = ((-L/2, L/2), (-L/2, L/2)))\n\nax2 = Axis(fig[1, 2],\n           xlabel = \"t\",\n           limits = ((-0.5, 40.5), (0, 1.05)))\n\nheatmap!(axζ, x, y, ζ;\n         colormap = :balance, colorrange = (-40, 40))\n\nhE = lines!(ax2, energy; linewidth = 3)\nhZ = lines!(ax2, enstrophy; linewidth = 3, color = :red)\nLegend(fig[1, 3], [hE, hZ], [\"E(t)/E(0)\", \"Z(t)/Z(0)\"])\n\nfig","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Time-stepping-the-Problem-forward","page":"2D decaying turbulence","title":"Time-stepping the Problem forward","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"We time-step the Problem forward in time.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"startwalltime = time()\n\nrecord(fig, \"twodturb.mp4\", 0:Int(nsteps/nsubs), framerate = 18) do j\n  if j % (1000 / nsubs) == 0\n    cfl = clock.dt * maximum([maximum(vars.u) / grid.dx, maximum(vars.v) / grid.dy])\n\n    log = @sprintf(\"step: %04d, t: %d, cfl: %.2f, ΔE: %.4f, ΔZ: %.4f, walltime: %.2f min\",\n        clock.step, clock.t, cfl, E.data[E.i]/E.data[1], Z.data[Z.i]/Z.data[1], (time()-startwalltime)/60)\n\n    println(log)\n  end\n\n  ζ[] = vars.ζ\n\n  energy[] = push!(energy[], Point2f(E.t[E.i], E.data[E.i] / E.data[1]))\n  enstrophy[] = push!(enstrophy[], Point2f(Z.t[E.i], Z.data[Z.i] / Z.data[1]))\n\n  title_ζ[] = \"vorticity, t=\" * @sprintf(\"%.2f\", clock.t)\n\n  stepforward!(prob, diags, nsubs)\n  TwoDNavierStokes.updatevars!(prob)\nend","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"step: 0000, t: 0, cfl: 0.53, ΔE: 1.0000, ΔZ: 1.0000, walltime: 0.02 min\nstep: 1000, t: 10, cfl: 0.44, ΔE: 0.9633, ΔZ: 0.1954, walltime: 0.08 min\nstep: 2000, t: 20, cfl: 0.60, ΔE: 0.9593, ΔZ: 0.1088, walltime: 0.11 min\nstep: 3000, t: 30, cfl: 0.55, ΔE: 0.9577, ΔZ: 0.0762, walltime: 0.15 min\nstep: 4000, t: 40, cfl: 0.49, ΔE: 0.9571, ΔZ: 0.0627, walltime: 0.19 min\n","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_decaying/#Radial-energy-spectrum","page":"2D decaying turbulence","title":"Radial energy spectrum","text":"","category":"section"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"After the simulation is done we plot the instantaneous radial energy spectrum to illustrate how FourierFlows.radialspectrum can be used,","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"E  = @. 0.5 * (vars.u^2 + vars.v^2)  # energy density\nEh = rfft(E)                         # Fourier transform of energy density\n\n# compute radial specturm of `Eh`\nkr, Ehr = FourierFlows.radialspectrum(Eh, grid, refinement = 1)","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"and we plot it.","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"lines(kr, vec(abs.(Ehr));\n      linewidth = 2,\n      axis = (xlabel = L\"k_r\",\n              ylabel = L\"\\int |\\hat{E}| k_r \\mathrm{d}k_\\theta\",\n              xscale = log10,\n              yscale = log10,\n              title = \"Radial energy spectrum\",\n              limits = ((0.3, 1e2), (1e0, 1e5))))","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"","category":"page"},{"location":"literated/twodnavierstokes_decaying/","page":"2D decaying turbulence","title":"2D decaying turbulence","text":"This page was generated using Literate.jl.","category":"page"},{"location":"references/#References","page":"References","title":"References","text":"","category":"section"},{"location":"references/","page":"References","title":"References","text":"Capet, X.; Klein, P.; Hua, B. L.; Lapeyre, G. and Mcwilliams, J. C. (2008). Surface kinetic energy transfer in surface quasi-geostrophic flows. Journal of Fluid Mechanics 604, 165–174.\n\n\n\nConstantinou, N. C. (2015). Formation of large-scale structures by turbulence in rotating planets. Ph.D. Thesis, National and Kapodistrian University of Athens (Athens) (also available at arXiv:1503.07644).\n\n\n\nConstantinou, N. C.; Farrell, B. F. and Ioannou, P. J. (2014). Emergence and equilibration of jets in beta-plane turbulence: applications of Stochastic Structural Stability Theory. Journal of the Atmospheric Sciences 71, 1818–1842.\n\n\n\nFarrell, B. F. and Ioannou, P. J. (2003). Structural stability of turbulent jets. Journal of the Atmospheric Sciences 60, 2101–2118.\n\n\n\nHeld, I. M.; Pierrehumbert, R. T.; Garner, S. T. and Swanson, K. L. (1995). Surface quasi-geostrophic dynamics. Journal of Fluid Mechanics 282, 1–20.\n\n\n\nMcWilliams, J. C. (1984). The emergence of isolated coherent vortices in turbulent flow. Journal of Fluid Mechanics 146, 21–43.\n\n\n\nSrinivasan, K. and Young, W. R. (2012). Zonostrophic instability. Journal of the Atmospheric Sciences 69, 1633–1656.\n\n\n\nVan Kampen, N. G. (1981). Itô versus Stratonovich. Journal of Statistical Physics 24, 175–187.\n\n\n\n","category":"page"},{"location":"modules/multilayerqg/#MultiLayerQG","page":"MultiLayerQG","title":"MultiLayerQG","text":"","category":"section"},{"location":"modules/multilayerqg/#Basic-Equations","page":"MultiLayerQG","title":"Basic Equations","text":"","category":"section"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"This module solves the layered quasi-geostrophic equations on a beta plane of variable fluid  depth H - h(x y). The flow in each layer is obtained through a streamfunction psi_j as  (u_j v_j) = (-partial_y psi_j partial_x psi_j), j = 1 dots n, where n  is the number of fluid layers.","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"The QGPV in each layer is","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"mathrmQGPV_j = q_j + underbracef_0 + beta y_textrmplanetary PV + delta_j n underbracefracf_0 hH_n_textrmtopographic PV quad j = 1 dots n ","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"where q_j incorporates the relative vorticity in each layer nabla^2 psi_j and the  vortex stretching terms:","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"beginaligned\nq_1 = nabla^2 psi_1 + F_32 1 (psi_2 - psi_1) \nq_j = nabla^2 psi_j + F_j-12 j (psi_j-1 - psi_j) + F_j+12 j (psi_j+1 - psi_j)  quad j = 2 dots n-1 \nq_n = nabla^2 psi_n + F_n-12 n (psi_n-1 - psi_n) \nendaligned","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"with","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"F_j+12 k = fracf_0^2g_j+12 H_k quad textand quad\ng_j+12 = g fracrho_j+1 - rho_jrho_j+1 ","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"In view of the relationships above, when we convert to Fourier space q's and psi's are  related via the matrix equation","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"beginpmatrix widehatq_𝐤 1vdotswidehatq_𝐤 n endpmatrix =\nunderbraceleft(-𝐤^2 mathbb1 + mathbbF right)_equiv mathbbS_𝐤\nbeginpmatrix widehatpsi_𝐤 1vdotswidehatpsi_𝐤 n endpmatrix","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"where","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"mathbbF equiv beginpmatrix\n -F_32 1               F_32 1     0     cdots     0\n  F_32 2  -(F_32 2+F_52 2)  F_52 2         vdots\n 0                             ddots     ddots    ddots  \n vdots                                                      0 \n 0                  cdots                0    F_n-12 n  -F_n-12 n\nendpmatrix ","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"Including an imposed zonal flow U_j(y) in each layer, the equations of motion are:","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"partial_t q_j + mathsfJ(psi_j q_j ) + (U_j - partial_ypsi_j) partial_x Q_j +  U_j partial_x q_j  + (partial_y Q_j)(partial_x psi_j) = -delta_j n mu nabla^2 psi_n - nu (-1)^n_nu nabla^2 n_nu q_j ","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"with","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"beginaligned\npartial_y Q_j equiv beta - partial_y^2 U_j - (1-delta_j1) F_j-12 j (U_j-1 - U_j) - (1 - delta_jn) F_j+12 j (U_j+1 - U_j) + delta_jn partial_y eta  \npartial_x Q_j equiv delta_j n partial_x eta \nendaligned","category":"page"},{"location":"modules/multilayerqg/#Implementation","page":"MultiLayerQG","title":"Implementation","text":"","category":"section"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"Matrices mathbbS_𝐤 as well as mathbbS^-1_𝐤 are included in params as  params.S and params.S⁻¹ respectively. Additionally, the background PV gradients  partial_x Q and partial_y Q are also included in the params as params.Qx and  params.Qy.","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"One can get the widehatpsi_j from widehatq_j via  streamfunctionfrompv!(psih, qh, params, grid), while the inverse, i.e. obtain widehatq_j from widehatpsi_j, is done via  pvfromstreamfunction!(qh, psih, params, grid).","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"The equations of motion are time-stepped forward in Fourier space:","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"partial_t widehatq_j = - widehatmathsfJ(psi_j q_j)  - widehatU_j partial_x Q_j - widehatU_j partial_x q_j\n+ widehat(partial_y psi_j) partial_x Q_j  - widehat(partial_x psi_j)(partial_y Q_j) + delta_j n mu 𝐤^2 widehatpsi_n - nu 𝐤^2n_nu widehatq_j ","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"In doing so the Jacobian is computed in the conservative form: mathsfJ(fg) = partial_y  (partial_x f) g - partial_x (partial_y f) g.","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"The state variable sol consists of the Fourier transforms of q_j at each layer, i.e.,  qh.","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"The linear operator is constructed in Equation","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"GeophysicalFlows.MultiLayerQG.Equation\nGeophysicalFlows.MultiLayerQG.hyperviscosity","category":"page"},{"location":"modules/multilayerqg/#GeophysicalFlows.MultiLayerQG.Equation","page":"MultiLayerQG","title":"GeophysicalFlows.MultiLayerQG.Equation","text":"Equation(params, grid)\n\nReturn the equation for a multi-layer quasi-geostrophic problem with params and grid. The linear opeartor L includes only (hyper)-viscosity and is computed via hyperviscosity(params, grid).\n\nThe nonlinear term is computed via function calcN!.\n\n\n\n\n\n","category":"function"},{"location":"modules/multilayerqg/#GeophysicalFlows.MultiLayerQG.hyperviscosity","page":"MultiLayerQG","title":"GeophysicalFlows.MultiLayerQG.hyperviscosity","text":"hyperviscosity(params, grid)\n\nReturn the linear operator L that corresponds to (hyper)-viscosity of order n_ν with coefficient ν for n fluid layers.\n\nL_j = - ν 𝐤^2 n_ν  j = 1 n \n\n\n\n\n\n","category":"function"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"The nonlinear terms are computed via","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"GeophysicalFlows.MultiLayerQG.calcN!","category":"page"},{"location":"modules/multilayerqg/#GeophysicalFlows.MultiLayerQG.calcN!","page":"MultiLayerQG","title":"GeophysicalFlows.MultiLayerQG.calcN!","text":"calcN!(N, sol, t, clock, vars, params, grid)\n\nCompute the nonlinear term, that is the advection term, the bottom drag, and the forcing:\n\nN_j = - widehat𝖩(ψ_j q_j) - widehatU_j _x Q_j - widehatU_j _x q_j\n + widehat(_y ψ_j)(_x Q_j) - widehat(_x ψ_j)(_y Q_j) + δ_j n μ 𝐤^2 ψ_n + F_j \n\n\n\n\n\n","category":"function"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"which in turn calls calcN_advection!  and addforcing!.","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"tip: Linearized MultiLayerQG dynamics\nThe MultiLayerQG module includes also a linearized version of the dynamics about a base flow U_j(y), j = 1 dots n; see LinearEquation,  calcNlinear!, and  calcN_linearadvection!.","category":"page"},{"location":"modules/multilayerqg/#Parameters-and-Variables","page":"MultiLayerQG","title":"Parameters and Variables","text":"","category":"section"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"All required parameters are included inside Params and all module variables are included inside Vars.","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"For the decaying case (no forcing, F=0), vars can be constructed with DecayingVars.  For the forced case (F ne 0) the vars struct is with ForcedVars or StochasticForcedVars.","category":"page"},{"location":"modules/multilayerqg/#Helper-functions","page":"MultiLayerQG","title":"Helper functions","text":"","category":"section"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"GeophysicalFlows.MultiLayerQG.set_q!\nGeophysicalFlows.MultiLayerQG.set_ψ!\nGeophysicalFlows.MultiLayerQG.updatevars!","category":"page"},{"location":"modules/multilayerqg/#GeophysicalFlows.MultiLayerQG.set_q!","page":"MultiLayerQG","title":"GeophysicalFlows.MultiLayerQG.set_q!","text":"set_q!(sol, params, vars, grid, q)\nset_q!(prob, q)\n\nSet the solution prob.sol as the transform of q and update variables.\n\n\n\n\n\n","category":"function"},{"location":"modules/multilayerqg/#GeophysicalFlows.MultiLayerQG.set_ψ!","page":"MultiLayerQG","title":"GeophysicalFlows.MultiLayerQG.set_ψ!","text":"set_ψ!(params, vars, grid, sol, ψ)\nset_ψ!(prob, ψ)\n\nSet the solution prob.sol to the transform qh that corresponds to streamfunction ψ and update variables.\n\n\n\n\n\n","category":"function"},{"location":"modules/multilayerqg/#GeophysicalFlows.MultiLayerQG.updatevars!","page":"MultiLayerQG","title":"GeophysicalFlows.MultiLayerQG.updatevars!","text":"updatevars!(vars, params, grid, sol)\nupdatevars!(prob)\n\nUpdate all problem variables using sol.\n\n\n\n\n\n","category":"function"},{"location":"modules/multilayerqg/#Diagnostics","page":"MultiLayerQG","title":"Diagnostics","text":"","category":"section"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"The eddy kinetic energy in each layer and the eddy potential energy that corresponds to each  fluid interface is computed via energies:","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"GeophysicalFlows.MultiLayerQG.energies","category":"page"},{"location":"modules/multilayerqg/#GeophysicalFlows.MultiLayerQG.energies","page":"MultiLayerQG","title":"GeophysicalFlows.MultiLayerQG.energies","text":"energies(vars, params, grid, sol)\nenergies(prob)\n\nReturn the kinetic energy of each fluid layer KE_1  KE_n, and the potential energy of each fluid interface PE_32  PE_n-12, where n is the number of layers in the fluid. (When n=1, only the kinetic energy is returned.)\n\nThe kinetic energy at the j-th fluid layer is\n\n𝖪𝖤_j = fracH_jH int frac12 bf  ψ_j^2 frac𝖽x 𝖽yL_x L_y = frac12 fracH_jH sum_𝐤 𝐤² ψ_j²  j = 1  n \n\nwhile the potential energy that corresponds to the interface j+12 (i.e., the interface between the j-th and (j+1)-th fluid layer) is\n\n𝖯𝖤_j+12 = int frac12 fracf₀^2g_j+12 H (ψ_j - ψ_j+1)^2 frac𝖽x 𝖽yL_x L_y = frac12 fracf₀^2g_j+12 H sum_𝐤 ψ_j - ψ_j+1²  j = 1  n-1 \n\n\n\n\n\n","category":"function"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"The lateral eddy fluxes in each layer and the vertical fluxes across fluid interfaces are computed via fluxes:","category":"page"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"GeophysicalFlows.MultiLayerQG.fluxes","category":"page"},{"location":"modules/multilayerqg/#GeophysicalFlows.MultiLayerQG.fluxes","page":"MultiLayerQG","title":"GeophysicalFlows.MultiLayerQG.fluxes","text":"fluxes(vars, params, grid, sol)\nfluxes(prob)\n\nReturn the lateral eddy fluxes within each fluid layer, lateralfluxes_1lateralfluxes_n and also the vertical eddy fluxes at each fluid interface, verticalfluxes_32verticalfluxes_n-12, where n is the total number of layers in the fluid. (When n=1, only the lateral fluxes are returned.)\n\nThe lateral eddy fluxes within the j-th fluid layer are\n\ntextrmlateralfluxes_j = fracH_jH int U_j v_j _y u_j\nfrac𝖽x 𝖽yL_x L_y    j = 1  n \n\nwhile the vertical eddy fluxes at the j+12-th fluid interface (i.e., interface between the j-th and (j+1)-th fluid layer) are\n\ntextrmverticalfluxes_j+12 = int fracf₀²g_j+12 H (U_j - U_j+1) \nv_j+1 ψ_j frac𝖽x 𝖽yL_x L_y   j = 1  n-1\n\n\n\n\n\n","category":"function"},{"location":"modules/multilayerqg/#Examples","page":"MultiLayerQG","title":"Examples","text":"","category":"section"},{"location":"modules/multilayerqg/","page":"MultiLayerQG","title":"MultiLayerQG","text":"examples/multilayerqg_2layer.jl: Simulate the growth and equilibration of baroclinic eddy turbulence in the Phillips 2-layer model.","category":"page"},{"location":"modules/surfaceqg/#SurfaceQG","page":"SurfaceQG","title":"SurfaceQG","text":"","category":"section"},{"location":"modules/surfaceqg/#Basic-Equations","page":"SurfaceQG","title":"Basic Equations","text":"","category":"section"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"This module solves the non-dimensional surface quasi-geostrophic (SQG) equation for surface  buoyancy b_s = b(x y z=0), as described by Capet et al. (2008). The buoyancy and the fluid  velocity at the surface are related through a streamfunction psi via:","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"(u_s v_s b_s) = (-partial_y psi partial_x psi -partial_z psi) ","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"The SQG model evolves the surface buoyancy,","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"partial_t b_s + mathsfJ(psi b_s) = underbrace-nu(-1)^n_nu nabla^2n_nu b_s_textrmbuoyancy diffusion + underbraceF_textrmforcing ","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"Above, mathsfJ(psi b) = (partial_x psi)(partial_y b) - (partial_y psi)(partial_x b)  is the two-dimensional Jacobian. The evolution of buoyancy is only solved for the surface  layer, but b_s is a function of the vertical gradient of psi. In the SQG system, the  potential vorticity in the interior of the flow is identically zero. That is, relative vorticity  is equal and opposite to the vertical stretching of the buoyancy layers,","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"underbraceleft(partial_x^2 + partial_y^2 right) psi_textrmrelative vorticity + underbracepartial_z^2 psi_textrmstretching term = 0 ","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"with the boundary conditions b_s = - partial_z psi_z=0 and psi rightarrow 0 as z rightarrow -infty. (We take here the oceanographic convention: z le 0.)","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"These equations describe a system where the streamfunction (and hence the dynamics) at all depths is prescribed entirely by the surface buoyancy. By taking the Fourier transform in the horizontal (x and y), the streamfunction-buoyancy relation is:","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"widehatpsi(k_x k_y z t) = - fracwidehatb_s𝐤  e^𝐤z  ","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"where 𝐤 = sqrtk_x^2 + k_y^2 is the total horizontal wavenumber.","category":"page"},{"location":"modules/surfaceqg/#Implementation","page":"SurfaceQG","title":"Implementation","text":"","category":"section"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"The buoyancy equation is time-stepped forward in Fourier space:","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"partial_t widehatb_s = - widehatmathsfJ(psi b_s) - nu 𝐤^2 n_nu widehatb_s + widehatF ","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"The surface buoyancy is b. The state variable  sol is the Fourier transform of the surface buoyancy, bh.","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"The Jacobian is computed in the conservative form: mathsfJ(f g) = partial_y  (partial_x f) g -partial_x (partial_y f) g.","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"The linear operator is constructed in Equation","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"GeophysicalFlows.SurfaceQG.Equation","category":"page"},{"location":"modules/surfaceqg/#GeophysicalFlows.SurfaceQG.Equation","page":"SurfaceQG","title":"GeophysicalFlows.SurfaceQG.Equation","text":"Equation(params, grid)\n\nReturn the equation for surface QG dynamics with params and grid. The linear  opeartor L includes (hyper)-viscosity of order n_ν with coefficient ν,\n\nL = - ν 𝐤^2 n_ν \n\nPlain old viscocity corresponds to n_ν=1.\n\nThe nonlinear term is computed via function calcN!().\n\n\n\n\n\n","category":"function"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"while the nonlinear terms via ","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"GeophysicalFlows.SurfaceQG.calcN!","category":"page"},{"location":"modules/surfaceqg/#GeophysicalFlows.SurfaceQG.calcN!","page":"SurfaceQG","title":"GeophysicalFlows.SurfaceQG.calcN!","text":"calcN!(N, sol, t, clock, vars, params, grid)\n\nCalculate the nonlinear term, that is the advection term and the forcing,\n\nN = - widehat𝖩(ψ b) + F \n\n\n\n\n\n","category":"function"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"which in turn calls calcN_advection!  and addforcing!.","category":"page"},{"location":"modules/surfaceqg/#Parameters-and-Variables","page":"SurfaceQG","title":"Parameters and Variables","text":"","category":"section"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"All required parameters are included inside Params and all module variables are included inside Vars.","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"For the decaying case (no forcing, F = 0), variables are constructed with Vars. For the forced case (F ne 0) variables are constructed with either ForcedVars or StochasticForcedVars.","category":"page"},{"location":"modules/surfaceqg/#Helper-functions","page":"SurfaceQG","title":"Helper functions","text":"","category":"section"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"GeophysicalFlows.SurfaceQG.updatevars!\nGeophysicalFlows.SurfaceQG.set_b!","category":"page"},{"location":"modules/surfaceqg/#GeophysicalFlows.SurfaceQG.updatevars!","page":"SurfaceQG","title":"GeophysicalFlows.SurfaceQG.updatevars!","text":"updatevars!(prob)\n\nUpdate variables in vars with solution in sol.\n\n\n\n\n\n","category":"function"},{"location":"modules/surfaceqg/#GeophysicalFlows.SurfaceQG.set_b!","page":"SurfaceQG","title":"GeophysicalFlows.SurfaceQG.set_b!","text":"set_b!(prob, b)\n\nSet the solution sol as the transform of b and update all variables.\n\n\n\n\n\n","category":"function"},{"location":"modules/surfaceqg/#Diagnostics","page":"SurfaceQG","title":"Diagnostics","text":"","category":"section"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"Some useful diagnostics are kinetic energy and buoyancy variance.","category":"page"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"GeophysicalFlows.SurfaceQG.kinetic_energy\nGeophysicalFlows.SurfaceQG.buoyancy_variance","category":"page"},{"location":"modules/surfaceqg/#GeophysicalFlows.SurfaceQG.kinetic_energy","page":"SurfaceQG","title":"GeophysicalFlows.SurfaceQG.kinetic_energy","text":"kinetic_energy(prob)\n\nReturn the domain-averaged surface kinetic energy. Since u² + v² = bf  ψ², we get\n\nint frac12 bf  ψ² frac𝖽x 𝖽yL_x L_y = sum_𝐤 frac12 𝐤² ψ² \n\nIn SQG, this is identical to half the domain-averaged surface buoyancy variance.\n\n\n\n\n\n","category":"function"},{"location":"modules/surfaceqg/#GeophysicalFlows.SurfaceQG.buoyancy_variance","page":"SurfaceQG","title":"GeophysicalFlows.SurfaceQG.buoyancy_variance","text":"buoyancy_variance(prob)\n\nReturn the buoyancy variance,\n\nint b² frac𝖽x 𝖽yL_x L_y = sum_𝐤 b² \n\nIn SQG, this is identical to the velocity variance (i.e., twice the domain-averaged kinetic  energy).\n\n\n\n\n\n","category":"function"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"Other diagnostic include: buoyancy_dissipation and buoyancy_work.","category":"page"},{"location":"modules/surfaceqg/#Examples","page":"SurfaceQG","title":"Examples","text":"","category":"section"},{"location":"modules/surfaceqg/","page":"SurfaceQG","title":"SurfaceQG","text":"examples/surfaceqg_decaying.jl: Simulate decaying surface quasi-geostrophic flow  with a prescribed initial buoyancy field.","category":"page"},{"location":"contributing/#Contributors'-Guide","page":"Contributor's guide","title":"Contributors' Guide","text":"","category":"section"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"This is a short guide for potential GeophysicalFlows.jl contributors.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"Please feel free to ask us questions and chat, either by raising an issue or starting a discussion.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"We follow the ColPrac guide for collaborative practices.  New contributors should make sure to read that guide.","category":"page"},{"location":"contributing/#What-can-I-do?","page":"Contributor's guide","title":"What can I do?","text":"","category":"section"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"Tackle an existing issue.\nTry to run your favorite GeophysicalFlows.jl module and play around with it to simulate  your favorite setup. If you run into any problems or find it difficult to use, modify, or  understand, please open an issue!\nWrite up an example or tutorial on how to do something useful with one of the current modules in GeophysicalFlows.jl, like how to set up a new physical configuration.\nImprove documentation, docstrings, or comments if you found something is hard to use.\nImplement a new feature (e.g., a new diagnostic into a module).\nImplement a new module from scratch to solve your favorite partial differential equation with periodic boundary conditions.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"If you're interested in working on something, let us know by commenting on an existing issue  or by opening a new issue. This is to make sure no one else is working on the same issue and  so we can help and guide you in case there is anything you need to know beforehand.","category":"page"},{"location":"contributing/#Ground-Rules","page":"Contributor's guide","title":"Ground Rules","text":"","category":"section"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"Each pull request should consist of a logical collection of changes. You can include multiple bug fixes in a single pull request, but they should be related. For unrelated changes, please submit multiple pull requests.\nDo not commit changes to files that are irrelevant to your feature or bugfix (e.g., .gitignore).\nBe willing to accept criticism and work on improving your code; we don't want to break other users' code, so care must be taken not to introduce bugs. We discuss pull requests and keep working on them until we believe we've done a good job.\nBe aware that the pull request review process is not immediate, and is generally proportional to the size of the pull request.","category":"page"},{"location":"contributing/#Reporting-a-bug","page":"Contributor's guide","title":"Reporting a bug","text":"","category":"section"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"The easiest way to get involved is to report issues you encounter when using GeophysicalFlows.jl  or by requesting something you think is missing.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"Head over to the issues page.\nSearch to see if your issue already exists or has even been solved previously.\nIf you indeed have a new issue or request, click the \"New Issue\" button.\nPlease be as specific as possible. Include the version of the code you were using, as well as what operating system you are running. The output of Julia's versioninfo() and ] status is helpful to include. If possible, include complete, minimal example code that reproduces the problem.","category":"page"},{"location":"contributing/#Setting-up-your-development-environment","page":"Contributor's guide","title":"Setting up your development environment","text":"","category":"section"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"Install Julia on your system.\nInstall git on your system if it is not already there (install XCode command line tools on a Mac or git bash on Windows).\nLogin to your GitHub account and make a fork of the GeophysicalFlows.jl repository by clicking the \"Fork\" button.\nClone your fork of the GeophysicalFlows.jl repository (in terminal on Mac/Linux or git shell/ GUI on Windows) in the location you'd like to keep it.\ngit clone https://github.com/your-user-name/GeophysicalFlows.jl.git\nNavigate to that folder in the terminal or in Anaconda Prompt if you're on Windows.\nConnect your repository to the upstream (main project).\ngit remote add geophysicalflows https://github.com/FourierFlows/GeophysicalFlows.jl.git\nCreate the development environment by opening Julia via julia --project then typing in ] instantiate. This will install all the dependencies in the Project.toml file.\nYou can test to make sure GeophysicalFlows.jl works by typing in ] test which will run all the tests (this can take a while). In an ideal world you should run the tests on a machine with a GPU capability but if that's not a possibility that is available to you then don't  worry – simply comment in a PR that you didn't test on GPU.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"Your development environment is now ready!","category":"page"},{"location":"contributing/#Pull-Requests","page":"Contributor's guide","title":"Pull Requests","text":"","category":"section"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"Changes and contributions should be made via GitHub pull requests against the main branch.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"When you're done making changes, commit the changes you made. Chris Beams has written  a guide on how to write good commit messages.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"When you think your changes are ready to be merged into the main repository, push to your fork and submit a pull request.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"Working on your first Pull Request? You can learn how from this free video series How to Contribute to an Open Source Project on GitHub, Aaron Meurer's tutorial on the git workflow,  or the guide “How to Contribute to Open Source\".","category":"page"},{"location":"contributing/#Documentation","page":"Contributor's guide","title":"Documentation","text":"","category":"section"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"All PRs that introduce new features or new modules should be accompanied with appropriate  docstrings and documentation. Writing documentation strings is really important to make sure  others use your functionality properly. Didn't write new functions? That's fine, but be sure  that the documentation for the code you touched is still in great shape. It is not uncommon  to find some strange wording or clarification that you can take care of while you are here.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"We encourage using unicode characters  when writing docstrings, e.g., use α instead of \\alpha. This makes the rendering of the  docstrings in the Documentation and in the Julia REPL's help?> mode as similar as possible.","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"You can preview how the Documentation will look like after merging by building the documentation  locally. To do that, from the main directory of your local repository call","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"julia --project=docs/ -e 'using Pkg; Pkg.develop(PackageSpec(path=pwd())); Pkg.instantiate()'\njulia --project=docs/ docs/make.jl","category":"page"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"and then open docs/build/index.html in your favorite browser.","category":"page"},{"location":"contributing/#Credits","page":"Contributor's guide","title":"Credits","text":"","category":"section"},{"location":"contributing/","page":"Contributor's guide","title":"Contributor's guide","text":"This contributor's guide is heavily based on the MetPy contributor's guide  and on its \"cover\" made by Oceananigans.jl.","category":"page"},{"location":"aliasing/#Aliasing","page":"Aliasing","title":"Aliasing","text":"","category":"section"},{"location":"aliasing/","page":"Aliasing","title":"Aliasing","text":"In pseudospectral methods, computing nonlinear terms results in aliasing errors. (Read more about aliasing errors in the FourierFlows.jl Documentation.) To avoid aliasing errors, we need to apply some dealiasing to our fields  in Fourier space before transforming to physical space to compute nonlinear terms.","category":"page"},{"location":"aliasing/","page":"Aliasing","title":"Aliasing","text":"info: De-aliasing scheme\nFourierFlows.jl currently implements dealiasing by zeroing out the highest-aliased_fraction  wavenumber components on a grid. By default in FourierFlows.jl, aliased_fraction=1/3. Users can construct a grid with different aliased_fraction viajulia> grid = OneDGrid(; nx=64, Lx=2π, aliased_fraction=1/2)\n\njulia> OneDimensionalGrid\n         ├─────────── Device: CPU\n         ├──────── FloatType: Float64\n         ├────────── size Lx: 6.283185307179586\n         ├──── resolution nx: 64\n         ├── grid spacing dx: 0.09817477042468103\n         ├─────────── domain: x ∈ [-3.141592653589793, 3.0434178831651124]\n         └─ aliased fraction: 0.5or provide the keyword argument aliased_fraction to the Problem() constructor of each module, e.g.,julia> prob = GeophysicalFlows.TwoDNavierStokes.Problem(; aliased_fraction=1/2)\nProblem\n  ├─────────── grid: grid (on CPU)\n  ├───── parameters: params\n  ├────── variables: vars\n  ├─── state vector: sol\n  ├─────── equation: eqn\n  ├────────── clock: clock\n  └──── timestepper: RK4TimeStepper\n  \njulia> prob.grid.aliased_fraction\n0.5","category":"page"},{"location":"aliasing/","page":"Aliasing","title":"Aliasing","text":"Currently, all nonlinearities in all modules included in GeophysicalFlows.jl modules are quadratic  nonlinearities. Therefore, the default aliased_fraction of 1/3 is appropriate.","category":"page"},{"location":"aliasing/","page":"Aliasing","title":"Aliasing","text":"All modules apply de-aliasing by calling, e.g., dealias!(prob.sol, prob.grid) both before computing any nonlinear terms and also during updating all variable, i.e., within updatevars!.","category":"page"},{"location":"aliasing/","page":"Aliasing","title":"Aliasing","text":"To disable de-aliasing you need to create a problem with a grid that has been constructed with  the keyword aliased_fraction=0.","category":"page"},{"location":"installation_instructions/#Installation-instructions","page":"Installation instructions","title":"Installation instructions","text":"","category":"section"},{"location":"installation_instructions/","page":"Installation instructions","title":"Installation instructions","text":"You can install the latest version of GeophysicalFlows.jl via the built-in package manager  (accessed by pressing ] in the Julia REPL command prompt) to add the package and also to  instantiate/build all the required dependencies","category":"page"},{"location":"installation_instructions/","page":"Installation instructions","title":"Installation instructions","text":"julia> ]\n(v1.6) pkg> add GeophysicalFlows\n(v1.6) pkg> instantiate","category":"page"},{"location":"installation_instructions/","page":"Installation instructions","title":"Installation instructions","text":"We recommend installing GeophysicalFlows.jl with the built-in Julia package manager, because  this installs a stable, tagged release. Later on, you can update GeophysicalFlows.jl to the  latest tagged release again via the package manager by typing","category":"page"},{"location":"installation_instructions/","page":"Installation instructions","title":"Installation instructions","text":"(v1.6) pkg> update GeophysicalFlows","category":"page"},{"location":"installation_instructions/","page":"Installation instructions","title":"Installation instructions","text":"Note that some releases might induce breaking changes to certain modules. If after anything  happens or your code stops working, please open an issue  or start a discussion. We're  more than happy to help with getting your simulations up and running.","category":"page"},{"location":"installation_instructions/","page":"Installation instructions","title":"Installation instructions","text":"warn: Use Julia 1.6 or newer\nThe latest GeophysicalFlows.jl requires at least Julia v1.6 to run. Installing GeophysicalFlows with an older version of Julia will install an older version  of GeophysicalFlows.jl (the latest version compatible with your version of Julia).Last version compatible with Julia v1.5: GeophysicalFlows.jl v0.13.1","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"EditURL = \"../../../examples/barotropicqgql_betaforced.jl\"","category":"page"},{"location":"literated/barotropicqgql_betaforced/#barotropicqgql_betaforced_example","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"A simulation of forced-dissipative barotropic quasi-geostrophic turbulence on a beta plane under the quasi-linear approximation. The dynamics include linear drag and stochastic excitation.","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Install-dependencies","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Install dependencies","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"using Pkg\npkg\"add GeophysicalFlows, CUDA, CairoMakie\"","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Let's-begin","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Let's begin","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"using GeophysicalFlows, CUDA, Random, Printf, CairoMakie\n\nusing Statistics: mean\n\nparsevalsum = FourierFlows.parsevalsum\nrecord = CairoMakie.record                # disambiguate between CairoMakie.record and CUDA.record","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Choosing-a-device:-CPU-or-GPU","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Numerical-parameters-and-time-stepping-parameters","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Numerical parameters and time-stepping parameters","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"      n = 128            # 2D resolution = n^2\nstepper = \"FilteredRK4\"  # timestepper\n     dt = 0.05           # timestep\n nsteps = 8000           # total number of time-steps\n nsubs  = 10             # number of time-steps for intermediate logging/plotting (nsteps must be multiple of nsubs)","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Physical-parameters","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Physical parameters","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"L = 2π        # domain size\nβ = 10.0      # planetary PV gradient\nμ = 0.01      # bottom drag","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Forcing","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Forcing","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"We force the vorticity equation with stochastic excitation that is delta-correlated in time and while spatially homogeneously and isotropically correlated. The forcing has a spectrum with power in a ring in wavenumber space of radius k_f (forcing_wavenumber) and width δ_f (forcing_bandwidth), and it injects energy per unit area and per unit time equal to varepsilon. That is, the forcing covariance spectrum is proportional to exp-(bmk - k_f)^2  (2 δ_f^2).","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"forcing_wavenumber = 14.0 * 2π/L  # the forcing wavenumber, `k_f`, for a spectrum that is a ring in wavenumber space\nforcing_bandwidth  = 1.5  * 2π/L  # the width of the forcing spectrum, `δ_f`\nε = 0.001                         # energy input rate by the forcing\n\ngrid = TwoDGrid(dev; nx=n, Lx=L)\n\nK = @. sqrt(grid.Krsq)            # a 2D array with the total wavenumber\n\nforcing_spectrum = @. exp(-(K - forcing_wavenumber)^2 / (2 * forcing_bandwidth^2))\n@CUDA.allowscalar forcing_spectrum[grid.Krsq .== 0] .= 0 # ensure forcing has zero domain-average\n\nε0 = parsevalsum(forcing_spectrum .* grid.invKrsq / 2, grid) / (grid.Lx * grid.Ly)\n@. forcing_spectrum *= ε/ε0       # normalize forcing to inject energy at rate ε","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"We reset of the random number generator for reproducibility","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"if dev==CPU(); Random.seed!(1234); else; CUDA.seed!(1234); end","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"Next we construct function calcF! that computes a forcing realization every timestep. First we make sure that if dev=GPU(), then CUDA.rand() function is called for random numbers uniformly distributed between 0 and 1.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"random_uniform = dev==CPU() ? rand : CUDA.rand\n\nfunction calcF!(Fh, sol, t, clock, vars, params, grid)\n  T = eltype(grid)\n  @. Fh = sqrt(forcing_spectrum) * cis(2π * random_uniform(T)) / sqrt(clock.dt)\n\n  return nothing\nend","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Problem-setup","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Problem setup","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"We initialize a Problem by providing a set of keyword arguments. We use stepper = \"FilteredRK4\". Filtered timesteppers apply a wavenumber-filter at every time-step that removes enstrophy at high wavenumbers and, thereby, stabilize the problem, despite that we use the default viscosity coefficient ν=0. Thus, we choose not to do any dealiasing by providing aliased_fraction=0.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"prob = BarotropicQGQL.Problem(dev; nx=n, Lx=L, β, μ, dt, stepper,\n                              calcF=calcF!, stochastic=true, aliased_fraction=0)","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"and define some shortcuts.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"sol, clock, vars, params, grid = prob.sol, prob.clock, prob.vars, prob.params, prob.grid\nx,  y  = grid.x, grid.y\nLx, Ly = grid.Lx, grid.Ly","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"First let's see how a forcing realization looks like. Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when vars live on the GPU.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"calcF!(vars.Fh, sol, 0.0, clock, vars, params, grid)\n\nfig = Figure()\n\nax = Axis(fig[1, 1],\n          xlabel = \"x\",\n          ylabel = \"y\",\n          aspect = 1,\n          title = \"a forcing realization\",\n          limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\nheatmap!(ax, x, y, Array(irfft(vars.Fh, grid.nx));\n         colormap = :balance, colorrange = (-8, 8))\n\nfig","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"(Image: )","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Setting-initial-conditions","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"Our initial condition is simply fluid at rest.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"BarotropicQGQL.set_zeta!(prob, device_array(dev)(zeros(grid.nx, grid.ny)))","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Diagnostics","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Diagnostics","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"Create Diagnostics – energy and enstrophy are functions imported at the top.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"E = Diagnostic(BarotropicQGQL.energy, prob; nsteps)\nZ = Diagnostic(BarotropicQGQL.enstrophy, prob; nsteps)","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"We can also define our custom diagnostics via functions.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"zetaMean(prob) = prob.sol[1, :]\n\nzMean = Diagnostic(zetaMean, prob; nsteps, freq=10)  # the zonal-mean vorticity","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"We combile all diags in a list.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"diags = [E, Z, zMean] # A list of Diagnostics types passed to \"stepforward!\" will  be updated every timestep.","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Output","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Output","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"We choose folder for outputing .jld2 files and snapshots (.png files).","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"filepath = \".\"\nplotpath = \"./plots_forcedbetaQLturb\"\nplotname = \"snapshots\"\nfilename = joinpath(filepath, \"forcedbetaQLturb.jld2\")","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"Do some basic file management,","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"if isfile(filename); rm(filename); end\nif !isdir(plotpath); mkdir(plotpath); end","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"and then create Output.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"get_sol(prob) = prob.sol # extracts the Fourier-transformed solution\n\nfunction get_u(prob)\n  grid, vars = prob.grid, prob.vars\n\n  @. vars.uh = im * grid.l  * grid.invKrsq * sol\n  ldiv!(vars.u, grid.rfftplan, deepcopy(vars.uh))\n\n  return  vars.u\nend\n\nout = Output(prob, filename, (:sol, get_sol), (:u, get_u))","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"Output\n  ├──── prob: FourierFlows.Problem{DataType, Matrix{ComplexF64}, Float64, Matrix{ComplexF64}}\n  ├──── path: ./forcedbetaQLturb.jld2\n  └── fields: Dict{Symbol, Function}(:sol => Main.var\"##313\".get_sol, :u => Main.var\"##313\".get_u)","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Visualizing-the-simulation","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Visualizing the simulation","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"We define a function that plots the vorticity and streamfunction fields, the corresponding zonal-mean vorticity and zonal-mean zonal velocity and timeseries of energy and enstrophy.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"title_ζ = Observable(@sprintf(\"vorticity, μt = %.2f\", μ * clock.t))\ntitle_ψ = \"streamfunction ψ\"\n\nfig = Figure(resolution=(1000, 600))\n\naxis_kwargs = (xlabel = \"x\",\n               ylabel = \"y\",\n               aspect = 1,\n               limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\naxζ = Axis(fig[1, 1]; title = title_ζ, axis_kwargs...)\n\naxψ = Axis(fig[2, 1]; title = title_ψ, axis_kwargs...)\n\naxζ̄ = Axis(fig[1, 2],\n           xlabel = \"zonal mean ζ\",\n           ylabel = \"y\",\n           aspect = 1,\n           limits = ((-3, 3), (-Ly/2, Ly/2)))\n\naxū = Axis(fig[2, 2],\n           xlabel = \"zonal mean u\",\n           ylabel = \"y\",\n           aspect = 1,\n           limits = ((-0.5, 0.5), (-Ly/2, Ly/2)))\n\naxE = Axis(fig[1, 3],\n           xlabel = \"μ t\",\n           ylabel = \"energy\",\n           aspect = 1,\n           limits = ((-0.1, 4.1), (0, 0.05)))\n\naxZ = Axis(fig[2, 3],\n           xlabel = \"μ t\",\n           ylabel = \"enstrophy\",\n           aspect = 1,\n           limits = ((-0.1, 4.1), (0, 5)))\n\nζ̄, ζ′= prob.vars.Zeta, prob.vars.zeta\nζ = Observable(Array(@. ζ̄ + ζ′))\nψ̄, ψ′= prob.vars.Psi,  prob.vars.psi\nψ = Observable(Array(@. ψ̄ + ψ′))\nζ̄ₘ = Observable(Array(vec(mean(ζ̄, dims=1))))\nūₘ = Observable(Array(vec(mean(prob.vars.U, dims=1))))\n\nμt = Observable(μ * E.t[1:1])\nenergy = Observable(E.data[1:1])\nenstrophy = Observable(Z.data[1:1])\n\nheatmap!(axζ, x, y, ζ;\n         colormap = :balance, colorrange = (-8, 8))\n\nheatmap!(axψ, x, y, ψ;\n         colormap = :viridis, colorrange = (-0.22, 0.22))\n\nlines!(axζ̄, ζ̄ₘ, y; linewidth = 3)\nlines!(axζ̄, 0y, y; linewidth = 1, linestyle=:dash)\n\nlines!(axū, ūₘ, y; linewidth = 3)\nlines!(axū, 0y, y; linewidth = 1, linestyle=:dash)\n\nlines!(axE, μt, energy; linewidth = 3)\nlines!(axZ, μt, enstrophy; linewidth = 3, color = :red)\n","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Time-stepping-the-Problem-forward","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Time-stepping the Problem forward","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"We step the Problem forward in time.","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"startwalltime = time()\n\nframes = 0:round(Int, nsteps / nsubs)\n\nrecord(fig, \"barotropicqgql_betaforced.mp4\", frames, framerate = 18) do j\n  if j % (1000 / nsubs) == 0\n    cfl = clock.dt * maximum([maximum(vars.u .+ vars.U) / grid.dx, maximum(vars.v) / grid.dy])\n\n    log = @sprintf(\"step: %04d, t: %d, cfl: %.2f, E: %.4f, Q: %.4f, walltime: %.2f min\",\n      clock.step, clock.t, cfl, E.data[E.i], Z.data[Z.i],\n      (time()-startwalltime)/60)\n\n    println(log)\n  end\n\n  ζ[] = @. ζ̄ + ζ′\n  ψ[] = @. ψ̄ + ψ′\n  ζ̄ₘ[] = vec(mean(ζ̄, dims=1))\n  ūₘ[] = vec(mean(prob.vars.U, dims=1))\n\n  μt.val = μ * E.t[1:E.i]\n  energy[] = E.data[1:E.i]\n  enstrophy[] = Z.data[1:E.i]\n\n  title_ζ[] = @sprintf(\"vorticity, μt = %.2f\", μ * clock.t)\n\n  stepforward!(prob, diags, nsubs)\n  BarotropicQGQL.updatevars!(prob)\nend","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"step: 0000, t: 0, cfl: 0.00, E: 0.0000, Q: 0.0000, walltime: 0.00 min\nstep: 1000, t: 50, cfl: 0.64, E: 0.0286, Q: 3.9616, walltime: 0.10 min\nstep: 2000, t: 100, cfl: 0.81, E: 0.0384, Q: 4.1193, walltime: 0.18 min\nstep: 3000, t: 150, cfl: 0.80, E: 0.0441, Q: 4.4990, walltime: 0.27 min\nstep: 4000, t: 200, cfl: 0.80, E: 0.0450, Q: 3.6810, walltime: 0.37 min\nstep: 5000, t: 250, cfl: 0.87, E: 0.0472, Q: 4.0671, walltime: 0.46 min\nstep: 6000, t: 300, cfl: 0.92, E: 0.0484, Q: 4.1866, walltime: 0.56 min\nstep: 7000, t: 350, cfl: 0.89, E: 0.0482, Q: 3.8817, walltime: 0.66 min\nstep: 8000, t: 400, cfl: 0.92, E: 0.0482, Q: 3.7857, walltime: 0.77 min\n","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"(Image: )","category":"page"},{"location":"literated/barotropicqgql_betaforced/#Save","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Save","text":"","category":"section"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"Finally, we can save, e.g., the last snapshot via","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"savename = @sprintf(\"%s_%09d.png\", joinpath(plotpath, plotname), clock.step)\nsavefig(savename)","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"","category":"page"},{"location":"literated/barotropicqgql_betaforced/","page":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","title":"Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence","text":"This page was generated using Literate.jl.","category":"page"},{"location":"stochastic_forcing/#Stochastic-Forcing","page":"Stochastic forcing","title":"Stochastic Forcing","text":"","category":"section"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Forcing terms are implemented in various modules. Forcing can be either deterministic or  stochastic (random). For deterministic forcing the implementation is straightforward; for  stochastic forcing there are two main train of thoughts: Itô calculus and Stratonovich calculus.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Both stochastic calculi give the same results. But once we decide to use one of the two calculi  we have to remain consistent and use that calculus throughout. There can be a lot of confusion  and oftentimes confusion stems from mixing the two different stochastic calculi in a single  computation instead of using one of the two consistently all along.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"note: Itô or Stratonovich in GeophysicalFlows.jl?\nAll modules included in GeophysicalFlows.jl use Stratonovich calculus.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The choice of Stratonovich calculus for GeophysicalFlows.jl was made since this calculus \"works  the same\" with both stochastic and deterministic forcing, i.e., with Stratonovich calculus we have the same chain rules for differentiation for stochastic functions as the chain rules we  learn in normal-deterministic calculus). Therefore, with the Stratonovich calculus the code  does not really \"care\" whether the user implement deterministic or stochastic forcing.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"If you are interested in learning more regarding the two stochastic calculi and how they are  numerically implemented then read on; otherwise you can skip this section of the documentation.","category":"page"},{"location":"stochastic_forcing/#Stochastic-Differential-Equations-(SDEs)","page":"Stochastic forcing","title":"Stochastic Differential Equations (SDEs)","text":"","category":"section"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"A differential equation:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"\tfracmathrmd xmathrmd t = f(x)  quad x(t_0) = 0","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"can also be equivalently written in an integral form:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"\tx(t) = int_t_0^t f(x(s))  mathrmd s","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"In a similar manner, a stochastic differential equation (SDE),","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"\tmathrmd x = f(x)  mathrmd t + g(x)  mathrmd W_t  quad x(t_0) = 0 ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"with W_t a Brownian motion or Wiener process, can be written in an integral form as:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"\tx(t) = int_t_0^t f(x(s))  mathrmd s + int_t_0^t g(x(s))  mathrmd W_s ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"tip: Wiener process\nA Wiener process is a random variable W_t that depends continuously on t ge 0 and satisfies the following properties:Independence. For 0 le s le t the increment W_t - W_s is independent of any prior values, i.e., independent of all W_tau, tau le s.\nStationarity. The statistical distribution of the increment W_t+s  W_s does not depend on  s (and so is identical in distribution to W_t).\nGaussianity. W_t is a Gaussian process with mean langle W_t rangle = 0 and covariance langle W_t W_s rangle = min(t s).","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"tip: Notation\nIt's common to use notation x_t to denote explicit t-dependence of variable x. Not to be confused with the other common usage of subscripts for denoting partial differentiation.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The last integral in the integral representation of a SDE expression above is a stochastic integral  (it involves a stochastic differential, mathrmd W_t). There is not a single straight-forward  way for computing the value of a stochastic integral. The various ways we can approximate the  value of a stochastic integral as a Riemannian sum each lead to a different answer. The two most  popular ways for computing such stochastic integrals are:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"beginaligned\ncolorGreen textItô  colorGreenint_t_0^t g(x(s))  mathrmd W_s approx sum_j g left ( x(t_j) right )(W_j+1 - W_j)  \ncolorMagenta textStratonovich  colorMagenta int_t_0^t g(x(s))  mathrmd W_s approx sum_j g left (x left (tfrac12(t_j + t_j+1) right ) right)(W_j+1 - W_j) \nendaligned","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The difference in the two calculi above lies in the point at which we choose to evaluate g(x): we take the start of the time-interval for colorGreen textItô  t_j, while we use the mid-point for colorMagentatextStratonovich  tfrac12(t_j+t_j+1). In the case the  stochastic noise is additive, i.e., its prefactor g does not depend on the state x_t, then the two interpretations coincide. When the noise does depend on the state of the system,  i.e., g=g(x(t)), then the two interpretations above give thoroughly different results. This happens because the white noise process is not continuous and, therefore, the two interpretations of the stochastic integrals above do not converge to the same result.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"To overcome this apparent inconsistency, the two choices above come together with different  chain rules, i.e., chain rules that are not necessarily the same as those in plain old calculus. Let us see how different choices for computing the stochastic integrals bring about the need  for different chain rules.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"An SDE can be written also in differential form. Because we cannot formally form the derivative mathrmd W  mathrmd t, since W is nowhere differentiable, we write an SDE in  differential form as:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"beginaligned\ncolorGreentextItô  colorGreenmathrmd x_t = f(x_t) mathrmd t + g(x_t) mathrmd W_t  \ncolorMagentatextStratonovich  colorMagentamathrmd x_t = f(x_t) mathrmd t + g(x_t) circ mathrmd W_t \nendaligned","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The circle in the term colorMagentag(x_t) circ mathrmd W_t is used to differentiate  between Itô and Stratonovich calculus.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Let's now assume we perform a variable change y = G(x). It turns out that according to  which interpretation of the stochastic integral one chooses to use, then the following chain  rule must be used:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"beginaligned\ncolorGreentextItô  colorGreenmathrmd y_t = fracmathrmd Gmathrmd x mathrmd x_t + frac12 g(x_t)^2 fracmathrmd^2 Gmathrmd x^2 mathrmd t = left fracmathrmd Gmathrmd x f(x_t) + frac12 g(x_t)^2 fracmathrmd^2 Gmathrmd x^2 right mathrmd t + fracmathrmd Gmathrmd x g(x_t) mathrmd W_t  \ncolorMagentatextStratonovich  colorMagentamathrmd y_t  = fracmathrmd Gmathrmd x mathrmd x_t = fracmathrmd Gmathrmd x f(x_t) mathrmd t + fracmathrmd Gmathrmd x g(x_t) circ mathrmd W_t \nendaligned","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The above are the so-called stochastic chain rules. All derivatives of G are evaluated  at x_t. For Stratonovich calculus, the chain rule resembles the usual chain rule one learns in calculus; for Itô there exists an additional term, often referred to as the \"drift-term\":  colorGreentfrac12 g^2  mathrmd^2G  mathrmd x^2.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"It's easy to see that the extra drift-term in Itô's interpretation of the stochastic integral,  is exactly equal to the ensemble mean  over forcing realizations of the Stratonovich  stochastic integral. That's because the Itô stochastic integral has, by construction, zero  ensemble mean since at every instant the noise is multiplied with g which is  evaluated  at a time instance before the action of the noise; g and mathrmd W are uncorrelated  and thus:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"colorGreen left langle g(x_t) mathrmd W_t right rangle = 0 quad textwhile quad colorMagenta left langle g(x_t) circ mathrmd W_t right rangle ne 0 ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The above is demonstrated by evaluating the simple stochastic integral:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"beginaligned\ncolorGreen textItô  colorGreen left langle int_t_0^t W_s  mathrmd W_s right rangle approx sum_j left langle W_j (W_j+1 - W_j) right rangle \n hspace73em colorGreen = sum_j left langle W_j W_j+1 right rangle - left langle W_j W_j right rangle sim sum_j t_j - t_j = 0  \ncolorMagentatextStratonovich  colorMagentaleft langle int_t_0^t W_s circ mathrmd W_s right rangle approx sum_j left langle frac12(W_j + W_j+1) (W_j+1 - W_j)right rangle \n hspace73em colorMagenta = frac12 sum_j left langle W_j+1 W_j+1 right rangle - left langle W_j W_j right rangle  sim frac12 sum_j t_j+1 - t_j = fract2 \nendaligned","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"SDEs rarely can be solved in closed form; most often numerical solution of SDEs is brought to  the rescue. Itô calculus has the advantage that is very easily implemented numerically. On  the other hand, the chain rule in Stratonovich calculus coincides with that in normal calculus.  This stems from the fact that in the Stratonovich interpretation the white noise process is as  a series of colored noise processes with the de-correlation time tending to zero. This made  Stratonovich calculus more popular in the physics community. A nice discussion on the differences  and similarities between the two calculi is given by Van Kampen (1981).","category":"page"},{"location":"stochastic_forcing/#A-simple-Stochastic-Differential-Equation:-the-Ornstein–Uhlenbeck-process","page":"Stochastic forcing","title":"A simple Stochastic Differential Equation: the Ornstein–Uhlenbeck process","text":"","category":"section"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"One of the simplest SDEs is the Ornstein–Uhlenbeck process, a variation of which is:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"x(t) = - int_t_0^t mu x(s)  mathrmd s + int_t_0^t sqrtsigma  mathrmd W_s  tag1","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Note that in differential form (1) is written as:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"mathrmd x_t = - mu x_t  mathrmd t + sqrtsigma  mathrmd W_t  tag2","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Luckily, for (2) we don't need to distinguish between Itô and Stratonovich, since g is  independent of x(t). But note that often this is not the case; that g is independent  of x(t) is only a fortuitous coincident for this particular SDE.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"How do we time-step SDE (2) numerically? Let us assume a discretization of time into time-steps of duration tau, i.e., t_j = (j-1) tau, j=1 2 dots. (What follows is easily  generalized to non-uniform time discretizations.) With that in mind, we denote x_j equiv x(t_j).  Then the Euler–Mayorama time-stepping scheme for (2) is","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"\tx_j+1 = x_j + (-mu x_j) tau + sqrtsigma (W_j+1 - W_j) ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Now let us ask the following question: How can we compute the work done by the noise? In other words, if we are interested in the evolution of the \"energy\", defined as E equiv tfrac12 x^2, then how does the noise term attribute in the growth of E?  To answer that we first have to find the SDE that energy E obeys. But, in doing so, it  is important to adopt a single interpretation for computing stochastic integrals as now a  transformation of variables is needed. That is, depending on whether we choose to interpret  the stochastic integrals according to Itô or to Stratonovich calculus, E evolves according to:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"hspace335em colorGreen textItô  colorGreen mathrmd E_t = left ( -2 mu E_t + tfrac12 sigma right ) mathrmd t + x_t sqrtsigma mathrmd W_t  tag3","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"hspace-335em colorMagenta textStratonovich  colorMagenta mathrmd E_t = -2 mu E_t mathrmd t + x_t circ sqrtsigma mathrmd W_t  tag4","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The term -2 mu E_t in both cases is the dissipation of energy by the mu term; the  rest of the terms involve the noise. How do we compute the work P done by the noise?  Well, it follows that:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"beginaligned\ncolorGreen textItô  colorGreen P_t = tfrac12 sigma mathrmd t + sqrtsigma x_t mathrmd W_t approx tfrac12 sigma  mathrmdt + sqrtsigma x_j (W_j+1 - W_j)  \ncolorMagenta textStratonovich  colorMagenta P_t =  x_t circ sqrtsigma mathrmd W_t approx sqrtsigma x left ( tfrac12 (t_j + t_j+1) right ) (W_j+1 - W_j) \nendaligned","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Now let's assume for a moment that we didn't know the rules for transforming Stratonovich to  Itô and we were wondering what is the extra drift term we have to include in the Itô formulations,  i.e., the tfrac12 sigma term. We can compute the Itô's drift-term using the fact that  it is exactly equal to langle x_t circ sqrtsigma mathrmd W_t rangle; and for the  latter we can use the \"usual\" calculus. That is, we rewrite (1) as:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"dotx = -mu x + xi  tag5","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"where xi(t) is understood to be the \"continuous\" version of the white-noise process (which  is formally only understood in terms of distributions). The forcing xi has the properties:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"left langle xi(t) right rangle = 0 quad textand quad left langle xi(t) xi(t) right rangle = sigma delta(t - t) ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Thus we need to compute langle P_t rangle = langle x(t) xi(t) rangle. But (5) formally has the solution:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"x(t) = e^-mu t x(0) + int_0^t e^-mu (t - s) xi(s)  mathrmd s ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"and using this solution we get","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"langle P_t rangle = langle x(t) xi(t) rangle =  e^-mu t underbracelangle x(0) xi(t) rangle_=0 + int_0^t e^-mu (t - s) langle xi(t) xi(s) rangle  mathrmd s = sigma int_0^t e^- mu (t - s) delta(t - s)  mathrmd s = fracsigma2 ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Above we used that int_0^t delta(t - s) mathrmd s = tfrac12, which is consistent  with the Stratonovich symmetric interpretation of stochastic integrals.","category":"page"},{"location":"stochastic_forcing/#Numerical-implementation","page":"Stochastic forcing","title":"Numerical implementation","text":"","category":"section"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"How do we time-step the equation for E? In the case of Itô's interpretation, (3), we use  the Euler–Maruyama time-stepping scheme:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"\tE_j+1 = E_j + left ( -2 mu E_j + fracsigma2 right ) tau + sqrtsigma x_j (W_j+1 - W_j)","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"However, we cannot use Euler–Maruyama for time-stepping the corresponding Stratonovich  version of (4), since the Euler–Maruyama scheme involves \"Itô\"-thinking. To time-step (4) we  have to approximate g in the middle of the time-step. There are many ways to do that, one  of which is the, so called, Euler–Heun method:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"beginaligned\nwidetildeE_j+1 = E_j + (- 2mu E_j) tau + sqrtsigma x_j (W_j+1 - W_j) \nE_j+1 = E_j + left( -2 mu fracE_j + widetildeE_j + 12 right)tau + sqrtsigmafracx_j + x_j+12 (W_j+1 - W_j) \nendaligned","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Let's apply not Euler–Maruyama and Euler–Heun schemes to time-step (3) and (4) respectively and compare the results with those obtained from time-stepping (2) and computing E a  posteriori. ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Figure below compares the energy evolution as predicted by:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"direct computation from the x_t time-series: tfrac12 x_t^2,\ntime-integration of (3) using Euler–Maruyama, and\ntime-integration of (4) using Euler–Heun.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"using CairoMakie","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"using CairoMakie\nusing Statistics: mean\nusing Random: randn, seed!\nseed!(1234) # for reproducing the same plots\n\n                μ = 0.2\n                σ = 0.2    # noise strength\n               dt = 0.01   # timestep\n           nsteps = 2001   # total timesteps\n   n_realizations = 1000   # how many forcing realizations\nsome_realizations = 20     # used for plotting to illustrate convergence\n\nt = 0:dt:(nsteps-1)*dt \t# time\n\nΔW = randn(nsteps, n_realizations) * sqrt(dt) # noise\n\n# Numerical calculation\nx = zeros(size(ΔW))\nE_ito = zeros(size(ΔW))\nE_str = zeros(size(ΔW))\nE_numerical = zeros(size(ΔW))\n\nfor j = 2:nsteps # time step the equations\n\t\n  # time-step dx = - μ x dt + √σ dW\n  @. x[j, :] = x[j-1, :] - μ * x[j-1, :] * dt + sqrt(σ) * ΔW[j-1, :]\n\n  # time-step dE = (- 2μ E + ½σ) dt + √σ x dW\n  @. E_ito[j, :] = E_ito[j-1, :] + (-2μ * E_ito[j-1, :]\n\t                   + σ/2) * dt + sqrt(σ) * x[j-1, :] * ΔW[j-1, :]\n\n  # time-step dE = - 2μ E dt + √σ x ∘ dW\n  xbar = @. x[j-1, :] - μ * x[j-1, :] * dt + sqrt(σ) * ΔW[j-1, :]\n  Ebar = @. E_str[j-1, :] + (-2μ * E_str[j-1, :]) * dt + sqrt(σ) * x[j-1, :] * ΔW[j-1, :]\n  @. E_str[j, :] = E_str[j-1, :] + (-2μ * (E_str[j-1, :]\n\t\t+ Ebar) / 2) * dt + sqrt(σ) * (x[j-1, :] + xbar) / 2 * ΔW[j-1, :]\nend\n\n# direct computation of E from x\n@. E_numerical = 0.5 * x^2\n\n# compare the three E(t) solutions\nfig = Figure()\nax = Axis(fig[1, 1];\n          xlabel = \"μ t\",\n          ylabel = \"E\",\n          title = \"comparison of E(t) for single realization\")\n\nhl1 = lines!(ax, μ * t, E_numerical[:, 1];\n             linewidth = 3, linestyle = :solid)\nhl2 = lines!(ax, μ * t, E_ito[:, 1];\n             linewidth = 2, linestyle = :dash)\nhl3 = lines!(ax, μ * t, E_str[:, 1];\n             linewidth = 1, linestyle = :dashdot)\n\nLegend(fig[1, 2], [hl1, hl2, hl3], [\"½ xₜ²\", \"Eₜ (Ito)\", \"Eₜ (Stratonovich)\"])\n\nsave(\"assets/energy_comparison.svg\", fig); nothing #hide","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"(Image: energy_comparison)","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Now we can further compute the \"energy\" budgets, i.e., the work done by the noise versus the energy loss by the μ term, using Itô and Stratonovich formalisms. Figures below show  the ensemble mean energy budgets (using 1000 ensemble members) as computed using Itô and Stratonovich calculus. For the energy budget to close we have to be consistent: if we time-step  the  energy equation based on Stratonovich calculus then we must compute the work also according  to Stratonovich and vice versa.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"# theoretical results for ⟨E⟩ and d⟨E⟩/dt\n   E_theory = @. σ/4μ * (1 - exp(-2μ * t))\ndEdt_theory = @. σ/2  * exp(-2μ * t)\n\n# compute d⟨E⟩/dt numerically\ndEdt_ito = mean(E_ito[2:nsteps, :] .- E_ito[1:nsteps-1, :], dims=2) / dt\n\n# compute the work and dissipation\nwork_ito = mean(sqrt(σ) * ΔW[1:nsteps-1, :] / dt .* x[1:nsteps-1, :] .+ σ/2, dims=2)\ndiss_ito = 2μ * (mean(E_ito[1:nsteps-1, :], dims=2))\n\n# Ensemble mean energy budgets from the Itô integration\n\nfig = Figure()\n\nax1 = Axis(fig[1, 1];\n           xlabel = \"μ t\",\n           ylabel = \"E\",\n           title = \"Ito: 𝖽Eₜ = (-2μ Eₜ + ½σ) 𝖽t + xₜ √σ 𝖽Wₜ\")\n\nhl1 = lines!(ax1, μ * t, E_theory;\n             linewidth = 3)\nhl2 = lines!(ax1, μ * t, vec(mean(E_ito[:, 1:some_realizations], dims=2));\n             linewidth = 2)\nhl3 = lines!(ax1, μ * t, vec(mean(E_ito, dims=2)),\n             linewidth = 1)\n\nLegend(fig[1, 2], [hl1, hl2, hl3],\n                  [\"theoretical ⟨E⟩\", \"⟨E⟩ from $some_realizations ensemble members\", \"⟨E⟩ from $n_realizations ensemble members\"])\n\nax2 = Axis(fig[2, 1];\n           xlabel = \"μ t\",\n           ylabel = \"dE/dt\")\n\nhl1 = lines!(ax2, μ * t[1:nsteps-1], vec(dEdt_ito);\n             linewidth = 2, linestyle = :dash)\nhl2 = lines!(ax2, μ * t[1:nsteps-1], vec(work_ito .- diss_ito);\n             linewidth = 1, linestyle = :dashdot)\nhl3 = lines!(ax2, μ * t[1:nsteps-1], dEdt_theory[1:nsteps-1];\n             linewidth = 3, linestyle = :solid)\n\nLegend(fig[2, 2], [hl1, hl2, hl3],\n                  [\"numerical 𝖽⟨E⟩/𝖽t\", \"⟨work - dissipation⟩\", \"theoretical 𝖽⟨E⟩/𝖽t\"])\n\nsave(\"assets/energy_budgets_Ito.svg\", fig); nothing #hide","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"(Image: energy_budgets_Ito)","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"# compute d⟨E⟩/dt numerically\ndEdt_str = mean(E_str[2:nsteps, :] .- E_str[1:nsteps-1, :], dims=2) / dt\n\n# compute the work and dissipation\nwork_str = mean(sqrt(σ) * ΔW[1:nsteps-1, :] / dt .* (x[1:nsteps-1, :] .+ x[2:nsteps, :])/2, dims=2)\ndiss_str = 2μ * (mean(E_str[1:nsteps-1, :], dims=2))\n\nfig = Figure()\n\nax1 = Axis(fig[1, 1];\n           xlabel = \"μ t\",\n           ylabel = \"E\",\n           title = \"Stratonovich: 𝖽Eₜ = -2μ Eₜ 𝖽t + xₜ ∘ √σ 𝖽Wₜ\")\n\nhl1 = lines!(ax1, μ * t, E_theory;\n             linewidth = 3)\nhl2 = lines!(ax1, μ * t, vec(mean(E_str[:, 1:some_realizations], dims=2));\n             linewidth = 2)\nhl3 = lines!(ax1, μ * t, vec(mean(E_str, dims=2)),\n             linewidth = 1)\n\nLegend(fig[1, 2], [hl1, hl2, hl3],\n                  [\"theoretical ⟨E⟩\", \"⟨E⟩ from $some_realizations ensemble members\", \"⟨E⟩ from $n_realizations ensemble members\"])\n\nax2 = Axis(fig[2, 1];\n           xlabel = \"μ t\",\n           ylabel = \"dE/dt\")\n\nhl1 = lines!(ax2, μ * t[1:nsteps-1], vec(dEdt_str);\n             linewidth = 2, linestyle = :dash)\nhl2 = lines!(ax2, μ * t[1:nsteps-1], vec(work_str .- diss_str);\n             linewidth = 1, linestyle = :dashdot)\nhl3 = lines!(ax2, μ * t[1:nsteps-1], dEdt_theory[1:nsteps-1];\n             linewidth = 3, linestyle = :solid)\n\nLegend(fig[2, 2], [hl1, hl2, hl3],\n                  [\"numerical 𝖽⟨E⟩/𝖽t\", \"⟨work - dissipation⟩\", \"theoretical 𝖽⟨E⟩/𝖽t\"])\n\nsave(\"assets/energy_budgets_Stratonovich.svg\", fig); nothing #hide","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"(Image: energy_budgets_Stratonovich)","category":"page"},{"location":"stochastic_forcing/#A-simple-Stochastic-Partial-Differential-Equation-(SPDE)","page":"Stochastic forcing","title":"A simple Stochastic Partial Differential Equation (SPDE)","text":"","category":"section"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"We would like now to transfer all the knowledge we got from the previous sections to PDEs.  In particular we'll start by focussing on the simple SPDE:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"partial_t nabla^2 psi(bmx t) =  - mu nabla^2 psi(bmx t) + xi(bmx t)  tag6","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"with periodic boundary conditions in both x and y. SPDE (6) is also equivalently written as:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"mathrmd nabla^2 psi_t(bmx) = - mu nabla^2 psi_t (bmx) mathrmd t + sqrtsigma mathrmd W_t (bmx) ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The form (6) is the continuous version, similar to (2). In this SPDE, since the forcing is  purely additive, i.e., it does not depend on the state of the system, both Itô and Stratonovich  interpretations coincide.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The forcing xi obeys:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"langle xi(bmx t) rangle = 0 quad textand quad langle xi(bmx t) xi(bmx t) rangle = Q(bmx - bmx) delta(t - t) ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"that is, the forcing is white in time but spatially correlated; its spatial correlation is  prescribed by the function Q which is, necessarily, homogeneous in all its arguments (see discussion by Constantinou (2015); Appendix A).","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Equation (6) above describes the vorticity evolution of a two-dimensional fluid nabla^2 psi  that is stochastically forced while dissipated by linear drag mu. The energy of the  fluid is:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"E = tfrac12 overlinebmnabla psi^2^x y = -tfrac12 overlinepsi nabla^2 psi^x y ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"where the overbar denotes average over x and y and an integration-by-parts was carried through in the last equality. To obtain the energy equation we multiply (6) with -psi and  average over the whole domain. Thus, the work done by the forcing is given by:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"P = -  overlinepsi  xi^x y ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"but the above is a stochastic integral and it is meaningless without a rule for computing the stochastic integral.","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Numerically, the work done by the forcing at the j-th timestep can be obtained  Stratonovich-wise via:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"beginaligned\nP_j = -  overlinefracpsi(bmx t_j) + psi(bmx t_j+1)2  xi(bmx t_j+1) ^xy \nendaligned","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"or Itô-wise as","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"beginaligned\nP_j = - overline psi(bmx t_j) xi(bmx t_j+1) ^xy + textdrift \nendaligned","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"But how much is the Itô drift term in this case? As in the previous section, the drift is  precisely the ensemble mean of the Stratonovich work, i.e.:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"textrmIto drift= - overlinelangle underbracepsi(bmx t) circ  xi(bmx t)_textrmStratonovich rangle^x y ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"But again, the above can be computed using the \"formal\" solution of (6):","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"psi(bmx t) = e^-mu t psi(bmx 0) + int_0^t e^- mu (t - s) nabla^-2 xi(bmx s)  mathrmd s ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"which implies","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"beginaligned\ntextdrift  = -overlinee^- mu t underbraceleft langle psi(bmx 0) xi(bmx t) right rangle_=0^x y - int_0^t e^- mu (t - s) overlinenabla^-2 left langle xi(bmx s) xi(bmx t) rightrangle^x y  mathrmd s \n = - int_0^t e^-mu(t - s) overlineunderbraceleft  nabla^-2 Q (bmx) right  big_bmx=0_textindependent of x y  delta(t - s)^xy  mathrmd s \n = - frac12 nabla^-2 Q(bmx) big_bmx=0 \n = - frac12 left  nabla^-2 int fracmathrmd^2 bmk(2pi)^2 widehatQ(bmk)  e^i bmk bmcdot bmx right _bmx=0 \n = int fracmathrmd^2 bmk(2pi)^2 fracwidehatQ(bmk)2 bmk^2 \nendaligned","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Thus, the drift, or in this case the mean energy input rate by the stochastic forcing, is  precisely determined from the spatial correlation of the forcing, Q. Let us denote the  drift as:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"varepsilon equiv int fracmathrmd^2 bmk(2pi)^2 fracwidehatQ(bmk)2 bmk^2  tag7","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Using the above, the work for a single forcing realization at the j-th timestep is numerically  computed as:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"colorGreen textItô  colorGreen P_j = -overlinepsi(bmx t_j) xi(bmx t_j+1)^x y + varepsilon  tag8","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"colorMagenta textStratonovich  colorMagenta P_j = -overlinefracpsi(bmx t_j) + psi(bmx t_j+1)2 xi(bmx t_j+1)^x y  tag9","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"Remember, previously the work done by the stochastic forcing was:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"mathrmd P_t = colorGreen fracsigma2mathrmd t + sqrtsigma x_t mathrmd W_t = colorMagenta sqrtsigma x_t circ mathrmd W_t ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"and by sampling over various forcing realizations:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"langle mathrmd P_t rangle = fracsigma2 mathrmd t = langle sqrtsigma x_t circ mathrmd W_t rangle ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"All modules in GeophysicalFlows.jl use Stratonovich calculus. For example, the domain-averaged  energy injected per unit time by the forcing in the TwoDNavierStokes module is computed  using (9) via the energy_work function.","category":"page"},{"location":"stochastic_forcing/#A-bit-more-elaborate-SPDE","page":"Stochastic forcing","title":"A bit more elaborate SPDE","text":"","category":"section"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"It turns out everything carries through if in our SPDE above for the 2D vorticity equation we  also include the nonlinear advection terms:","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"partial_t nabla^2 psi(bmx t) + mathsfJ(psi nabla^2 psi) = - mu nabla^2 psi(bmx t) + xi(bmx t)  tag10","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"The nonlinearity does not alter the Itô drift; thus the ensemble mean energy input by the  stochastic forcing, remains the same. We can easily verify this from the \"formal\" solution  of (10):","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"psi(bmx t) = e^- mu t psi(bmx 0) + int_0^t e^- mu (t - s) nabla^-2 xi(bmx s)  mathrmd s - int_0^t nabla^-2 mathsfJ left ( psi(bmx s) nabla^2 psi(bmx s) right ) mathrmd s ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"When multiplied with xi(bmx t) the last term vanishes since its only non-zero  contribution comes from the point s = t, which is of measure zero (in the integrated sense). ","category":"page"},{"location":"stochastic_forcing/","page":"Stochastic forcing","title":"Stochastic forcing","text":"A demonstration of how the energy budgets can be computed when we have stochastic forcing is  illustrated in an example of the TwoDNavierStokes  module.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"EditURL = \"../../../examples/twodnavierstokes_stochasticforcing.jl\"","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#twodnavierstokes_stochasticforcing_example","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"A simulation of forced-dissipative two-dimensional turbulence. We solve the two-dimensional vorticity equation with stochastic excitation and dissipation in the form of linear drag and hyperviscosity.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Install-dependencies","page":"2D forced-dissipative turbulence","title":"Install dependencies","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"using Pkg\npkg\"add GeophysicalFlows, CUDA, CairoMakie\"","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Let's-begin","page":"2D forced-dissipative turbulence","title":"Let's begin","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"using GeophysicalFlows, CUDA, Random, Printf, CairoMakie\n\nparsevalsum = FourierFlows.parsevalsum\nrecord = CairoMakie.record                # disambiguate between CairoMakie.record and CUDA.record","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Choosing-a-device:-CPU-or-GPU","page":"2D forced-dissipative turbulence","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Numerical,-domain,-and-simulation-parameters","page":"2D forced-dissipative turbulence","title":"Numerical, domain, and simulation parameters","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"First, we pick some numerical and physical parameters for our model.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":" n, L  = 256, 2π             # grid resolution and domain length\n ν, nν = 2e-7, 2             # hyperviscosity coefficient and hyperviscosity order\n μ, nμ = 1e-1, 0             # linear drag coefficient\n    dt = 0.005               # timestep\nnsteps = 4000                # total number of steps\n nsubs = 20                  # number of steps between each plot","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Forcing","page":"2D forced-dissipative turbulence","title":"Forcing","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"We force the vorticity equation with stochastic excitation that is delta-correlated in time and while spatially homogeneously and isotropically correlated. The forcing has a spectrum with power in a ring in wavenumber space of radius k_f (forcing_wavenumber) and width δ_f (forcing_bandwidth), and it injects energy per unit area and per unit time equal to varepsilon. That is, the forcing covariance spectrum is proportional to exp-(bmk - k_f)^2  (2 δ_f^2).","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"forcing_wavenumber = 14.0 * 2π/L  # the forcing wavenumber, `k_f`, for a spectrum that is a ring in wavenumber space\nforcing_bandwidth  = 1.5  * 2π/L  # the width of the forcing spectrum, `δ_f`\nε = 0.1                           # energy input rate by the forcing\n\ngrid = TwoDGrid(dev; nx=n, Lx=L)\n\nK = @. sqrt(grid.Krsq)             # a 2D array with the total wavenumber\n\nforcing_spectrum = @. exp(-(K - forcing_wavenumber)^2 / (2 * forcing_bandwidth^2))\n@CUDA.allowscalar forcing_spectrum[grid.Krsq .== 0] .= 0 # ensure forcing has zero domain-average\n\nε0 = parsevalsum(forcing_spectrum .* grid.invKrsq / 2, grid) / (grid.Lx * grid.Ly)\n@. forcing_spectrum *= ε/ε0        # normalize forcing to inject energy at rate ε","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"We reset of the random number generator for reproducibility","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"if dev==CPU(); Random.seed!(1234); else; CUDA.seed!(1234); end","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"Next we construct function calcF! that computes a forcing realization every timestep. First we make sure that if dev=GPU(), then CUDA.rand() function is called for random numbers uniformly distributed between 0 and 1.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"random_uniform = dev==CPU() ? rand : CUDA.rand\n\nfunction calcF!(Fh, sol, t, clock, vars, params, grid)\n  T = eltype(grid)\n  @. Fh = sqrt(forcing_spectrum) * cis(2π * random_uniform(T)) / sqrt(clock.dt)\n\n  return nothing\nend","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Problem-setup","page":"2D forced-dissipative turbulence","title":"Problem setup","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"We initialize a Problem by providing a set of keyword arguments. The stepper keyword defines the time-stepper to be used.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"prob = TwoDNavierStokes.Problem(dev; nx=n, Lx=L, ν, nν, μ, nμ, dt, stepper=\"ETDRK4\",\n                                calcF=calcF!, stochastic=true)","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"Define some shortcuts for convenience.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"sol, clock, vars, params, grid = prob.sol, prob.clock, prob.vars, prob.params, prob.grid\n\nx, y = grid.x, grid.y","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"First let's see how a forcing realization looks like. Function calcF!() computes the forcing in Fourier space and saves it into variable vars.Fh, so we first need to go back to physical space.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when the variable lives on the GPU.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"calcF!(vars.Fh, sol, 0.0, clock, vars, params, grid)\n\nfig = Figure()\n\nax = Axis(fig[1, 1],\n          xlabel = \"x\",\n          ylabel = \"y\",\n          aspect = 1,\n          title = \"a forcing realization\",\n          limits = ((-L/2, L/2), (-L/2, L/2)))\n\nheatmap!(ax, x, y, Array(irfft(vars.Fh, grid.nx));\n         colormap = :balance, colorrange = (-200, 200))\n\nfig","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Setting-initial-conditions","page":"2D forced-dissipative turbulence","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"Our initial condition is a fluid at rest.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"TwoDNavierStokes.set_ζ!(prob, device_array(dev)(zeros(grid.nx, grid.ny)))","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Diagnostics","page":"2D forced-dissipative turbulence","title":"Diagnostics","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"Create Diagnostics; the diagnostics are aimed to probe the energy budget.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"E  = Diagnostic(TwoDNavierStokes.energy,    prob; nsteps) # energy\nZ  = Diagnostic(TwoDNavierStokes.enstrophy, prob; nsteps) # enstrophy\ndiags = [E, Z] # a list of Diagnostics passed to `stepforward!` will  be updated every timestep.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Visualizing-the-simulation","page":"2D forced-dissipative turbulence","title":"Visualizing the simulation","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"We initialize a plot with the vorticity field and the time-series of energy and enstrophy diagnostics. To plot energy and enstrophy on the same axes we scale enstrophy with k_f^2.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"ζ = Observable(Array(vars.ζ))\ntitle_ζ = Observable(\"vorticity, μ t=\" * @sprintf(\"%.2f\", μ * clock.t))\n\nenergy = Observable(Point2f[(μ * E.t[1], E.data[1])])\nenstrophy = Observable(Point2f[(μ * Z.t[1], Z.data[1] / forcing_wavenumber^2)])\n\nfig = Figure(resolution = (800, 360))\n\naxζ = Axis(fig[1, 1];\n           xlabel = \"x\",\n           ylabel = \"y\",\n           title = title_ζ,\n           aspect = 1,\n           limits = ((-L/2, L/2), (-L/2, L/2)))\n\nax2 = Axis(fig[1, 2],\n           xlabel = \"μ t\",\n           limits = ((0, 1.1 * μ * nsteps * dt), (0, 0.55)))\n\nheatmap!(axζ, x, y, ζ;\n         colormap = :balance, colorrange = (-40, 40))\n\nhE = lines!(ax2, energy; linewidth = 3)\nhZ = lines!(ax2, enstrophy; linewidth = 3, color = :red)\nLegend(fig[1, 3], [hE, hZ], [\"energy E(t)\", \"enstrophy Z(t) / k_f²\"])\n\nfig","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/#Time-stepping-the-Problem-forward","page":"2D forced-dissipative turbulence","title":"Time-stepping the Problem forward","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"We step the Problem forward in time.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"startwalltime = time()\n\nrecord(fig, \"twodturb_forced.mp4\", 0:round(Int, nsteps / nsubs), framerate = 18) do j\n  if j % (1000/nsubs) == 0\n    cfl = clock.dt * maximum([maximum(vars.u) / grid.dx, maximum(vars.v) / grid.dy])\n\n    log = @sprintf(\"step: %04d, t: %d, cfl: %.2f, E: %.4f, Z: %.4f, walltime: %.2f min\",\n          clock.step, clock.t, cfl, E.data[E.i], Z.data[Z.i], (time()-startwalltime)/60)\n    println(log)\n  end\n\n  ζ[] = vars.ζ\n\n  energy[] = push!(energy[], Point2f(μ * E.t[E.i], E.data[E.i]))\n  enstrophy[] = push!(enstrophy[], Point2f(μ * Z.t[E.i], Z.data[Z.i] / forcing_wavenumber^2))\n\n  title_ζ[] = \"vorticity, μ t=\" * @sprintf(\"%.2f\", μ * clock.t)\n\n  stepforward!(prob, diags, nsubs)\n  TwoDNavierStokes.updatevars!(prob)\nend","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"step: 0000, t: 0, cfl: 0.00, E: 0.0000, Z: 0.0000, walltime: 0.00 min\nstep: 1000, t: 5, cfl: 0.40, E: 0.2971, Z: 36.2188, walltime: 0.12 min\nstep: 2000, t: 10, cfl: 0.49, E: 0.4138, Z: 37.5536, walltime: 0.22 min\nstep: 3000, t: 15, cfl: 0.45, E: 0.4564, Z: 36.3428, walltime: 0.33 min\nstep: 4000, t: 20, cfl: 0.55, E: 0.4775, Z: 37.3600, walltime: 0.44 min\n","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing/","page":"2D forced-dissipative turbulence","title":"2D forced-dissipative turbulence","text":"This page was generated using Literate.jl.","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"EditURL = \"../../../examples/multilayerqg_2layer.jl\"","category":"page"},{"location":"literated/multilayerqg_2layer/#multilayerqg_2layer_example","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"A simulation of the growth of barolinic instability in the Phillips 2-layer model when we impose a vertical mean flow shear as a difference Delta U in the imposed, domain-averaged, zonal flow at each layer.","category":"page"},{"location":"literated/multilayerqg_2layer/#Install-dependencies","page":"Phillips model of Baroclinic Instability","title":"Install dependencies","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"using Pkg\npkg\"add GeophysicalFlows, CairoMakie, Printf\"","category":"page"},{"location":"literated/multilayerqg_2layer/#Let's-begin","page":"Phillips model of Baroclinic Instability","title":"Let's begin","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"using GeophysicalFlows, CairoMakie, Printf\n\nusing Random: seed!","category":"page"},{"location":"literated/multilayerqg_2layer/#Choosing-a-device:-CPU-or-GPU","page":"Phillips model of Baroclinic Instability","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/multilayerqg_2layer/#Numerical-parameters-and-time-stepping-parameters","page":"Phillips model of Baroclinic Instability","title":"Numerical parameters and time-stepping parameters","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"n = 128                  # 2D resolution = n²\nstepper = \"FilteredRK4\"  # timestepper\n     dt = 2.5e-3         # timestep\n nsteps = 20000          # total number of time-steps\n nsubs  = 50             # number of time-steps for plotting (nsteps must be multiple of nsubs)","category":"page"},{"location":"literated/multilayerqg_2layer/#Physical-parameters","page":"Phillips model of Baroclinic Instability","title":"Physical parameters","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"L = 2π                   # domain size\nμ = 5e-2                 # bottom drag\nβ = 5                    # the y-gradient of planetary PV\n\nnlayers = 2              # number of layers\nf₀, g = 1, 1             # Coriolis parameter and gravitational constant\nH = [0.2, 0.8]           # the rest depths of each layer\nρ = [4.0, 5.0]           # the density of each layer\n\nU = zeros(nlayers)       # the imposed mean zonal flow in each layer\nU[1] = 1.0\nU[2] = 0.0","category":"page"},{"location":"literated/multilayerqg_2layer/#Problem-setup","page":"Phillips model of Baroclinic Instability","title":"Problem setup","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"We initialize a Problem by providing a set of keyword arguments. We use stepper = \"FilteredRK4\". Filtered timesteppers apply a wavenumber-filter at every time-step that removes enstrophy at high wavenumbers and, thereby, stabilize the problem, despite that we use the default viscosity coefficient ν=0.","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"prob = MultiLayerQG.Problem(nlayers, dev; nx=n, Lx=L, f₀, g, H, ρ, U, μ, β,\n                            dt, stepper, aliased_fraction=0)","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"and define some shortcuts.","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"sol, clock, params, vars, grid = prob.sol, prob.clock, prob.params, prob.vars, prob.grid\nx, y = grid.x, grid.y","category":"page"},{"location":"literated/multilayerqg_2layer/#Setting-initial-conditions","page":"Phillips model of Baroclinic Instability","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"Our initial condition is some small-amplitude random noise. We smooth our initial condidtion using the timestepper's high-wavenumber filter.","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"device_array() function returns the array type appropriate for the device, i.e., Array for dev = CPU() and CuArray for dev = GPU().","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"seed!(1234) # reset of the random number generator for reproducibility\nq₀  = 1e-2 * device_array(dev)(randn((grid.nx, grid.ny, nlayers)))\nq₀h = prob.timestepper.filter .* rfft(q₀, (1, 2)) # apply rfft  only in dims=1, 2\nq₀  = irfft(q₀h, grid.nx, (1, 2))                 # apply irfft only in dims=1, 2\n\nMultiLayerQG.set_q!(prob, q₀)","category":"page"},{"location":"literated/multilayerqg_2layer/#Diagnostics","page":"Phillips model of Baroclinic Instability","title":"Diagnostics","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"Create Diagnostics – energies function is imported at the top.","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"E = Diagnostic(MultiLayerQG.energies, prob; nsteps)\ndiags = [E] # A list of Diagnostics types passed to \"stepforward!\" will  be updated every timestep.","category":"page"},{"location":"literated/multilayerqg_2layer/#Output","page":"Phillips model of Baroclinic Instability","title":"Output","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"We choose folder for outputing .jld2 files and snapshots (.png files).","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"filepath = \".\"\nplotpath = \"./plots_2layer\"\nplotname = \"snapshots\"\nfilename = joinpath(filepath, \"2layer.jld2\")","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"Do some basic file management","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"if isfile(filename); rm(filename); end\nif !isdir(plotpath); mkdir(plotpath); end","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"And then create Output","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"get_sol(prob) = prob.sol # extracts the Fourier-transformed solution\n\nfunction get_u(prob)\n  sol, params, vars, grid = prob.sol, prob.params, prob.vars, prob.grid\n\n  @. vars.qh = sol\n  streamfunctionfrompv!(vars.ψh, vars.qh, params, grid)\n  @. vars.uh = -im * grid.l * vars.ψh\n  invtransform!(vars.u, vars.uh, params)\n\n  return vars.u\nend\n\nout = Output(prob, filename, (:sol, get_sol), (:u, get_u))","category":"page"},{"location":"literated/multilayerqg_2layer/#Visualizing-the-simulation","page":"Phillips model of Baroclinic Instability","title":"Visualizing the simulation","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"We create a figure using Makie's Observables that plots the potential vorticity field and the evolution of energy and enstrophy. Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when vars live on the GPU.","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"Lx, Ly = grid.Lx, grid.Ly\n\ntitle_KE = Observable(@sprintf(\"μt = %.2f\", μ * clock.t))\n\nq₁ = Observable(Array(vars.q[:, :, 1]))\nψ₁ = Observable(Array(vars.ψ[:, :, 1]))\nq₂ = Observable(Array(vars.q[:, :, 2]))\nψ₂ = Observable(Array(vars.ψ[:, :, 2]))\n\nfunction compute_levels(maxf, nlevels=8)\n  # -max(|f|):...:max(|f|)\n  levelsf  = @lift collect(range(-$maxf, stop = $maxf, length=nlevels))\n\n  # only positive\n  levelsf⁺ = @lift collect(range($maxf/(nlevels-1), stop = $maxf, length=Int(nlevels/2)))\n\n  # only negative\n  levelsf⁻ = @lift collect(range(-$maxf, stop = -$maxf/(nlevels-1), length=Int(nlevels/2)))\n\n  return levelsf, levelsf⁺, levelsf⁻\nend\n\nmaxψ₁ = Observable(maximum(abs, vars.ψ[:, :, 1]))\nmaxψ₂ = Observable(maximum(abs, vars.ψ[:, :, 2]))\n\nlevelsψ₁, levelsψ₁⁺, levelsψ₁⁻ = compute_levels(maxψ₁)\nlevelsψ₂, levelsψ₂⁺, levelsψ₂⁻ = compute_levels(maxψ₂)\n\nKE₁ = Observable(Point2f[(μ * E.t[1], E.data[1][1][1])])\nKE₂ = Observable(Point2f[(μ * E.t[1], E.data[1][1][2])])\nPE  = Observable(Point2f[(μ * E.t[1], E.data[1][2])])\n\nfig = Figure(resolution=(1000, 600))\n\naxis_kwargs = (xlabel = \"x\",\n               ylabel = \"y\",\n               aspect = 1,\n               limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\naxq₁ = Axis(fig[1, 1]; title = \"q₁\", axis_kwargs...)\n\naxψ₁ = Axis(fig[2, 1]; title = \"ψ₁\", axis_kwargs...)\n\naxq₂ = Axis(fig[1, 2]; title = \"q₂\", axis_kwargs...)\n\naxψ₂ = Axis(fig[2, 2]; title = \"ψ₂\", axis_kwargs...)\n\naxKE = Axis(fig[1, 3],\n            xlabel = \"μ t\",\n            ylabel = \"KE\",\n            title = title_KE,\n            yscale = log10,\n            limits = ((-0.1, 2.6), (1e-9, 5)))\n\naxPE = Axis(fig[2, 3],\n            xlabel = \"μ t\",\n            ylabel = \"PE\",\n            yscale = log10,\n            limits = ((-0.1, 2.6), (1e-9, 5)))\n\nheatmap!(axq₁, x, y, q₁; colormap = :balance)\n\nheatmap!(axq₂, x, y, q₂; colormap = :balance)\n\ncontourf!(axψ₁, x, y, ψ₁;\n          levels = levelsψ₁, colormap = :viridis, extendlow = :auto, extendhigh = :auto)\n contour!(axψ₁, x, y, ψ₁;\n          levels = levelsψ₁⁺, color=:black)\n contour!(axψ₁, x, y, ψ₁;\n          levels = levelsψ₁⁻, color=:black, linestyle = :dash)\n\ncontourf!(axψ₂, x, y, ψ₂;\n          levels = levelsψ₂, colormap = :viridis, extendlow = :auto, extendhigh = :auto)\n contour!(axψ₂, x, y, ψ₂;\n          levels = levelsψ₂⁺, color=:black)\n contour!(axψ₂, x, y, ψ₂;\n          levels = levelsψ₂⁻, color=:black, linestyle = :dash)\n\nke₁ = lines!(axKE, KE₁; linewidth = 3)\nke₂ = lines!(axKE, KE₂; linewidth = 3)\nLegend(fig[1, 4], [ke₁, ke₂,], [\"KE₁\", \"KE₂\"])\n\nlines!(axPE, PE; linewidth = 3)\n\nfig","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"(Image: )","category":"page"},{"location":"literated/multilayerqg_2layer/#Time-stepping-the-Problem-forward","page":"Phillips model of Baroclinic Instability","title":"Time-stepping the Problem forward","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"Finally, we time-step the Problem forward in time.","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"startwalltime = time()\n\nframes = 0:round(Int, nsteps / nsubs)\n\nrecord(fig, \"multilayerqg_2layer.mp4\", frames, framerate = 18) do j\n  if j % (1000 / nsubs) == 0\n    cfl = clock.dt * maximum([maximum(vars.u) / grid.dx, maximum(vars.v) / grid.dy])\n\n    log = @sprintf(\"step: %04d, t: %.1f, cfl: %.2f, KE₁: %.3e, KE₂: %.3e, PE: %.3e, walltime: %.2f min\",\n                   clock.step, clock.t, cfl, E.data[E.i][1][1], E.data[E.i][1][2], E.data[E.i][2][1], (time()-startwalltime)/60)\n\n    println(log)\n  end\n\n  q₁[] = vars.q[:, :, 1]\n  ψ₁[] = vars.ψ[:, :, 1]\n  q₂[] = vars.q[:, :, 2]\n  ψ₂[] = vars.ψ[:, :, 2]\n\n  maxψ₁[] = maximum(abs, vars.ψ[:, :, 1])\n  maxψ₂[] = maximum(abs, vars.ψ[:, :, 2])\n\n  KE₁[] = push!(KE₁[], Point2f(μ * E.t[E.i], E.data[E.i][1][1]))\n  KE₂[] = push!(KE₂[], Point2f(μ * E.t[E.i], E.data[E.i][1][2]))\n  PE[]  = push!(PE[] , Point2f(μ * E.t[E.i], E.data[E.i][2]))\n\n  title_KE[] = @sprintf(\"μ t = %.2f\", μ * clock.t)\n\n  stepforward!(prob, diags, nsubs)\n  MultiLayerQG.updatevars!(prob)\nend","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"step: 0000, t: 0.0, cfl: 0.00, KE₁: 1.057e-08, KE₂: 4.999e-08, PE: 3.110e-09, walltime: 0.00 min\nstep: 1000, t: 2.5, cfl: 0.00, KE₁: 4.790e-08, KE₂: 4.955e-08, PE: 6.252e-08, walltime: 0.17 min\nstep: 2000, t: 5.0, cfl: 0.00, KE₁: 1.611e-07, KE₂: 8.767e-08, PE: 1.824e-07, walltime: 0.31 min\nstep: 3000, t: 7.5, cfl: 0.00, KE₁: 6.691e-07, KE₂: 2.782e-07, PE: 7.464e-07, walltime: 0.45 min\nstep: 4000, t: 10.0, cfl: 0.00, KE₁: 3.107e-06, KE₂: 1.241e-06, PE: 3.361e-06, walltime: 0.59 min\nstep: 5000, t: 12.5, cfl: 0.00, KE₁: 1.570e-05, KE₂: 6.251e-06, PE: 1.685e-05, walltime: 0.72 min\nstep: 6000, t: 15.0, cfl: 0.00, KE₁: 8.230e-05, KE₂: 3.282e-05, PE: 8.810e-05, walltime: 0.86 min\nstep: 7000, t: 17.5, cfl: 0.01, KE₁: 4.412e-04, KE₂: 1.760e-04, PE: 4.723e-04, walltime: 1.02 min\nstep: 8000, t: 20.0, cfl: 0.02, KE₁: 2.394e-03, KE₂: 9.554e-04, PE: 2.564e-03, walltime: 1.18 min\nstep: 9000, t: 22.5, cfl: 0.05, KE₁: 1.274e-02, KE₂: 5.083e-03, PE: 1.365e-02, walltime: 1.33 min\nstep: 10000, t: 25.0, cfl: 0.09, KE₁: 5.764e-02, KE₂: 2.314e-02, PE: 6.095e-02, walltime: 1.49 min\nstep: 11000, t: 27.5, cfl: 0.12, KE₁: 1.720e-01, KE₂: 7.441e-02, PE: 1.710e-01, walltime: 1.64 min\nstep: 12000, t: 30.0, cfl: 0.19, KE₁: 3.204e-01, KE₂: 1.522e-01, PE: 3.567e-01, walltime: 1.79 min\nstep: 13000, t: 32.5, cfl: 0.23, KE₁: 3.819e-01, KE₂: 2.204e-01, PE: 3.942e-01, walltime: 1.92 min\nstep: 14000, t: 35.0, cfl: 0.30, KE₁: 4.390e-01, KE₂: 3.152e-01, PE: 4.753e-01, walltime: 2.05 min\nstep: 15000, t: 37.5, cfl: 0.27, KE₁: 5.285e-01, KE₂: 3.980e-01, PE: 6.448e-01, walltime: 2.18 min\nstep: 16000, t: 40.0, cfl: 0.31, KE₁: 5.657e-01, KE₂: 4.813e-01, PE: 6.384e-01, walltime: 2.30 min\nstep: 17000, t: 42.5, cfl: 0.30, KE₁: 5.449e-01, KE₂: 5.176e-01, PE: 5.810e-01, walltime: 2.42 min\nstep: 18000, t: 45.0, cfl: 0.31, KE₁: 5.547e-01, KE₂: 5.822e-01, PE: 5.594e-01, walltime: 2.53 min\nstep: 19000, t: 47.5, cfl: 0.28, KE₁: 5.410e-01, KE₂: 6.639e-01, PE: 5.192e-01, walltime: 2.64 min\nstep: 20000, t: 50.0, cfl: 0.26, KE₁: 5.316e-01, KE₂: 6.543e-01, PE: 5.425e-01, walltime: 2.75 min\n","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"(Image: )","category":"page"},{"location":"literated/multilayerqg_2layer/#Save","page":"Phillips model of Baroclinic Instability","title":"Save","text":"","category":"section"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"Finally, we can save, e.g., the last snapshot via","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"savename = @sprintf(\"%s_%09d.png\", joinpath(plotpath, plotname), clock.step)\nsavefig(savename)","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"","category":"page"},{"location":"literated/multilayerqg_2layer/","page":"Phillips model of Baroclinic Instability","title":"Phillips model of Baroclinic Instability","text":"This page was generated using Literate.jl.","category":"page"},{"location":"modules/singlelayerqg/#SingleLayerQG","page":"SingleLayerQG","title":"SingleLayerQG","text":"","category":"section"},{"location":"modules/singlelayerqg/#Basic-Equations","page":"SingleLayerQG","title":"Basic Equations","text":"","category":"section"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"This module solves the barotropic or equivalent barotropic quasi-geostrophic vorticity equation  on a beta plane of variable fluid depth H - h(x y). The flow is obtained through a  streamfunction psi as (u v) = (-partial_y psi partial_x psi). All flow fields  can be obtained from the quasi-geostrophic potential vorticity (QGPV). Here the QGPV is","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"\tunderbracef_0 + beta y_textplanetary PV + underbracepartial_x v\n\t- partial_y u_textrelative vorticity\n\tunderbrace - frac1ell^2 psi_textvortex stretching + \n\tunderbracefracf_0 hH_texttopographic PV ","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"where ell is the Rossby radius of deformation. Purely barotropic dynamics corresponds to  infinite Rossby radius of deformation (ell = infty), while a flow with a finite Rossby  radius follows is said to obey equivalent-barotropic dynamics. We denote the sum of the relative vorticity and the vortex stretching contributions to the QGPV with q equiv nabla^2 psi - psi  ell^2. Also, we denote the topographic PV with eta equiv f_0 h  H.","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"The dynamical variable is q.  Thus, the equation solved by the module is:","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"partial_t q + mathsfJ(psi q + eta) + beta partial_x psi = \nunderbrace-leftmu + nu(-1)^n_nu nabla^2n_nu right q_textrmdissipation + F ","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"where mathsfJ(a b) = (partial_x a)(partial_y b)-(partial_y a)(partial_x b) is the  two-dimensional Jacobian. On the right hand side, F(x y t) is forcing, mu is  linear drag, and nu is hyperviscosity of order n_nu. Plain old viscosity corresponds  to n_nu = 1.","category":"page"},{"location":"modules/singlelayerqg/#Implementation","page":"SingleLayerQG","title":"Implementation","text":"","category":"section"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"The equation is time-stepped forward in Fourier space:","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"partial_t widehatq = - widehatmathsfJ(psi q + eta) + beta fraci k_x𝐤^2 + 1ell^2 widehatq - left(mu + nu 𝐤^2n_nu right) widehatq + widehatF ","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"The state variable sol is the Fourier transform of the sum of relative vorticity and vortex  stretching (when the latter is applicable), qh.","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"The Jacobian is computed in the conservative form: mathsfJ(f g) = partial_y  (partial_x f) g - partial_x (partial_y f) g.","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"The linear operator is constructed in Equation","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"GeophysicalFlows.SingleLayerQG.Equation","category":"page"},{"location":"modules/singlelayerqg/#GeophysicalFlows.SingleLayerQG.Equation","page":"SingleLayerQG","title":"GeophysicalFlows.SingleLayerQG.Equation","text":"Equation(params::BarotropicQGParams, grid)\n\nReturn the equation for a barotropic QG problem with params and grid. Linear operator  L includes bottom drag μ, (hyper)-viscosity of order n_ν with coefficient ν  and the β term:\n\nL = - μ - ν 𝐤^2 n_ν + i β k_x  𝐤² \n\nThe nonlinear term is computed via calcN! function.\n\n\n\n\n\nEquation(params::EquivalentBarotropicQGParams, grid)\n\nReturn the equation for an equivalent-barotropic QG problem with params and grid.  Linear operator L includes bottom drag μ, (hyper)-viscosity of order n_ν with  coefficient ν and the β term:\n\nL = -μ - ν 𝐤^2 n_ν + i β k_x  (𝐤² + 1ℓ²) \n\nThe nonlinear term is computed via calcN! function.\n\n\n\n\n\n","category":"function"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"The nonlinear terms are computed via","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"GeophysicalFlows.SingleLayerQG.calcN!","category":"page"},{"location":"modules/singlelayerqg/#GeophysicalFlows.SingleLayerQG.calcN!","page":"SingleLayerQG","title":"GeophysicalFlows.SingleLayerQG.calcN!","text":"calcN!(N, sol, t, clock, vars, params, grid)\n\nCalculate the nonlinear term, that is the advection term and the forcing,\n\nN = - widehat𝖩(ψ q + η) + F \n\n\n\n\n\n","category":"function"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"which in turn calls calcN_advection!  and addforcing!.","category":"page"},{"location":"modules/singlelayerqg/#Parameters-and-Variables","page":"SingleLayerQG","title":"Parameters and Variables","text":"","category":"section"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"All required parameters are included inside Params and all module variables are included inside Vars.","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"For the decaying case (no forcing, F = 0), variables are constructed with Vars. For the forced case (F ne 0) variables are constructed with either ForcedVars or StochasticForcedVars.","category":"page"},{"location":"modules/singlelayerqg/#Helper-functions","page":"SingleLayerQG","title":"Helper functions","text":"","category":"section"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"Some helper functions included in the module are:","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"GeophysicalFlows.SingleLayerQG.updatevars!\nGeophysicalFlows.SingleLayerQG.set_q!","category":"page"},{"location":"modules/singlelayerqg/#GeophysicalFlows.SingleLayerQG.updatevars!","page":"SingleLayerQG","title":"GeophysicalFlows.SingleLayerQG.updatevars!","text":"updatevars!(sol, vars, params, grid)\n\nUpdate the variables in vars with the solution in sol.\n\n\n\n\n\n","category":"function"},{"location":"modules/singlelayerqg/#GeophysicalFlows.SingleLayerQG.set_q!","page":"SingleLayerQG","title":"GeophysicalFlows.SingleLayerQG.set_q!","text":"set_q!(prob, q)\n\nSet the solution of problem, prob.sol as the transform of q and update variables prob.vars.\n\n\n\n\n\n","category":"function"},{"location":"modules/singlelayerqg/#Diagnostics","page":"SingleLayerQG","title":"Diagnostics","text":"","category":"section"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"The kinetic energy of the fluid is computed via:","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"GeophysicalFlows.SingleLayerQG.kinetic_energy","category":"page"},{"location":"modules/singlelayerqg/#GeophysicalFlows.SingleLayerQG.kinetic_energy","page":"SingleLayerQG","title":"GeophysicalFlows.SingleLayerQG.kinetic_energy","text":"kinetic_energy(prob)\n\nReturn the problem's (prob) domain-averaged kinetic energy of the fluid. Since u² + v² = bf  ψ², the domain-averaged kinetic energy is \n\nint frac12 bf  ψ² frac𝖽x 𝖽yL_x L_y = sum_𝐤 frac12 𝐤² ψ² \n\n\n\n\n\n","category":"function"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"while the potential energy, for an equivalent barotropic fluid, is computed via:","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"GeophysicalFlows.SingleLayerQG.potential_energy","category":"page"},{"location":"modules/singlelayerqg/#GeophysicalFlows.SingleLayerQG.potential_energy","page":"SingleLayerQG","title":"GeophysicalFlows.SingleLayerQG.potential_energy","text":"potential_energy(prob)\n\nReturn the problem's (prob) domain-averaged potential energy of the fluid,\n\nint frac12 fracψ²ℓ² frac𝖽x 𝖽yL_x L_y = sum_𝐤 frac12 fracψ²ℓ² \n\n\n\n\n\n","category":"function"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"The total energy is:","category":"page"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"GeophysicalFlows.SingleLayerQG.energy","category":"page"},{"location":"modules/singlelayerqg/#GeophysicalFlows.SingleLayerQG.energy","page":"SingleLayerQG","title":"GeophysicalFlows.SingleLayerQG.energy","text":"energy(prob)\n\nReturn the problem's (prob) domain-averaged total energy of the fluid, that is, the kinetic energy for a pure barotropic flow or the sum of kinetic and potential energies for an equivalent barotropic flow.\n\n\n\n\n\n","category":"function"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"Other diagnostic include: energy_dissipation,  energy_drag, energy_work,  enstrophy_dissipation, and enstrophy_drag, enstrophy_work.","category":"page"},{"location":"modules/singlelayerqg/#Examples","page":"SingleLayerQG","title":"Examples","text":"","category":"section"},{"location":"modules/singlelayerqg/","page":"SingleLayerQG","title":"SingleLayerQG","text":"examples/singlelayerqg_betadecay.jl: Simulate decaying quasi-geostrophic flow on a beta plane demonstrating zonation.\nexamples/singlelayerqg_betaforced.jl: Simulate forced-dissipative quasi-geostrophic flow on a beta plane demonstrating zonation. The forcing is temporally delta-correlated with isotropic spatial structure with power in a narrow annulus in wavenumber space with total wavenumber k_f.\nexamples/singlelayerqg_decay_topography.jl: Simulate two dimensional turbulence (barotropic quasi-geostrophic flow with beta=0) above topography.\nexamples/singlelayerqg_decaying_barotropic_equivalentbarotropic.jl: Simulate two dimensional turbulence (beta=0) with both infinite and finite Rossby radius of deformation and compares the evolution of the two.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"EditURL = \"../../../examples/twodnavierstokes_stochasticforcing_budgets.jl\"","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#twodnavierstokes_stochasticforcing_budgets_example","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"A simulation of forced-dissipative two-dimensional turbulence. We solve the two-dimensional vorticity equation with stochastic excitation and dissipation in the form of linear drag and hyperviscosity. As a demonstration, we compute how each of the forcing and dissipation terms contribute to the energy and the enstrophy budgets.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Install-dependencies","page":"2D forced-dissipative turbulence budgets","title":"Install dependencies","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"using Pkg\npkg\"add GeophysicalFlows, CUDA, Random, Printf, CairoMakie\"","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Let's-begin","page":"2D forced-dissipative turbulence budgets","title":"Let's begin","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"using GeophysicalFlows, CUDA, Random, Printf, CairoMakie\n\nparsevalsum = FourierFlows.parsevalsum\nrecord = CairoMakie.record                # disambiguate between CairoMakie.record and CUDA.record","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Choosing-a-device:-CPU-or-GPU","page":"2D forced-dissipative turbulence budgets","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Numerical,-domain,-and-simulation-parameters","page":"2D forced-dissipative turbulence budgets","title":"Numerical, domain, and simulation parameters","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"First, we pick some numerical and physical parameters for our model.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":" n, L  = 256, 2π              # grid resolution and domain length\n ν, nν = 2e-7, 2              # hyperviscosity coefficient and hyperviscosity order\n μ, nμ = 1e-1, 0              # linear drag coefficient\ndt, tf = 0.005, 0.2 / μ       # timestep and final time\n    nt = round(Int, tf / dt)  # total timesteps\n    ns = 4                    # how many intermediate times we want to plot","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Forcing","page":"2D forced-dissipative turbulence budgets","title":"Forcing","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"We force the vorticity equation with stochastic excitation that is delta-correlated in time and while spatially homogeneously and isotropically correlated. The forcing has a spectrum with power in a ring in wavenumber space of radius k_f (forcing_wavenumber) and width δ_f (forcing_bandwidth), and it injects energy per unit area and per unit time equal to varepsilon. That is, the forcing covariance spectrum is proportional to exp-(bmk - k_f)^2  (2 δ_f^2).","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"forcing_wavenumber = 14.0 * 2π/L  # the forcing wavenumber, `k_f`, for a spectrum that is a ring in wavenumber space\nforcing_bandwidth  = 1.5  * 2π/L  # the width of the forcing spectrum, `δ_f`\nε = 0.1                           # energy input rate by the forcing\n\ngrid = TwoDGrid(dev; nx=n, Lx=L)\n\nK = @. sqrt(grid.Krsq)             # a 2D array with the total wavenumber\n\nforcing_spectrum = @. exp(-(K - forcing_wavenumber)^2 / (2 * forcing_bandwidth^2))\n@CUDA.allowscalar forcing_spectrum[grid.Krsq .== 0] .= 0 # ensure forcing has zero domain-average\n\nε0 = parsevalsum(forcing_spectrum .* grid.invKrsq / 2, grid) / (grid.Lx * grid.Ly)\n@. forcing_spectrum *= ε/ε0        # normalize forcing to inject energy at rate ε","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"We reset of the random number generator for reproducibility","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"if dev==CPU(); Random.seed!(1234); else; CUDA.seed!(1234); end","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"Next we construct function calcF! that computes a forcing realization every timestep. First we make sure that if dev=GPU(), then CUDA.rand() function is called for random numbers uniformly distributed between 0 and 1.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"random_uniform = dev==CPU() ? rand : CUDA.rand\n\nfunction calcF!(Fh, sol, t, clock, vars, params, grid)\n  T = eltype(grid)\n  @. Fh = sqrt(forcing_spectrum) * cis(2π * random_uniform(T)) / sqrt(clock.dt)\n\n  return nothing\nend","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Problem-setup","page":"2D forced-dissipative turbulence budgets","title":"Problem setup","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"We initialize a Problem by providing a set of keyword arguments. The stepper keyword defines the time-stepper to be used.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"prob = TwoDNavierStokes.Problem(dev; nx=n, Lx=L, ν, nν, μ, nμ, dt, stepper=\"ETDRK4\",\n                                calcF=calcF!, stochastic=true)","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"Define some shortcuts for convenience.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"sol, clock, vars, params, grid = prob.sol, prob.clock, prob.vars, prob.params, prob.grid\n\nx,  y  = grid.x,  grid.y\nLx, Ly = grid.Lx, grid.Ly","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"First let's see how a forcing realization looks like. Function calcF!() computes the forcing in Fourier space and saves it into variable vars.Fh, so we first need to go back to physical space.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when the variable lives on the GPU.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"calcF!(vars.Fh, sol, 0.0, clock, vars, params, grid)\n\nfig = Figure()\n\nax = Axis(fig[1, 1],\n          xlabel = \"x\",\n          ylabel = \"y\",\n          aspect = 1,\n          title = \"a forcing realization\",\n          limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\nheatmap!(ax, x, y, Array(irfft(vars.Fh, grid.nx));\n         colormap = :balance, colorrange = (-200, 200))\n\nfig","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Setting-initial-conditions","page":"2D forced-dissipative turbulence budgets","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"Our initial condition is a fluid at rest.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"TwoDNavierStokes.set_ζ!(prob, device_array(dev)(zeros(grid.nx, grid.ny)))","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Diagnostics","page":"2D forced-dissipative turbulence budgets","title":"Diagnostics","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"Create Diagnostics; the diagnostics are aimed to probe the energy and enstrophy budgets.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"E  = Diagnostic(TwoDNavierStokes.energy,                               prob, nsteps=nt) # energy\nRᵋ = Diagnostic(TwoDNavierStokes.energy_dissipation_hypoviscosity,     prob, nsteps=nt) # energy dissipation by drag μ\nDᵋ = Diagnostic(TwoDNavierStokes.energy_dissipation_hyperviscosity,    prob, nsteps=nt) # energy dissipation by drag μ\nWᵋ = Diagnostic(TwoDNavierStokes.energy_work,                          prob, nsteps=nt) # energy work input by forcing\nZ  = Diagnostic(TwoDNavierStokes.enstrophy,                            prob, nsteps=nt) # enstrophy\nRᶻ = Diagnostic(TwoDNavierStokes.enstrophy_dissipation_hypoviscosity,  prob, nsteps=nt) # enstrophy dissipation by drag μ\nDᶻ = Diagnostic(TwoDNavierStokes.enstrophy_dissipation_hyperviscosity, prob, nsteps=nt) # enstrophy dissipation by drag μ\nWᶻ = Diagnostic(TwoDNavierStokes.enstrophy_work,                       prob, nsteps=nt) # enstrophy work input by forcing\ndiags = [E, Dᵋ, Wᵋ, Rᵋ, Z, Dᶻ, Wᶻ, Rᶻ] # a list of Diagnostics passed to `stepforward!` will  be updated every timestep.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Time-stepping-the-Problem-forward","page":"2D forced-dissipative turbulence budgets","title":"Time-stepping the Problem forward","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"We step the Problem forward in time.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"startwalltime = time()\nfor i = 1:ns\n  stepforward!(prob, diags, round(Int, nt/ns))\n\n  TwoDNavierStokes.updatevars!(prob)\n\n  cfl = clock.dt * maximum([maximum(vars.u) / grid.dx, maximum(vars.v) / grid.dy])\n\n  log = @sprintf(\"step: %04d, t: %.1f, cfl: %.3f, walltime: %.2f min\", clock.step, clock.t,\n        cfl, (time()-startwalltime)/60)\n\n  println(log)\nend","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"step: 0100, t: 0.5, cfl: 0.168, walltime: 0.01 min\nstep: 0200, t: 1.0, cfl: 0.238, walltime: 0.03 min\nstep: 0300, t: 1.5, cfl: 0.304, walltime: 0.04 min\nstep: 0400, t: 2.0, cfl: 0.301, walltime: 0.05 min\n","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/#Plot","page":"2D forced-dissipative turbulence budgets","title":"Plot","text":"","category":"section"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"Now let's see the final snapshot of the vorticity.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"fig = Figure(resolution = (400, 400))\n\nax = Axis(fig[1, 1];\n          xlabel = \"x\",\n          ylabel = \"y\",\n          title = \"∇²ψ(x, y, μt=\" * @sprintf(\"%.2f\", μ * clock.t) * \")\",\n          aspect = 1,\n          limits = ((-L/2, L/2), (-L/2, L/2)))\n\nheatmap!(ax, x, y, Array(vars.ζ);\n         colormap = :viridis, colorrange = (-25, 25))\n\nfig","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"And finally, we plot the evolution of the energy and enstrophy diagnostics and all terms involved in the energy and enstrophy budgets. Last, we also check (by plotting) whether the energy and enstrophy budgets are accurately computed, e.g., mathrmdEmathrmdt = W^varepsilon - R^varepsilon - D^varepsilon.","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"sol, clock, vars, params, grid = prob.sol, prob.clock, prob.vars, prob.params, prob.grid\n\nTwoDNavierStokes.updatevars!(prob)\n\nE, Dᵋ, Wᵋ, Rᵋ, Z, Dᶻ, Wᶻ, Rᶻ = diags\n\nclocktime = round(μ * clock.t, digits=2)\n\ndEdt_numerical = (E[2:E.i] - E[1:E.i-1]) / clock.dt # numerical first-order approximation of energy tendency\ndZdt_numerical = (Z[2:Z.i] - Z[1:Z.i-1]) / clock.dt # numerical first-order approximation of enstrophy tendency\n\ndEdt_computed = Wᵋ[2:E.i] + Dᵋ[1:E.i-1] + Rᵋ[1:E.i-1]\ndZdt_computed = Wᶻ[2:Z.i] + Dᶻ[1:Z.i-1] + Rᶻ[1:Z.i-1]\n\nresidual_E = dEdt_computed - dEdt_numerical\nresidual_Z = dZdt_computed - dZdt_numerical\n\nεᶻ = parsevalsum(forcing_spectrum / 2, grid) / (grid.Lx * grid.Ly)\n\nt = E.t[2:E.i]\n\nfig = Figure(resolution = (800, 1100))\n\naxis_kwargs = (xlabel = \"μ t\", )\n\nax1E = Axis(fig[1, 1]; ylabel = \"energy sources/sinks\", axis_kwargs...)\nax2E = Axis(fig[3, 1]; ylabel = \"dE/dt\", axis_kwargs...)\nax3E = Axis(fig[5, 1]; axis_kwargs...)\n\nax1Z = Axis(fig[1, 2]; axis_kwargs...)\nax2Z = Axis(fig[3, 2]; axis_kwargs...)\nax3Z = Axis(fig[5, 2]; axis_kwargs...)\n\nhWᵋ = lines!(ax1E, t, Wᵋ[2:E.i];   linestyle = :solid)\nhε  = lines!(ax1E, t, ε .+ 0t;     linestyle = :dash)\nhDᵋ = lines!(ax1E, t, Dᵋ[1:E.i-1]; linestyle = :solid)\nhRᵋ = lines!(ax1E, t, Rᵋ[1:E.i-1]; linestyle = :solid)\n\nLegend(fig[2, 1],\n       [hWᵋ, hε, hDᵋ, hRᵋ],\n       [\"energy work, Wᵋ\", \"ensemble mean energy work, <Wᵋ>\", \"dissipation, Dᵋ\", \"drag, Rᵋ = - 2μE\"])\n\nhc = lines!(ax2E, t, dEdt_computed; linestyle = :solid)\nhn = lines!(ax2E, t, dEdt_numerical; linestyle = :dash)\n\nLegend(fig[4, 1],\n       [hc, hn],\n       [\"computed Wᵋ-Dᵋ\", \"numerical dE/dt\"])\n\nhr = lines!(ax3E, t, residual_E)\n\nLegend(fig[6, 1],\n       [hr],\n       [\"residual\"])\n\nhWᶻ = lines!(ax1Z, t, Wᶻ[2:Z.i];  linestyle = :solid)\nhεᶻ = lines!(ax1Z, t, εᶻ .+ 0t;    linestyle = :dash)\nhDᶻ = lines!(ax1Z, t, Dᶻ[1:Z.i-1]; linestyle = :solid)\nhRᶻ = lines!(ax1Z, t, Rᶻ[1:Z.i-1]; linestyle = :solid)\n\nLegend(fig[2, 2],\n       [hWᶻ, hεᶻ, hDᶻ, hRᶻ],\n       [\"enstrophy work, Wᶻ\", \"ensemble mean enstophy work, <Wᶻ>\", \"dissipation, Dᶻ\", \"drag, Rᶻ = - 2μZ\"])\n\nhcᶻ = lines!(ax2Z, t, dZdt_computed; linestyle = :solid)\nhnᶻ = lines!(ax2Z, t, dZdt_numerical; linestyle = :dash)\n\nLegend(fig[4, 2],\n       [hcᶻ, hnᶻ],\n       [\"computed Wᶻ-Dᶻ\", \"numerical dZ/dt\"])\n\nhrᶻ = lines!(ax3Z, t, residual_Z)\n\nLegend(fig[6, 2],\n       [hr],\n       [\"residual\"])\n\nfig","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"(Image: )","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"","category":"page"},{"location":"literated/twodnavierstokes_stochasticforcing_budgets/","page":"2D forced-dissipative turbulence budgets","title":"2D forced-dissipative turbulence budgets","text":"This page was generated using Literate.jl.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"EditURL = \"../../../examples/singlelayerqg_decaying_barotropic_equivalentbarotropic.jl\"","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/#singlelayerqg_decaying_barotropic_equivalentbarotropic_example","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"We use here the SingleLayerQG module to simulate decaying two-dimensional turbulence and investigate how does a finite Rossby radius of deformation affects its evolution.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/#Install-dependencies","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"Install dependencies","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"using Pkg\npkg\"add GeophysicalFlows, Printf, Random, CairoMakie\"","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/#Let's-begin","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"Let's begin","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"using GeophysicalFlows, Printf, Random, CairoMakie\n\nusing GeophysicalFlows: peakedisotropicspectrum\nusing LinearAlgebra: ldiv!\nusing Random: seed!","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/#Choosing-a-device:-CPU-or-GPU","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/#Numerical,-domain,-and-simulation-parameters","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"Numerical, domain, and simulation parameters","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"First, we pick some numerical and physical parameters for our model.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"n, L  = 128, 2π             # grid resolution and domain length\ndeformation_radius = 0.35   # the deformation radius\n\n# Then we pick the time-stepper parameters\n    dt = 1e-2  # timestep\nnsteps = 4000  # total number of steps\n nsubs = 20    # number of steps between each plot","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/#Problem-setup","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"Problem setup","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"We initialize two problems by providing a set of keyword arguments to the Problem constructor. The two problems are otherwise the same, except one has an infinite deformation radius, prob_bqg, and the other has finite deformation radius, prob_eqbqg.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"For both problems we use stepper = \"FilteredRK4\". Filtered timesteppers apply a wavenumber-filter at every time-step that removes enstrophy at high wavenumbers and, thereby, stabilize the problem, despite that we use the default viscosity coefficient ν=0. Thus, we choose not to do any dealiasing by providing aliased_fraction=0.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"stepper=\"FilteredRK4\"\n\nprob_bqg = SingleLayerQG.Problem(dev; nx=n, Lx=L, dt, stepper, aliased_fraction=0)\nprob_eqbqg = SingleLayerQG.Problem(dev; nx=n, Lx=L, deformation_radius, dt, stepper, aliased_fraction=0)","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/#Setting-initial-conditions","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"For initial condition we construct a relative vorticity with energy most energy around total wavenumber k_0.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"seed!(1234)\nk₀, E₀ = 6, 0.5\n∇²ψ₀ = peakedisotropicspectrum(prob_bqg.grid, k₀, E₀, mask=prob_bqg.timestepper.filter)","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"SingleLayerQG allows us to set up the initial q for each problem via set_q!() function. To initialize both prob_bqg and prob_eqbqg with the same flow, we first use function SingleLayerQG.streamfunctionfrompv! to get the streamfunction that corresponds to the relative vorticity we computed above. This works in the purely barotropic problem, prob_bqg since in that case the QGPV is simply the relative vorticity.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"∇²ψ₀h = rfft(∇²ψ₀)\nψ₀h = @. 0 * ∇²ψ₀h\nSingleLayerQG.streamfunctionfrompv!(ψ₀h, ∇²ψ₀h, prob_bqg.params, prob_bqg.grid)","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"and then use the streamfunction to compute the corresponding q_0 for each problem,","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"q₀_bqg   = irfft(-prob_bqg.grid.Krsq .* ψ₀h, prob_bqg.grid.nx)\nq₀_eqbqg = irfft(-(prob_eqbqg.grid.Krsq .+ 1/prob_eqbqg.params.deformation_radius^2) .* ψ₀h, prob_bqg.grid.nx)","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"Now we can initialize our problems with the same flow.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"SingleLayerQG.set_q!(prob_bqg, q₀_bqg)\nSingleLayerQG.set_q!(prob_eqbqg, q₀_eqbqg)","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"Let's plot the initial vorticity field for each problem. Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when vars live on the GPU.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"function relativevorticity(prob)\n  vars, grid = prob.vars, prob.grid\n\n  ldiv!(vars.q, grid.rfftplan, - grid.Krsq .* vars.ψh)\n\n  return vars.q\nend\n\nx,  y  = prob_bqg.grid.x,  prob_bqg.grid.y\nLx, Ly = prob_bqg.grid.Lx, prob_bqg.grid.Ly\n\nfig = Figure(resolution=(800, 380))\n\naxis_kwargs = (xlabel = \"x\",\n               ylabel = \"y\",\n               aspect = 1,\n               limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\nt_bqg = Observable(prob_bqg.clock.t)\nt_eqbqg = Observable(prob_eqbqg.clock.t)\n\ntitle_bqg = @lift \"barotropic\\n ∇²ψ, t=\" * @sprintf(\"%.2f\", $t_bqg)\ntitle_eqbqg = @lift \"equivalent barotropic; deformation radius: \" * @sprintf(\"%.2f\", prob_eqbqg.params.deformation_radius) * \"\\n ∇²ψ, t=\" * @sprintf(\"%.2f\", $t_eqbqg)\n\nax1 = Axis(fig[1, 1]; title = title_bqg, axis_kwargs...)\nax2 = Axis(fig[1, 2]; title = title_eqbqg, axis_kwargs...)\n\nζ_bqg = Observable(Array(relativevorticity(prob_bqg)))\nζ_eqbqg = Observable(Array(relativevorticity(prob_eqbqg)))\n\nheatmap!(ax1, x, y, ζ_bqg;\n         colormap = :balance, colorrange = (-40, 40))\n\nheatmap!(ax2, x, y, ζ_eqbqg;\n         colormap = :balance, colorrange = (-40, 40))\n\nfig","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/#Time-stepping-the-Problem-forward","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"Time-stepping the Problem forward","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"Now we time-step both problems forward and animate the relative vorticity in each case.","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"startwalltime = time()\n\ncfl(prob) = prob.clock.dt * maximum([maximum(prob.vars.u) / prob.grid.dx, maximum(prob.vars.v) / prob.grid.dy])\n\nrecord(fig, \"singlelayerqg_barotropic_equivalentbarotropic.mp4\", 0:Int(nsteps/nsubs), framerate = 18) do j\n  if j % (1000 / nsubs) == 0\n    log_bqg = @sprintf(\"barotropic; step: %04d, t: %d, cfl: %.2f, walltime: %.2f min\",\n        prob_bqg.clock.step, prob_bqg.clock.t, cfl(prob_bqg), (time()-startwalltime)/60)\n    println(log_bqg)\n\n    log_eqbqg = @sprintf(\"equivalent barotropic; step: %04d, t: %d, cfl: %.2f, walltime: %.2f min\",\n        prob_eqbqg.clock.step, prob_eqbqg.clock.t, cfl(prob_eqbqg), (time()-startwalltime)/60)\n    println(log_eqbqg)\n  end\n\n  stepforward!(prob_bqg, nsubs)\n  SingleLayerQG.updatevars!(prob_bqg)\n\n  stepforward!(prob_eqbqg, nsubs)\n  SingleLayerQG.updatevars!(prob_eqbqg)\n\n  t_bqg[] = prob_bqg.clock.t\n  t_eqbqg[] = prob_eqbqg.clock.t\n  ζ_bqg[] = relativevorticity(prob_bqg)\n  ζ_eqbqg[] = relativevorticity(prob_eqbqg)\nend","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"barotropic; step: 0000, t: 0, cfl: 0.53, walltime: 0.00 min\nequivalent barotropic; step: 0000, t: 0, cfl: 0.53, walltime: 0.00 min\nbarotropic; step: 1000, t: 10, cfl: 0.46, walltime: 0.07 min\nequivalent barotropic; step: 1000, t: 10, cfl: 0.47, walltime: 0.07 min\nbarotropic; step: 2000, t: 20, cfl: 0.48, walltime: 0.14 min\nequivalent barotropic; step: 2000, t: 20, cfl: 0.36, walltime: 0.14 min\nbarotropic; step: 3000, t: 30, cfl: 0.47, walltime: 0.20 min\nequivalent barotropic; step: 3000, t: 30, cfl: 0.35, walltime: 0.20 min\nbarotropic; step: 4000, t: 40, cfl: 0.57, walltime: 0.27 min\nequivalent barotropic; step: 4000, t: 40, cfl: 0.36, walltime: 0.27 min\n","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"","category":"page"},{"location":"literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/","page":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","title":"SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation","text":"This page was generated using Literate.jl.","category":"page"},{"location":"visualize/#Visualize-output","page":"Visualize output","title":"Visualize output","text":"","category":"section"},{"location":"visualize/","page":"Visualize output","title":"Visualize output","text":"In the examples we use Makie.jl for plotting.","category":"page"},{"location":"visualize/","page":"Visualize output","title":"Visualize output","text":"Makie comes with a few backends. In the documented examples we use CairoMakie since this backend works well on headless devices, that is, devices without monitor. Since the documentation is automatically built via GitHub actions the CairoMakie backend is necessary. Users that run GeophysicalFlows.jl on devices with a monitor might want to change to GLMakie that displays figures in an interactive window.","category":"page"},{"location":"visualize/","page":"Visualize output","title":"Visualize output","text":"In GeophysicalFlows.jl simulations, we can either visualize the fields on-the-fly as the problem is stepped forward or we can save output onto a .jld2 file and after simulation is done load the output and visualize it. Most examples do the former. For a demonstration for how one can save output and load later to process and visualize it have a look at the SingeLayerQG beta-plane forced-dissipative example. For more information about saving output to .jld2 files, files see the Output section in FourierFlows.jl Documentation might be useful.","category":"page"},{"location":"lib/types/#Private-types","page":"Private types","title":"Private types","text":"","category":"section"},{"location":"lib/types/#TwoDNavierStokes","page":"Private types","title":"TwoDNavierStokes","text":"","category":"section"},{"location":"lib/types/","page":"Private types","title":"Private types","text":"GeophysicalFlows.TwoDNavierStokes.Params\nGeophysicalFlows.TwoDNavierStokes.Vars\nGeophysicalFlows.TwoDNavierStokes.DecayingVars\nGeophysicalFlows.TwoDNavierStokes.ForcedVars\nGeophysicalFlows.TwoDNavierStokes.StochasticForcedVars","category":"page"},{"location":"lib/types/#GeophysicalFlows.TwoDNavierStokes.Params","page":"Private types","title":"GeophysicalFlows.TwoDNavierStokes.Params","text":"struct Params{T} <: AbstractParams\n\nThe parameters for a two-dimensional Navier-Stokes problem:\n\nν::Any: small-scale (hyper)-viscosity coefficient\nnν::Int64: (hyper)-viscosity order, nν 1\nμ::Any: large-scale (hypo)-viscosity coefficient\nnμ::Int64: (hypo)-viscosity order, nμ 0\ncalcF!::Function: function that calculates the Fourier transform of the forcing, F\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.TwoDNavierStokes.Vars","page":"Private types","title":"GeophysicalFlows.TwoDNavierStokes.Vars","text":"struct Vars{Aphys, Atrans, F, P} <: TwoDNavierStokesVars\n\nThe variables for two-dimensional Navier-Stokes problem:\n\nζ: relative vorticity\nu: x-component of velocity\nv: y-component of velocity\nζh: Fourier transform of relative vorticity\nuh: Fourier transform of x-component of velocity\nvh: Fourier transform of y-component of velocity\nFh: Fourier transform of forcing\nprevsol: sol at previous time-step\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.TwoDNavierStokes.DecayingVars","page":"Private types","title":"GeophysicalFlows.TwoDNavierStokes.DecayingVars","text":"DecayingVars(dev, grid)\n\nReturn the variables for unforced two-dimensional Navier-Stokes problem on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.TwoDNavierStokes.ForcedVars","page":"Private types","title":"GeophysicalFlows.TwoDNavierStokes.ForcedVars","text":"ForcedVars(grid)\n\nReturn the variables for forced two-dimensional Navier-Stokes on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.TwoDNavierStokes.StochasticForcedVars","page":"Private types","title":"GeophysicalFlows.TwoDNavierStokes.StochasticForcedVars","text":"StochasticForcedVars(grid)\n\nReturn the variables for stochastically forced two-dimensional Navier-Stokes on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#SingleLayerQG","page":"Private types","title":"SingleLayerQG","text":"","category":"section"},{"location":"lib/types/","page":"Private types","title":"Private types","text":"GeophysicalFlows.SingleLayerQG.Params\nGeophysicalFlows.SingleLayerQG.BarotropicQGParams\nGeophysicalFlows.SingleLayerQG.EquivalentBarotropicQGParams\nGeophysicalFlows.SingleLayerQG.Vars\nGeophysicalFlows.SingleLayerQG.DecayingVars\nGeophysicalFlows.SingleLayerQG.ForcedVars\nGeophysicalFlows.SingleLayerQG.StochasticForcedVars","category":"page"},{"location":"lib/types/#GeophysicalFlows.SingleLayerQG.Params","page":"Private types","title":"GeophysicalFlows.SingleLayerQG.Params","text":"struct Params{T, Aphys, Atrans, ℓ} <: SingleLayerQGParams\n\nThe parameters for the SingleLayerQG problem.\n\nβ::Any: planetary vorticity y-gradient\ndeformation_radius::Any: Rossby radius of deformation\neta::Any: topographic potential vorticity\netah::Any: Fourier transform of topographic potential vorticity\nμ::Any: linear drag coefficient\nν::Any: small-scale (hyper)-viscosity coefficient\nnν::Int64: (hyper)-viscosity order, nν 1\ncalcF!::Function: function that calculates the Fourier transform of the forcing, F\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.SingleLayerQG.BarotropicQGParams","page":"Private types","title":"GeophysicalFlows.SingleLayerQG.BarotropicQGParams","text":"BarotropicQGParams(grid, β, eta, μ, ν, nν, calcF)\n\nReturn the parameters for a Barotropic QG problem (i.e., with infinite Rossby radius of deformation).\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.SingleLayerQG.EquivalentBarotropicQGParams","page":"Private types","title":"GeophysicalFlows.SingleLayerQG.EquivalentBarotropicQGParams","text":"EquivalentBarotropicQGParams(grid, β, deformation_radius, eta, μ, ν, nν, calcF)\n\nReturn the parameters for an Equivalent Barotropic QG problem (i.e., with finite Rossby radius of deformation).\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.SingleLayerQG.Vars","page":"Private types","title":"GeophysicalFlows.SingleLayerQG.Vars","text":"struct Vars{Aphys, Atrans, F, P} <: SingleLayerQGVars\n\nThe variables for SingleLayer QG:\n\nq: relative vorticity (+ vortex stretching)\nψ: streamfunction\nu: x-component of velocity\nv: y-component of velocity\nqh: Fourier transform of relative vorticity (+ vortex stretching)\nψh: Fourier transform of streamfunction\nuh: Fourier transform of x-component of velocity\nvh: Fourier transform of y-component of velocity\nFh: Fourier transform of forcing\nprevsol: sol at previous time-step\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.SingleLayerQG.DecayingVars","page":"Private types","title":"GeophysicalFlows.SingleLayerQG.DecayingVars","text":"DecayingVars(grid)\n\nReturn the variables for unforced single-layer QG problem on grid.\n\n\n\n\n\n","category":"function"},{"location":"lib/types/#GeophysicalFlows.SingleLayerQG.ForcedVars","page":"Private types","title":"GeophysicalFlows.SingleLayerQG.ForcedVars","text":"ForcedVars(grid)\n\nReturn the variables for forced single-layer QG problem on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.SingleLayerQG.StochasticForcedVars","page":"Private types","title":"GeophysicalFlows.SingleLayerQG.StochasticForcedVars","text":"StochasticForcedVars(grid)\n\nReturn the variables for stochastically forced barotropic QG problem on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#MultiLayerQG","page":"Private types","title":"MultiLayerQG","text":"","category":"section"},{"location":"lib/types/","page":"Private types","title":"Private types","text":"GeophysicalFlows.MultiLayerQG.Params\nGeophysicalFlows.MultiLayerQG.SingleLayerParams\nGeophysicalFlows.MultiLayerQG.TwoLayerParams\nGeophysicalFlows.MultiLayerQG.Vars\nGeophysicalFlows.MultiLayerQG.DecayingVars\nGeophysicalFlows.MultiLayerQG.ForcedVars\nGeophysicalFlows.MultiLayerQG.StochasticForcedVars","category":"page"},{"location":"lib/types/#GeophysicalFlows.MultiLayerQG.Params","page":"Private types","title":"GeophysicalFlows.MultiLayerQG.Params","text":"struct Params{T, Aphys3D, Aphys2D, Atrans4D, Trfft} <: AbstractParams\n\nThe parameters for the MultiLayerQG problem.\n\nnlayers::Int64: number of fluid layers\ng::Any: gravitational constant\nf₀::Any: constant planetary vorticity\nβ::Any: planetary vorticity y-gradient\nρ::Tuple: array with density of each fluid layer\nH::Tuple: array with rest height of each fluid layer\nU::Any: array with imposed constant zonal flow U(y) in each fluid layer\neta::Any: array containing the topographic PV\ntopographic_pv_gradient::Tuple{T, T} where T: tuple containing the (x y) components of topographic PV large-scale gradient\nμ::Any: linear bottom drag coefficient\nν::Any: small-scale (hyper)-viscosity coefficient\nnν::Int64: (hyper)-viscosity order, nν 1\ncalcFq!::Function: function that calculates the Fourier transform of the forcing, F\ng′::Tuple: array with the reduced gravity constants for each fluid interface\nQx::Any: array containing x-gradient of PV due to eta in each fluid layer\nQy::Any: array containing y-gradient of PV due to β, U, and topographic PV in each fluid layer\nS::Any: array containing coeffients for getting PV from streamfunction\nS⁻¹::Any: array containing coeffients for inverting PV to streamfunction\nrfftplan::Any: rfft plan for FFTs\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.MultiLayerQG.SingleLayerParams","page":"Private types","title":"GeophysicalFlows.MultiLayerQG.SingleLayerParams","text":"struct SingleLayerParams{T, Aphys3D, Aphys2D, Trfft} <: AbstractParams\n\nThe parameters for the a single-layer MultiLayerQG problem.\n\nβ::Any: planetary vorticity y-gradient\nU::Any: array with imposed constant zonal flow U(y)\neta::Any: array containing the periodic component of the topographic PV\ntopographic_pv_gradient::Tuple{T, T} where T: tuple containing the (x y) components of topographic PV large-scale gradient\nμ::Any: linear drag coefficient\nν::Any: small-scale (hyper)-viscosity coefficient\nnν::Int64: (hyper)-viscosity order, nν 1\ncalcFq!::Function: function that calculates the Fourier transform of the forcing, F\nQx::Any: array containing x-gradient of PV due to topographic PV\nQy::Any: array containing y-gradient of PV due to β, U, and topographic PV\nrfftplan::Any: rfft plan for FFTs\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.MultiLayerQG.TwoLayerParams","page":"Private types","title":"GeophysicalFlows.MultiLayerQG.TwoLayerParams","text":"struct TwoLayerParams{T, Aphys3D, Aphys2D, Trfft} <: AbstractParams\n\nThe parameters for the a two-layer MultiLayerQG problem.\n\ng::Any: gravitational constant\nf₀::Any: constant planetary vorticity\nβ::Any: planetary vorticity y-gradient\nρ::Tuple: array with density of each fluid layer\nH::Tuple: tuple with rest height of each fluid layer\nU::Any: array with imposed constant zonal flow U(y) in each fluid layer\neta::Any: array containing periodic component of the topographic PV\ntopographic_pv_gradient::Tuple{T, T} where T: tuple containing the (x y) components of topographic PV large-scale gradient\nμ::Any: linear bottom drag coefficient\nν::Any: small-scale (hyper)-viscosity coefficient\nnν::Int64: (hyper)-viscosity order, nν 1\ncalcFq!::Function: function that calculates the Fourier transform of the forcing, F\ng′::Any: the reduced gravity constants for the fluid interface\nQx::Any: array containing x-gradient of PV due to topographic PV in each fluid layer\nQy::Any: array containing y-gradient of PV due to β, U, and topographic PV in each fluid layer\nrfftplan::Any: rfft plan for FFTs\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.MultiLayerQG.Vars","page":"Private types","title":"GeophysicalFlows.MultiLayerQG.Vars","text":"struct Vars{Aphys, Atrans, F, P} <: AbstractVars\n\nThe variables for multi-layer QG problem.\n\nq: relative vorticity + vortex stretching\nψ: streamfunction\nu: x-component of velocity\nv: y-component of velocity\nqh: Fourier transform of relative vorticity + vortex stretching\nψh: Fourier transform of streamfunction\nuh: Fourier transform of x-component of velocity\nvh: Fourier transform of y-component of velocity\nFqh: Fourier transform of forcing\nprevsol: sol at previous time-step\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.MultiLayerQG.DecayingVars","page":"Private types","title":"GeophysicalFlows.MultiLayerQG.DecayingVars","text":"DecayingVars(grid, params)\n\nReturn the variables for an unforced multi-layer QG problem with grid and params.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.MultiLayerQG.ForcedVars","page":"Private types","title":"GeophysicalFlows.MultiLayerQG.ForcedVars","text":"ForcedVars(grid, params)\n\nReturn the variables for a forced multi-layer QG problem with grid and params.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.MultiLayerQG.StochasticForcedVars","page":"Private types","title":"GeophysicalFlows.MultiLayerQG.StochasticForcedVars","text":"StochasticForcedVars(grid, params)\n\nReturn the variables for a forced multi-layer QG problem with grid and params.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#SurfaceQG","page":"Private types","title":"SurfaceQG","text":"","category":"section"},{"location":"lib/types/","page":"Private types","title":"Private types","text":"GeophysicalFlows.SurfaceQG.Params\nGeophysicalFlows.SurfaceQG.Vars\nGeophysicalFlows.SurfaceQG.DecayingVars\nGeophysicalFlows.SurfaceQG.ForcedVars\nGeophysicalFlows.SurfaceQG.StochasticForcedVars","category":"page"},{"location":"lib/types/#GeophysicalFlows.SurfaceQG.Params","page":"Private types","title":"GeophysicalFlows.SurfaceQG.Params","text":"Params{T}(ν, nν, calcF!)\n\nA struct containing the parameters for Surface QG dynamics. Included are:\n\nν::Any: buoyancy (hyper)-viscosity coefficient\nnν::Int64: buoyancy (hyper)-viscosity order\ncalcF!::Function: function that calculates the Fourier transform of the forcing, F\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.SurfaceQG.Vars","page":"Private types","title":"GeophysicalFlows.SurfaceQG.Vars","text":"Vars{Aphys, Atrans, F, P}(b, u, v, bh, uh, vh, Fh, prevsol)\n\nThe variables for surface QG problem:\n\nb: buoyancy\nu: x-component of velocity\nv: y-component of velocity\nbh: Fourier transform of buoyancy\nuh: Fourier transform of x-component of velocity\nvh: Fourier transform of y-component of velocity\nFh: Fourier transform of forcing\nprevsol: sol at previous time-step\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.SurfaceQG.DecayingVars","page":"Private types","title":"GeophysicalFlows.SurfaceQG.DecayingVars","text":"DecayingVars(grid)\n\nReturn the variables for unforced surface QG dynamics on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.SurfaceQG.ForcedVars","page":"Private types","title":"GeophysicalFlows.SurfaceQG.ForcedVars","text":"ForcedVars(grid)\n\nReturn the variables for forced surface QG dynamics on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.SurfaceQG.StochasticForcedVars","page":"Private types","title":"GeophysicalFlows.SurfaceQG.StochasticForcedVars","text":"StochasticForcedVars(grid)\n\nReturn the variables for stochastically forced surface QG dynamics on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#BarotropicQGQL","page":"Private types","title":"BarotropicQGQL","text":"","category":"section"},{"location":"lib/types/","page":"Private types","title":"Private types","text":"GeophysicalFlows.BarotropicQGQL.Params\nGeophysicalFlows.BarotropicQGQL.Vars\nGeophysicalFlows.BarotropicQGQL.DecayingVars\nGeophysicalFlows.BarotropicQGQL.ForcedVars\nGeophysicalFlows.BarotropicQGQL.StochasticForcedVars","category":"page"},{"location":"lib/types/#GeophysicalFlows.BarotropicQGQL.Params","page":"Private types","title":"GeophysicalFlows.BarotropicQGQL.Params","text":"Params{T, Aphys, Atrans}(β, eta, etah, μ, ν, nν, calcF!)\n\nA struct containing the parameters for a barotropic QL QG problem. Included are:\n\nβ::Any: planetary vorticity y-gradient\neta::Any: topographic potential vorticity\netah::Any: Fourier transform of topographic potential vorticity\nμ::Any: linear drag coefficient\nν::Any: small-scale (hyper)-viscosity coefficient\nnν::Int64: (hyper)-viscosity order, nν 1\ncalcF!::Function: function that calculates the Fourier transform of the forcing, F\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.BarotropicQGQL.Vars","page":"Private types","title":"GeophysicalFlows.BarotropicQGQL.Vars","text":"Vars{Aphys, Atrans, F, P}(u, v, U, uzeta, vzeta, zeta, Zeta, psi, Psi, N, NZ, uh, vh, Uh, zetah, Zetah, psih, Psih, Fh, prevsol)\n\nThe variables for barotropic QL QG:\n\nu: x-component of small-scale velocity\nv: y-component of small-scale velocity\nU: x-component of large-scale velocity\nuzeta: small-scale uζ\nvzeta: small-scale vζ\nzeta: small-scale relative vorticity\nZeta: large-scale relative vorticity\npsi: small-scale streamfunction\nPsi: large-scale streamfunction\nNz: small-scale nonlinear term\nNZ: large-scale nonlinear term\nuh: Fourier transform of x-component of small-scale velocity\nvh: Fourier transform of y-component of small-scale velocity\nUh: Fourier transform of x-component of large-scale velocity\nzetah: Fourier transform of small-scale relative vorticity\nZetah: Fourier transform of large-scale relative vorticity\npsih: Fourier transform of small-scale relative vorticity\nPsih: Fourier transform of large-scale relative vorticity\nFh: Fourier transform of forcing\nprevsol: sol at previous time-step\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.BarotropicQGQL.DecayingVars","page":"Private types","title":"GeophysicalFlows.BarotropicQGQL.DecayingVars","text":"DecayingVars(grid)\n\nReturn the variables for unforced two-dimensional quasi-linear barotropic QG problem on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.BarotropicQGQL.ForcedVars","page":"Private types","title":"GeophysicalFlows.BarotropicQGQL.ForcedVars","text":"ForcedVars(grid)\n\nReturn the variables for forced two-dimensional quasi-linear barotropic QG problem on grid.\n\n\n\n\n\n","category":"type"},{"location":"lib/types/#GeophysicalFlows.BarotropicQGQL.StochasticForcedVars","page":"Private types","title":"GeophysicalFlows.BarotropicQGQL.StochasticForcedVars","text":"StochasticForcedVars(grid)\n\nReturn the variables for stochastically forced two-dimensional quasi-linear barotropic QG problem  on grid.\n\n\n\n\n\n","category":"type"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"EditURL = \"../../../examples/singlelayerqg_betadecay.jl\"","category":"page"},{"location":"literated/singlelayerqg_betadecay/#singlelayerqg_betadecay_example","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"An example of decaying barotropic quasi-geostrophic turbulence on a beta plane.","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Install-dependencies","page":"Decaying barotropic QG beta-plane turbulence","title":"Install dependencies","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"using Pkg\npkg\"add GeophysicalFlows, CairoMakie, Printf, Statistics, Random\"","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Let's-begin","page":"Decaying barotropic QG beta-plane turbulence","title":"Let's begin","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"using GeophysicalFlows, CairoMakie, Printf, Random\n\nusing Statistics: mean","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Choosing-a-device:-CPU-or-GPU","page":"Decaying barotropic QG beta-plane turbulence","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Numerical-parameters-and-time-stepping-parameters","page":"Decaying barotropic QG beta-plane turbulence","title":"Numerical parameters and time-stepping parameters","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"      n = 128            # 2D resolution: n² grid points\nstepper = \"FilteredRK4\"  # timestepper\n     dt = 0.04           # timestep\n nsteps = 2000           # total number of time-steps\n nsubs  = 10             # number of time-steps for intermediate logging/plotting (nsteps must be multiple of nsubs)","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Physical-parameters","page":"Decaying barotropic QG beta-plane turbulence","title":"Physical parameters","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"L = 2π        # domain size\nβ = 10.0      # planetary PV gradient\nμ = 0.0       # bottom drag","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Problem-setup","page":"Decaying barotropic QG beta-plane turbulence","title":"Problem setup","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"We initialize a Problem by providing a set of keyword arguments. We use stepper = \"FilteredRK4\". Filtered timesteppers apply a wavenumber-filter at every time-step that removes enstrophy at high wavenumbers and, thereby, stabilize the problem, despite that we use the default viscosity coefficient ν=0. Thus, we choose not to do any dealiasing by providing aliased_fraction=0.","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"prob = SingleLayerQG.Problem(dev; nx=n, Lx=L, β, μ, dt, stepper, aliased_fraction=0)","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"and define some shortcuts","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"sol, clock, vars, params, grid = prob.sol, prob.clock, prob.vars, prob.params, prob.grid\nx, y = grid.x, grid.y","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Setting-initial-conditions","page":"Decaying barotropic QG beta-plane turbulence","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"Our initial condition consist of a flow that has power only at wavenumbers with 6  fracL2pi sqrtk_x^2 + k_y^2  10 and initial energy E_0. device_array() function returns the array type appropriate for the device, i.e., Array for dev = CPU() and CuArray for dev = GPU().","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"E₀ = 0.08 # energy of initial condition\n\nK = @. sqrt(grid.Krsq)                          # a 2D array with the total wavenumber\n\nRandom.seed!(1234)\nq₀h = device_array(dev)(randn(Complex{eltype(grid)}, size(sol)))\n@. q₀h = ifelse(K < 6  * 2π/L, 0, q₀h)\n@. q₀h = ifelse(K > 10 * 2π/L, 0, q₀h)\n@. q₀h[1, :] = 0    # remove any power from zonal wavenumber k=0\nq₀h *= sqrt(E₀ / SingleLayerQG.energy(q₀h, vars, params, grid)) # normalize q₀ to have energy E₀\nq₀ = irfft(q₀h, grid.nx)\n\nSingleLayerQG.set_q!(prob, q₀)","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"Let's plot the initial vorticity and streamfunction. Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when vars live on the GPU.","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"fig = Figure(resolution = (800, 360))\n\naxq = Axis(fig[1, 1];\n           xlabel = \"x\",\n           ylabel = \"y\",\n           title = \"initial vorticity ∂v/∂x-∂u/∂y\",\n           aspect = 1,\n           limits = ((-grid.Lx/2, grid.Lx/2), (-grid.Ly/2, grid.Ly/2))\n           )\n\naxψ = Axis(fig[1, 2];\n           xlabel = \"x\",\n           ylabel = \"y\",\n           title = \"initial streamfunction ψ\",\n           aspect = 1,\n           limits = ((-grid.Lx/2, grid.Lx/2), (-grid.Ly/2, grid.Ly/2))\n           )\n\nheatmap!(axq, x, y, Array(vars.q); colormap = :balance)\n\ncontourf!(axψ, x, y, Array(vars.ψ); colormap = :viridis)\n\nfig","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Diagnostics","page":"Decaying barotropic QG beta-plane turbulence","title":"Diagnostics","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"Create Diagnostics – energy and enstrophy functions are imported at the top.","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"E = Diagnostic(SingleLayerQG.energy, prob; nsteps)\nZ = Diagnostic(SingleLayerQG.enstrophy, prob; nsteps)\ndiags = [E, Z] # A list of Diagnostics types passed to \"stepforward!\" will  be updated every timestep.","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Output","page":"Decaying barotropic QG beta-plane turbulence","title":"Output","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"We choose folder for outputing .jld2 files and snapshots (.png files).","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"filepath = \".\"\nplotpath = \"./plots_decayingbetaturb\"\nplotname = \"snapshots\"\nfilename = joinpath(filepath, \"decayingbetaturb.jld2\")","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"Do some basic file management,","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"if isfile(filename); rm(filename); end\nif !isdir(plotpath); mkdir(plotpath); end","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"and then create Output.","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"get_sol(prob) = prob.sol # extracts the Fourier-transformed solution\nout = Output(prob, filename, (:sol, get_sol))","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Visualizing-the-simulation","page":"Decaying barotropic QG beta-plane turbulence","title":"Visualizing the simulation","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"We plot the vorticity and streamfunction and their corresponding zonal mean structure.","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"Lx, Ly = grid.Lx, grid.Ly\n\ntitle_q = Observable(@sprintf(\"vorticity, t = %.2f\", clock.t))\ntitle_ψ = \"streamfunction ψ\"\n\nfig = Figure(resolution=(800, 720))\n\naxis_kwargs = (xlabel = \"x\",\n               ylabel = \"y\",\n               aspect = 1,\n               limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\naxq = Axis(fig[1, 1]; title = title_q, axis_kwargs...)\n\naxψ = Axis(fig[2, 1]; title = title_ψ, axis_kwargs...)\n\naxq̄ = Axis(fig[1, 2],\n           xlabel = \"zonal mean vorticity\",\n           ylabel = \"y\",\n           aspect = 1,\n           limits = ((-2.1, 2.1), (-Ly/2, Ly/2)))\n\naxū = Axis(fig[2, 2],\n           xlabel = \"zonal mean u\",\n           ylabel = \"y\",\n           aspect = 1,\n           limits = ((-0.5, 0.5), (-Ly/2, Ly/2)))\n\nq  = Observable(Array(vars.q))\nψ  = Observable(Array(vars.ψ))\nq̄ₘ = Observable(Array(vec(mean(vars.q, dims=1))))\nūₘ = Observable(Array(vec(mean(vars.u, dims=1))))\n\nheatmap!(axq, x, y, q;\n         colormap = :balance, colorrange = (-12, 12))\n\nlevels = collect(range(-0.7, stop=0.7, length=20))\n\ncontourf!(axψ, x, y, ψ;\n         levels, colormap = :viridis, colorrange = (-0.35, 0.35))\ncontour!(axψ, x, y, ψ;\n         levels, color = :black)\n\nlines!(axq̄, q̄ₘ, y; linewidth = 3)\nlines!(axq̄, 0y, y; linewidth = 1, linestyle = :dash)\n\nlines!(axū, ūₘ, y; linewidth = 3)\nlines!(axū, 0y, y; lindewidth = 1, linestyle = :dash)\n\nfig","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Time-stepping-the-Problem-forward","page":"Decaying barotropic QG beta-plane turbulence","title":"Time-stepping the Problem forward","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"We step the Problem forward in time.","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"startwalltime = time()\n\nframes = 0:round(Int, nsteps / nsubs)\n\nrecord(fig, \"singlelayerqg_betadecay.mp4\", frames, framerate = 12) do j\n  if j % round(Int, nsteps/nsubs / 4) == 0\n    cfl = clock.dt * maximum([maximum(vars.u) / grid.dx, maximum(vars.v) / grid.dy])\n\n    log = @sprintf(\"step: %04d, t: %d, cfl: %.2f, E: %.4f, Q: %.4f, walltime: %.2f min\",\n      clock.step, clock.t, cfl, E.data[E.i], Z.data[Z.i], (time()-startwalltime)/60)\n\n    println(log)\n  end\n\n  q[] = vars.q\n  ψ[] = vars.ψ\n  q̄ₘ[] = vec(mean(vars.q, dims=1))\n  ūₘ[] = vec(mean(vars.u, dims=1))\n\n  title_q[] = @sprintf(\"vorticity, t = %.2f\", clock.t)\n\n  stepforward!(prob, diags, nsubs)\n  SingleLayerQG.updatevars!(prob)\nend","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"step: 0000, t: 0, cfl: 0.90, E: 0.0800, Q: 4.9303, walltime: 0.00 min\nstep: 0500, t: 20, cfl: 0.75, E: 0.0787, Q: 1.8418, walltime: 0.17 min\nstep: 1000, t: 40, cfl: 0.75, E: 0.0785, Q: 1.2191, walltime: 0.30 min\nstep: 1500, t: 60, cfl: 0.88, E: 0.0784, Q: 1.0377, walltime: 0.42 min\nstep: 2000, t: 80, cfl: 0.82, E: 0.0783, Q: 0.9599, walltime: 0.55 min\n","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_betadecay/#Save","page":"Decaying barotropic QG beta-plane turbulence","title":"Save","text":"","category":"section"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"Finally, we can save, e.g., the last snapshot via","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"savename = @sprintf(\"%s_%09d.png\", joinpath(plotpath, plotname), clock.step)\nsavefig(savename)","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"","category":"page"},{"location":"literated/singlelayerqg_betadecay/","page":"Decaying barotropic QG beta-plane turbulence","title":"Decaying barotropic QG beta-plane turbulence","text":"This page was generated using Literate.jl.","category":"page"},{"location":"modules/barotropicqgql/#BarotropicQGQL","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"","category":"section"},{"location":"modules/barotropicqgql/#Basic-Equations","page":"BarotropicQGQL","title":"Basic Equations","text":"","category":"section"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"This module solves the quasi-linear quasi-geostrophic barotropic vorticity equation on a beta  plane of variable fluid depth H - h(x y). Quasi-linear refers to the dynamics that neglects  the eddy–eddy interactions in the eddy evolution equation after an eddy–mean flow decomposition,  e.g., ","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"phi(x y t) = overlinephi(y t) + phi(x y t) ","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"where overline above denotes a zonal mean, overlinephi(y t) = int phi(x y t)  𝖽x  L_x, and prime denotes deviations from the zonal mean. This approximation is used in many process-model studies of zonation, e.g., Farrell and Ioannou (2003), Srinivasan and Young (2012), and Constantinou et al. (2014).","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"As in the SingleLayerQG module, the flow is obtained through a  streamfunction psi as (u v) = (-partial_y psi partial_x psi). All flow fields  can be obtained from the quasi-geostrophic potential vorticity (QGPV). Here, the QGPV is","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"underbracef_0 + beta y_textplanetary PV + underbracepartial_x v\n\t- partial_y u_textrelative vorticity + underbracefracf_0 hH_texttopographic PV ","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"The dynamical variable is the component of the vorticity of the flow normal to the plane of  motion, zeta equiv partial_x v - partial_y u = nabla^2 psi. Also, we denote the  topographic PV with eta equiv f_0 h  H. After we apply the eddy-mean flow decomposition  above, the QGPV dynamics are:","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"beginaligned\n\tpartial_t overlinezeta + mathsfJ(overlinepsi overlinezeta + overlineeta) + overlinemathsfJ(psi zeta + eta)  = underbrace- leftmu + nu(-1)^n_nu nabla^2n_nu\n\tright overlinezeta _textrmdissipation  \n\tpartial_t zeta  + mathsfJ(psi overlinezeta + overlineeta) + mathsfJ(overlinepsi zeta + eta) +  underbracemathsfJ(psi zeta + eta) - overlinemathsfJ(psi zeta + eta)_textrmEENL + beta partial_x psi = \n\t = underbrace-leftmu + nu(-1)^n_nu nabla^2n_nu right zeta_textrmdissipation + F \nendaligned","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"where mathsfJ(a b) = (partial_x a)(partial_y b) - (partial_y a)(partial_x b). On  the right hand side, F(x y t) is forcing (which is assumed to have zero zonal mean,  overlineF = 0), mu is linear drag, and nu is hyperviscosity. Plain old  viscosity corresponds to n_nu = 1.","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"Quasi-linear dynamics neglects the term eddy-eddy nonlinearity (EENL) term above.","category":"page"},{"location":"modules/barotropicqgql/#Implementation","page":"BarotropicQGQL","title":"Implementation","text":"","category":"section"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"The equation is time-stepped forward in Fourier space:","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"partial_t widehatzeta = - widehatmathsfJ(psi zeta + eta)^textrmQL + beta fraci k_x𝐤^2 widehatzeta - left ( mu + nu 𝐤^2n_nu right ) widehatzeta + widehatF ","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"The state variable sol is the Fourier transform of vorticity, ζh.","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"The Jacobian is computed in the conservative form: mathsfJ(f g) = partial_y   (partial_x f) g - partial_x  (partial_y f) g. The superscript QL on the Jacobian term  above denotes that triad interactions that correspond to the EENL term are removed.","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"The linear operator is constructed in Equation","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"GeophysicalFlows.BarotropicQGQL.Equation","category":"page"},{"location":"modules/barotropicqgql/#GeophysicalFlows.BarotropicQGQL.Equation","page":"BarotropicQGQL","title":"GeophysicalFlows.BarotropicQGQL.Equation","text":"Equation(params, grid)\n\nReturn the equation for two-dimensional barotropic QG QL problem with parameters params and  on grid. Linear operator L includes bottom drag μ, (hyper)-viscosity of order n_ν with coefficient ν and the β term:\n\nL = - μ - ν 𝐤^2 n_ν + i β k_x  𝐤² \n\nNonlinear term is computed via calcN! function.\n\n\n\n\n\n","category":"function"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"and the nonlinear terms are computed via","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"GeophysicalFlows.BarotropicQGQL.calcN!","category":"page"},{"location":"modules/barotropicqgql/#GeophysicalFlows.BarotropicQGQL.calcN!","page":"BarotropicQGQL","title":"GeophysicalFlows.BarotropicQGQL.calcN!","text":"calcN!(N, sol, t, clock, vars, params, grid)\n\nCalculate the nonlinear term, that is the advection term and the forcing,\n\nN = - widehat𝖩(ψ ζ + η)^mathrmQL + F \n\n\n\n\n\n","category":"function"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"which in turn calls calcN_advection!  and addforcing!.","category":"page"},{"location":"modules/barotropicqgql/#Parameters-and-Variables","page":"BarotropicQGQL","title":"Parameters and Variables","text":"","category":"section"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"All required parameters are included inside Params and all module variables are included inside Vars.","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"For the decaying case (no forcing, F = 0), variables are constructed with Vars. For the forced case (F ne 0) variables are constructed with either ForcedVars or StochasticForcedVars.","category":"page"},{"location":"modules/barotropicqgql/#Helper-functions","page":"BarotropicQGQL","title":"Helper functions","text":"","category":"section"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"GeophysicalFlows.BarotropicQGQL.updatevars!\nGeophysicalFlows.BarotropicQGQL.set_zeta!","category":"page"},{"location":"modules/barotropicqgql/#GeophysicalFlows.BarotropicQGQL.updatevars!","page":"BarotropicQGQL","title":"GeophysicalFlows.BarotropicQGQL.updatevars!","text":"updatevars!(sol, vars, params, grid)\nupdatevars!(prob)\n\nUpdate the vars of a problem prob that has grid and params with the solution in sol.\n\n\n\n\n\n","category":"function"},{"location":"modules/barotropicqgql/#GeophysicalFlows.BarotropicQGQL.set_zeta!","page":"BarotropicQGQL","title":"GeophysicalFlows.BarotropicQGQL.set_zeta!","text":"set_zeta!(prob, zeta)\nset_zeta!(sol, vars, grid, zeta)\n\nSet the solution sol as the transform of zeta and update variables vars on the grid.\n\n\n\n\n\n","category":"function"},{"location":"modules/barotropicqgql/#Diagnostics","page":"BarotropicQGQL","title":"Diagnostics","text":"","category":"section"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"The kinetic energy of the fluid is obtained via:","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"GeophysicalFlows.BarotropicQGQL.energy","category":"page"},{"location":"modules/barotropicqgql/#GeophysicalFlows.BarotropicQGQL.energy","page":"BarotropicQGQL","title":"GeophysicalFlows.BarotropicQGQL.energy","text":"energy(sol, grid)\nenergy(prob)\n\nReturn the domain-averaged kinetic energy of sol.\n\n\n\n\n\n","category":"function"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"while the enstrophy via:","category":"page"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"GeophysicalFlows.BarotropicQGQL.enstrophy","category":"page"},{"location":"modules/barotropicqgql/#GeophysicalFlows.BarotropicQGQL.enstrophy","page":"BarotropicQGQL","title":"GeophysicalFlows.BarotropicQGQL.enstrophy","text":"enstrophy(sol, grid, vars)\nenstrophy(prob)\n\nReturn the domain-averaged enstrophy of sol.\n\n\n\n\n\n","category":"function"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"Other diagnostic include: dissipation,  drag, and work.","category":"page"},{"location":"modules/barotropicqgql/#Examples","page":"BarotropicQGQL","title":"Examples","text":"","category":"section"},{"location":"modules/barotropicqgql/","page":"BarotropicQGQL","title":"BarotropicQGQL","text":"examples/barotropicqgql_betaforced.jl: Simulate forced-dissipative quasi-linear quasi-geostrophic flow on a beta plane demonstrating zonation. The forcing is temporally delta-correlated and its spatial structure is isotropic with power in a narrow annulus of total radius k_f in wavenumber space. This example demonstrates that the anisotropic inverse energy cascade is not required for zonation.","category":"page"},{"location":"modules/twodnavierstokes/#TwoDNavierStokes","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"","category":"section"},{"location":"modules/twodnavierstokes/#Basic-Equations","page":"TwoDNavierStokes","title":"Basic Equations","text":"","category":"section"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"This module solves two-dimensional incompressible Navier-Stokes equations using the  vorticity-streamfunction formulation. The flow bmu = (u v) is obtained through a  streamfunction psi as (u v) = (-partial_y psi partial_x psi). The only non-zero  component of vorticity is that normal to the plane of motion,  partial_x v - partial_y u = nabla^2 psi. The module solves the two-dimensional  vorticity equation:","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"partial_t zeta + mathsfJ(psi zeta) = underbrace-left  mu (-nabla^2)^n_mu\n+ nu (-nabla^2)^n_nu right  zeta_textrmdissipation + F ","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"where mathsfJ(psi zeta) = (partial_x psi)(partial_y zeta) - (partial_y psi)(partial_x zeta)  is the two-dimensional Jacobian and F(x y t) is forcing. The Jacobian term is the advection of relative vorticity, mathsfJ(ψ ζ) = bmu cdot nabla zeta. Both ν and μ  terms are viscosities; typically the former is chosen to act at small scales (n_ν  1),  while the latter at large scales (n_ν  0). Plain old viscocity corresponds to n_ν=1  while n_μ=0 corresponds to linear drag. Values of n_ν  2 or n_μ  -1 are referred  to as hyper- or hypo-viscosities, respectively.","category":"page"},{"location":"modules/twodnavierstokes/#Implementation","page":"TwoDNavierStokes","title":"Implementation","text":"","category":"section"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"The equation is time-stepped forward in Fourier space:","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"partial_t widehatzeta = - widehatmathsfJ(psi zeta) - left ( mu 𝐤^2n_mu\n+ nu 𝐤^2n_nu right ) widehatzeta + widehatF ","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"The state variable sol is the Fourier transform of vorticity, ζh.","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"The Jacobian is computed in the conservative form: mathsfJ(a b) =  partial_y (partial_x a) b - partial_x(partial_y a) b.","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"The linear operator is constructed in Equation","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"GeophysicalFlows.TwoDNavierStokes.Equation","category":"page"},{"location":"modules/twodnavierstokes/#GeophysicalFlows.TwoDNavierStokes.Equation","page":"TwoDNavierStokes","title":"GeophysicalFlows.TwoDNavierStokes.Equation","text":"Equation(params, grid)\n\nReturn the equation for two-dimensional Navier-Stokes with params and grid. The linear operator L includes (hyper)-viscosity of order n_ν with coefficient ν and  hypo-viscocity of order n_μ with coefficient μ,\n\nL = - ν 𝐤^2 n_ν - μ 𝐤^2 n_μ \n\nPlain-old viscocity corresponds to n_ν = 1 while n_μ = 0 corresponds to linear drag.\n\nThe nonlinear term is computed via the function calcN!.\n\n\n\n\n\n","category":"function"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"The nonlinear terms are computed via calcN!,","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"GeophysicalFlows.TwoDNavierStokes.calcN!","category":"page"},{"location":"modules/twodnavierstokes/#GeophysicalFlows.TwoDNavierStokes.calcN!","page":"TwoDNavierStokes","title":"GeophysicalFlows.TwoDNavierStokes.calcN!","text":"calcN!(N, sol, t, clock, vars, params, grid)\n\nCalculate the nonlinear term, that is the advection term and the forcing,\n\nN = - widehat𝖩(ψ ζ) + F \n\n\n\n\n\n","category":"function"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"which in turn calls calcN_advection!  and addforcing!.","category":"page"},{"location":"modules/twodnavierstokes/#Parameters-and-Variables","page":"TwoDNavierStokes","title":"Parameters and Variables","text":"","category":"section"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"All required parameters are included inside Params and all module variables are included inside Vars.","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"For the decaying case (no forcing, F = 0), variables are constructed with Vars. For the forced case (F ne 0) variables are constructed with either ForcedVars or StochasticForcedVars.","category":"page"},{"location":"modules/twodnavierstokes/#Helper-functions","page":"TwoDNavierStokes","title":"Helper functions","text":"","category":"section"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"Some helper functions included in the module are:","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"GeophysicalFlows.TwoDNavierStokes.updatevars!\nGeophysicalFlows.TwoDNavierStokes.set_ζ!","category":"page"},{"location":"modules/twodnavierstokes/#GeophysicalFlows.TwoDNavierStokes.updatevars!","page":"TwoDNavierStokes","title":"GeophysicalFlows.TwoDNavierStokes.updatevars!","text":"updatevars!(prob)\n\nUpdate problem's variables in prob.vars using the state in prob.sol.\n\n\n\n\n\n","category":"function"},{"location":"modules/twodnavierstokes/#GeophysicalFlows.TwoDNavierStokes.set_ζ!","page":"TwoDNavierStokes","title":"GeophysicalFlows.TwoDNavierStokes.set_ζ!","text":"set_ζ!(prob, ζ)\n\nSet the solution sol as the transform of ζ and then update variables in prob.vars.\n\n\n\n\n\n","category":"function"},{"location":"modules/twodnavierstokes/#Diagnostics","page":"TwoDNavierStokes","title":"Diagnostics","text":"","category":"section"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"Some useful diagnostics are:","category":"page"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"GeophysicalFlows.TwoDNavierStokes.energy\nGeophysicalFlows.TwoDNavierStokes.enstrophy","category":"page"},{"location":"modules/twodnavierstokes/#GeophysicalFlows.TwoDNavierStokes.energy","page":"TwoDNavierStokes","title":"GeophysicalFlows.TwoDNavierStokes.energy","text":"energy(prob)\n\nReturn the domain-averaged kinetic energy. Since u² + v² = bf  ψ², the domain-averaged  kinetic energy is\n\nint frac12 bf  ψ² frac𝖽x 𝖽yL_x L_y = sum_𝐤 frac12 𝐤² ψ² \n\nwhere ψ is the streamfunction.\n\n\n\n\n\n","category":"function"},{"location":"modules/twodnavierstokes/#GeophysicalFlows.TwoDNavierStokes.enstrophy","page":"TwoDNavierStokes","title":"GeophysicalFlows.TwoDNavierStokes.enstrophy","text":"enstrophy(prob)\n\nReturn the problem's (prob) domain-averaged enstrophy,\n\nint frac12 ζ² frac𝖽x 𝖽yL_x L_y = sum_𝐤 frac12 ζ² \n\nwhere ζ is the relative vorticity.\n\n\n\n\n\n","category":"function"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"Other diagnostic include: energy_dissipation,  energy_work,  enstrophy_dissipation, and enstrophy_work.","category":"page"},{"location":"modules/twodnavierstokes/#Examples","page":"TwoDNavierStokes","title":"Examples","text":"","category":"section"},{"location":"modules/twodnavierstokes/","page":"TwoDNavierStokes","title":"TwoDNavierStokes","text":"examples/twodnavierstokes_decaying.jl: Simulates decaying two-dimensional turbulence reproducing the results by:\nexamples/twodnavierstokes_stochasticforcing.jl: Simulate forced-dissipative two-dimensional turbulence with isotropic temporally delta-correlated stochastic forcing.\nexamples/twodnavierstokes_stochasticforcing_budgets.jl: Simulate forced-dissipative two-dimensional turbulence demonstrating how we can compute the energy and enstrophy budgets.","category":"page"},{"location":"lib/functions/#Functions","page":"Functions","title":"Functions","text":"","category":"section"},{"location":"lib/functions/#GeophysicalFlows","page":"Functions","title":"GeophysicalFlows","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.GeophysicalFlows","category":"page"},{"location":"lib/functions/#GeophysicalFlows.GeophysicalFlows","page":"Functions","title":"GeophysicalFlows.GeophysicalFlows","text":"Main module for GeophysicalFlows.jl – a collection of solvers for geophysical fluid dynamics problems in periodic domains on CPUs and GPUs. All modules use Fourier-based pseudospectral  methods and leverage the functionality of FourierFlows.jl ecosystem.\n\n\n\n\n\n","category":"module"},{"location":"lib/functions/#Exported-functions","page":"Functions","title":"Exported functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.lambdipole\nGeophysicalFlows.peakedisotropicspectrum","category":"page"},{"location":"lib/functions/#GeophysicalFlows.lambdipole","page":"Functions","title":"GeophysicalFlows.lambdipole","text":"lambdipole(U, R, grid::TwoDGrid; center=(mean(grid.x), mean(grid.y))\n\nReturn the two-dimensional vorticity field of the Lamb dipole with strength U and radius R,  centered on center=(xc, yc) and on the grid. Default value for center is the center of  the domain.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.peakedisotropicspectrum","page":"Functions","title":"GeophysicalFlows.peakedisotropicspectrum","text":"peakedisotropicspectrum(grid, kpeak, E₀; mask = ones(size(grid.Krsq)), allones = false)\n\nGenerate a random two-dimensional relative vorticity field q(x y) with Fourier spectrum  peaked around a central non-dimensional wavenumber kpeak and normalized so that its total  kinetic energy is E₀.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#TwoDNavierStokes","page":"Functions","title":"TwoDNavierStokes","text":"","category":"section"},{"location":"lib/functions/#Exported-functions-2","page":"Functions","title":"Exported functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.TwoDNavierStokes.Problem\nGeophysicalFlows.TwoDNavierStokes.energy_dissipation_hyperviscosity\nGeophysicalFlows.TwoDNavierStokes.energy_dissipation_hypoviscosity\nGeophysicalFlows.TwoDNavierStokes.energy_work\nGeophysicalFlows.TwoDNavierStokes.enstrophy_dissipation_hyperviscosity\nGeophysicalFlows.TwoDNavierStokes.enstrophy_dissipation_hypoviscosity\nGeophysicalFlows.TwoDNavierStokes.enstrophy_work\nGeophysicalFlows.TwoDNavierStokes.palinstrophy","category":"page"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.Problem","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.Problem","text":"Problem(dev::Device = CPU();\n                 nx = 256,\n                 ny = nx,\n                 Lx = 2π,\n                 Ly = Lx,\n                  ν = 0,\n                 nν = 1,\n                  μ = 0,\n                 nμ = 0,\n                 dt = 0.01,\n            stepper = \"RK4\",\n              calcF = nothingfunction,\n         stochastic = false,\n   aliased_fraction = 1/3,\n                  T = Float64)\n\nConstruct a two-dimensional Navier-Stokes problem on device dev.\n\nArguments\n\ndev: (required) CPU() or GPU(); computer architecture used to time-step problem.\n\nKeyword arguments\n\nnx: Number of grid points in x-domain.\nny: Number of grid points in y-domain.\nLx: Extent of the x-domain.\nLy: Extent of the y-domain.\nν: Small-scale (hyper)-viscosity coefficient.\nnν: (Hyper)-viscosity order, nν 1.\nμ: Large-scale (hypo)-viscosity coefficient.\nnμ: (Hypo)-viscosity order, nμ 0.\ndt: Time-step.\nstepper: Time-stepping method.\ncalcF: Function that calculates the Fourier transform of the forcing, F.\nstochastic: true or false; boolean denoting whether calcF is temporally stochastic.\naliased_fraction: the fraction of high-wavenumbers that are zero-ed out by dealias!().\nT: Float32 or Float64; floating point type used for problem data.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.energy_dissipation_hyperviscosity","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.energy_dissipation_hyperviscosity","text":"energy_dissipation_hyperviscosity(prob)\n\nReturn the problem's (prob) domain-averaged energy dissipation rate done by the ν (hyper)-viscosity.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.energy_dissipation_hypoviscosity","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.energy_dissipation_hypoviscosity","text":"energy_dissipation_hypoviscosity(prob)\n\nReturn the problem's (prob) domain-averaged energy dissipation rate done by the μ (hypo)-viscosity.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.energy_work","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.energy_work","text":"energy_work(prob)\n\nReturn the problem's (prob) domain-averaged rate of work of energy by the forcing F,\n\n- int ψ F frac𝖽x 𝖽yL_x L_y = - sum_𝐤 ψ F^* \n\nwhere ψ is the stream flow.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.enstrophy_dissipation_hyperviscosity","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.enstrophy_dissipation_hyperviscosity","text":"enstrophy_dissipation_hyperviscosity(prob)\n\nReturn the problem's (prob) domain-averaged enstrophy dissipation rate done by the ν (hyper)-viscosity.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.enstrophy_dissipation_hypoviscosity","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.enstrophy_dissipation_hypoviscosity","text":"enstrophy_dissipation_hypoviscosity(prob)\n\nReturn the problem's (prob) domain-averaged enstrophy dissipation rate done by the μ (hypo)-viscosity.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.enstrophy_work","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.enstrophy_work","text":"enstrophy_work(prob)\n\nReturn the problem's (prob) domain-averaged rate of work of enstrophy by the forcing F,\n\nint ζ F frac𝖽x 𝖽yL_x L_y = sum_𝐤 ζ F^* \n\nwhere ζ is the relative vorticity.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.palinstrophy","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.palinstrophy","text":"palinstrophy(prob)\n\nReturn the problem's (prob) domain-averaged palinstrophy,\n\nint frac12 bf  ζ² frac𝖽x 𝖽yL_x L_y = sum_𝐤 frac12 𝐤² ζ² \n\nwhere ζ is the relative vorticity.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#Private-functions","page":"Functions","title":"Private functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.TwoDNavierStokes.calcN_advection!\nGeophysicalFlows.TwoDNavierStokes.addforcing!\nGeophysicalFlows.TwoDNavierStokes.energy_dissipation\nGeophysicalFlows.TwoDNavierStokes.enstrophy_dissipation","category":"page"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.calcN_advection!","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.calcN_advection!","text":"calcN_advection!(N, sol, t, clock, vars, params, grid)\n\nCalculate the Fourier transform of the advection term, - 𝖩(ψ ζ) in conservative form,  i.e., - _x(_y ψ)ζ - _y(_x ψ)ζ and store it in N:\n\nN = - widehat𝖩(ψ ζ) = - i k_x widehatu ζ - i k_y widehatv ζ \n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.addforcing!","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.addforcing!","text":"addforcing!(N, sol, t, clock, vars, params, grid)\n\nWhen the problem includes forcing, calculate the forcing term F and add it to the nonlinear term N.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.energy_dissipation","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.energy_dissipation","text":"energy_dissipation(prob, ξ, νξ)\n\nReturn the domain-averaged energy dissipation rate done by the viscous term,\n\n- ξ (-1)^n_ξ+1 int ψ ^2n_ξ ζ frac𝖽x 𝖽yL_x L_y = - ξ sum_𝐤 𝐤^2(n_ξ-1) ζ² \n\nwhere ξ and nξ could be either the (hyper)-viscosity coefficient ν and its order  n_ν, or the hypo-viscocity coefficient μ and its order n_μ.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.TwoDNavierStokes.enstrophy_dissipation","page":"Functions","title":"GeophysicalFlows.TwoDNavierStokes.enstrophy_dissipation","text":"enstrophy_dissipation(prob, ξ, νξ)\n\nReturn the problem's (prob) domain-averaged enstrophy dissipation rate done by the viscous term,\n\nξ (-1)^n_ξ+1 int ζ ^2n_ξ ζ frac𝖽x 𝖽yL_x L_y = - ξ sum_𝐤 𝐤^2n_ξ ζ² \n\nwhere ξ and nξ could be either the (hyper)-viscosity coefficient ν and its order  n_ν, or the hypo-viscocity coefficient μ and its order n_μ.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#SingleLayerQG","page":"Functions","title":"SingleLayerQG","text":"","category":"section"},{"location":"lib/functions/#Exported-functions-3","page":"Functions","title":"Exported functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.SingleLayerQG.Problem\nGeophysicalFlows.SingleLayerQG.streamfunctionfrompv!\nGeophysicalFlows.SingleLayerQG.energy_dissipation\nGeophysicalFlows.SingleLayerQG.energy_work\nGeophysicalFlows.SingleLayerQG.energy_drag\nGeophysicalFlows.SingleLayerQG.enstrophy\nGeophysicalFlows.SingleLayerQG.enstrophy_dissipation\nGeophysicalFlows.SingleLayerQG.enstrophy_work\nGeophysicalFlows.SingleLayerQG.enstrophy_drag","category":"page"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.Problem","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.Problem","text":"Problem(dev::Device = CPU();\n                 nx = 256,\n                 ny = nx,\n                 Lx = 2π,\n                 Ly = Lx,\n                  β = 0.0,\n deformation_radius = Inf,\n                eta = nothing,\n                  ν = 0.0,\n                 nν = 1,\n                  μ = 0.0,\n                 dt = 0.01,\n            stepper = \"RK4\",\n              calcF = nothingfunction,\n         stochastic = false,\n   aliased_fraction = 1/3,\n                  T = Float64)\n\nConstruct a single-layer quasi-geostrophic problem on device dev.\n\nArguments\n\ndev: (required) CPU() or GPU(); computer architecture used to time-step problem.\n\nKeyword arguments\n\nnx: Number of grid points in x-domain.\nny: Number of grid points in y-domain.\nLx: Extent of the x-domain.\nLy: Extent of the y-domain.\nβ: Planetary vorticity y-gradient.\ndeformation_radius: Rossby radius of deformation; set Inf for purely barotropic.\neta: Topographic potential vorticity.\nν: Small-scale (hyper)-viscosity coefficient.\nnν: (Hyper)-viscosity order, nν 1.\nμ: Linear drag coefficient.\ndt: Time-step.\nstepper: Time-stepping method.\ncalcF: Function that calculates the Fourier transform of the forcing, F.\nstochastic: true or false; boolean denoting whether calcF is temporally stochastic.\naliased_fraction: the fraction of high-wavenumbers that are zero-ed out by dealias!().\nT: Float32 or Float64; floating point type used for problem data.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.streamfunctionfrompv!","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.streamfunctionfrompv!","text":"streamfunctionfrompv!(ψh, qh, params, grid)\n\nInvert the Fourier transform of PV qh to obtain the Fourier transform of the streamfunction ψh.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.energy_dissipation","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.energy_dissipation","text":"energy_dissipation(prob)\n\nReturn the problem's (prob) domain-averaged energy dissipation rate.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.energy_work","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.energy_work","text":"energy_work(prob)\n\nReturn the problem's (prob) domain-averaged rate of work of energy by the forcing F.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.energy_drag","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.energy_drag","text":"energy_drag(prob)\n\nReturn the problem's (prob) extraction of domain-averaged energy by drag μ.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.enstrophy","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.enstrophy","text":"enstrophy(prob)\n\nReturn the problem's (prob) domain-averaged enstrophy\n\nint frac12 (q + η)² frac𝖽x 𝖽yL_x L_y = sum_𝐤 frac12 q + η² \n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.enstrophy_dissipation","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.enstrophy_dissipation","text":"enstrophy_dissipation(prob)\n\nReturn the problem's (prob) domain-averaged enstrophy dissipation rate.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.enstrophy_work","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.enstrophy_work","text":"enstrophy_work(prob)\n\nReturn the problem's (prob) domain-averaged rate of work of enstrophy by the forcing F.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.enstrophy_drag","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.enstrophy_drag","text":"enstrophy_drag(prob)\n\nReturn the problem's (prob) extraction of domain-averaged enstrophy by drag/hypodrag μ.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#Private-functions-2","page":"Functions","title":"Private functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.SingleLayerQG.calcN_advection!\nGeophysicalFlows.SingleLayerQG.addforcing!","category":"page"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.calcN_advection!","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.calcN_advection!","text":"calcN_advection!(N, sol, t, clock, vars, params, grid)\n\nCalculate the Fourier transform of the advection term, - 𝖩(ψ q+η) in conservative  form, i.e., - _x(_y ψ)(q+η) - _y(_x ψ)(q+η) and store it in N:\n\nN = - widehat𝖩(ψ q + η) = - i k_x widehatu (q + η) - i k_y widehatv (q + η) \n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SingleLayerQG.addforcing!","page":"Functions","title":"GeophysicalFlows.SingleLayerQG.addforcing!","text":"addforcing!(N, sol, t, clock, vars, params, grid)\n\nWhen the problem includes forcing, calculate the forcing term F and add it to the  nonlinear term N.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#MultiLayerQG","page":"Functions","title":"MultiLayerQG","text":"","category":"section"},{"location":"lib/functions/#Exported-functions-4","page":"Functions","title":"Exported functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.MultiLayerQG.Problem\nGeophysicalFlows.MultiLayerQG.fwdtransform!\nGeophysicalFlows.MultiLayerQG.invtransform!\nGeophysicalFlows.MultiLayerQG.streamfunctionfrompv!\nGeophysicalFlows.MultiLayerQG.pvfromstreamfunction!","category":"page"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.Problem","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.Problem","text":"Problem(nlayers :: Int,\n                    dev = CPU();\n                     nx = 128,\n                     ny = nx,\n                     Lx = 2π,\n                     Ly = Lx,\n                     f₀ = 1.0,\n                      β = 0.0,\n                      g = 1.0,\n                      U = zeros(nlayers),\n                      H = 1/nlayers * ones(nlayers),\n                      ρ = Array{Float64}(1:nlayers),\n                    eta = nothing,\ntopographic_pv_gradient = (0, 0),\n                      μ = 0,\n                      ν = 0,\n                     nν = 1,\n                     dt = 0.01,\n                stepper = \"RK4\",\n                 calcFq = nothingfunction,\n             stochastic = false,\n                 linear = false,\n       aliased_fraction = 1/3,\n                      T = Float64)\n\nConstruct a multi-layer quasi-geostrophic problem with nlayers fluid layers on device dev.\n\nArguments\n\nnlayers: (required) Number of fluid layers.\ndev: (required) CPU() (default) or GPU(); computer architecture used to time-step problem.\n\nKeyword arguments\n\nnx: Number of grid points in x-domain.\nny: Number of grid points in y-domain.\nLx: Extent of the x-domain.\nLy: Extent of the y-domain.\nf₀: Constant planetary vorticity.\nβ: Planetary vorticity y-gradient.\ng: Gravitational acceleration constant.\nU: The imposed constant zonal flow U(y) in each fluid layer.\nH: Rest height of each fluid layer.\nρ: Density of each fluid layer.\neta: Periodic component of the topographic potential vorticity.\ntopographic_pv_gradient: The (x y) components of the topographic PV large-scale gradient.\nμ: Linear bottom drag coefficient.\nν: Small-scale (hyper)-viscosity coefficient.\nnν: (Hyper)-viscosity order, nν 1.\ndt: Time-step.\nstepper: Time-stepping method.\ncalcF: Function that calculates the Fourier transform of the forcing, F.\nstochastic: true or false (default); boolean denoting whether calcF is temporally stochastic.\nlinear: true or false (default); boolean denoting whether the linearized equations of motions are used.\naliased_fraction: the fraction of high-wavenumbers that are zero-ed out by dealias!().\nT: Float32 or Float64 (default); floating point type used for problem data.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.fwdtransform!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.fwdtransform!","text":"fwdtransform!(varh, var, params)\n\nCompute the Fourier transform of var and store it in varh.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.invtransform!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.invtransform!","text":"invtransform!(var, varh, params)\n\nCompute the inverse Fourier transform of varh and store it in var.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.streamfunctionfrompv!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.streamfunctionfrompv!","text":"streamfunctionfrompv!(ψh, qh, params, grid)\n\nInvert the PV to obtain the Fourier transform of the streamfunction ψh in each layer from qh using ψh = params.S⁻¹ qh.\n\n\n\n\n\nstreamfunctionfrompv!(ψh, qh, params::SingleLayerParams, grid)\n\nInvert the PV to obtain the Fourier transform of the streamfunction ψh for the special case of a single fluid layer configuration. In this case, ψ = - k² q.\n\n\n\n\n\nstreamfunctionfrompv!(ψh, qh, params::TwoLayerParams, grid)\n\nInvert the PV to obtain the Fourier transform of the streamfunction ψh for the special case of a two fluid layer configuration. In this case we have,\n\nψ₁ = - k² q₁ + (f₀²  g) (q₁  H₂ + q₂  H₁)  Δ \n\nψ₂ = - k² q₂ + (f₀²  g) (q₁  H₂ + q₂  H₁)  Δ \n\nwhere Δ = k² k² + f₀² (H₁ + H₂)  (g H₁ H₂).\n\n(Here, the PV-streamfunction relationship is hard-coded to avoid scalar operations on the GPU.)\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.pvfromstreamfunction!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.pvfromstreamfunction!","text":"pvfromstreamfunction!(qh, ψh, params, grid)\n\nObtain the Fourier transform of the PV from the streamfunction ψh in each layer using qh = params.S * ψh.\n\n\n\n\n\npvfromstreamfunction!(qh, ψh, params::SingleLayerParams, grid)\n\nObtain the Fourier transform of the PV from the streamfunction ψh for the special case of a single fluid layer configuration. In this case, q = - k² ψ.\n\n\n\n\n\npvfromstreamfunction!(qh, ψh, params::TwoLayerParams, grid)\n\nObtain the Fourier transform of the PV from the streamfunction ψh for the special case of a two fluid layer configuration. In this case we have,\n\nq₁ = - k² ψ₁ + f₀²  (g H₁) (ψ₂ - ψ₁) \n\nq₂ = - k² ψ₂ + f₀²  (g H₂) (ψ₁ - ψ₂) \n\n(Here, the PV-streamfunction relationship is hard-coded to avoid scalar operations on the GPU.)\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#Private-functions-3","page":"Functions","title":"Private functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.MultiLayerQG.LinearEquation\nGeophysicalFlows.MultiLayerQG.calcS!\nGeophysicalFlows.MultiLayerQG.calcS⁻¹!\nGeophysicalFlows.MultiLayerQG.calcNlinear!\nGeophysicalFlows.MultiLayerQG.calcN_advection!\nGeophysicalFlows.MultiLayerQG.calcN_linearadvection!\nGeophysicalFlows.MultiLayerQG.addforcing!","category":"page"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.LinearEquation","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.LinearEquation","text":"LinearEquation(params, grid)\n\nReturn the equation for a multi-layer quasi-geostrophic problem with params and grid. The linear opeartor L includes only (hyper)-viscosity and is computed via hyperviscosity(params, grid).\n\nThe nonlinear term is computed via function calcNlinear!.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.calcS!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.calcS!","text":"calcS!(S, Fp, Fm, nlayers, grid)\n\nConstruct the array 𝕊, which consists of nlayer x nlayer static arrays 𝕊_𝐤 that relate the q_j's and ψ_j's for every wavenumber: q_𝐤 = 𝕊_𝐤 ψ_𝐤.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.calcS⁻¹!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.calcS⁻¹!","text":"calcS⁻¹!(S, Fp, Fm, nlayers, grid)\n\nConstruct the array 𝕊¹, which consists of nlayer x nlayer static arrays (𝕊_𝐤)¹ that relate the q_j's and ψ_j's for every wavenumber: ψ_𝐤 = (𝕊_𝐤)¹ q_𝐤.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.calcNlinear!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.calcNlinear!","text":"calcNlinear!(N, sol, t, clock, vars, params, grid)\n\nCompute the nonlinear term of the linearized equations:\n\nN_j = - widehatU_j _x Q_j - widehatU_j _x q_j + widehat(_y ψ_j)(_x Q_j)\n- widehat(_x ψ_j)(_y Q_j) + δ_j n μ 𝐤^2 ψ_n + F_j \n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.calcN_advection!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.calcN_advection!","text":"calcN_advection!(N, sol, vars, params, grid)\n\nCompute the advection term and stores it in N:\n\nN_j = - widehat𝖩(ψ_j q_j) - widehatU_j _x Q_j - widehatU_j _x q_j\n + widehat(_y ψ_j)(_x Q_j) - widehat(_x ψ_j)(_y Q_j) \n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.calcN_linearadvection!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.calcN_linearadvection!","text":"calcN_linearadvection!(N, sol, vars, params, grid)\n\nCompute the advection term of the linearized equations and stores it in N:\n\nN_j = - widehatU_j _x Q_j - widehatU_j _x q_j\n + widehat(_y ψ_j)(_x Q_j) - widehat(_x ψ_j)(_y Q_j) \n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.MultiLayerQG.addforcing!","page":"Functions","title":"GeophysicalFlows.MultiLayerQG.addforcing!","text":"addforcing!(N, sol, t, clock, vars, params, grid)\n\nWhen the problem includes forcing, calculate the forcing term F for each layer and add it to the nonlinear term N.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#SurfaceQG","page":"Functions","title":"SurfaceQG","text":"","category":"section"},{"location":"lib/functions/#Exported-functions-5","page":"Functions","title":"Exported functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.SurfaceQG.Problem\nGeophysicalFlows.SurfaceQG.buoyancy_dissipation\nGeophysicalFlows.SurfaceQG.buoyancy_work","category":"page"},{"location":"lib/functions/#GeophysicalFlows.SurfaceQG.Problem","page":"Functions","title":"GeophysicalFlows.SurfaceQG.Problem","text":"Problem(dev::Device = CPU();\n                 nx = 256,\n                 Lx = 2π,\n                 ny = nx,\n                 Ly = Lx,\n                  ν = 0,\n                 nν = 1,\n                 dt = 0.01,\n            stepper = \"RK4\",\n              calcF = nothingfunction,\n         stochastic = false,\n   aliased_fraction = 1/3,\n                  T = Float64)\n\nConstruct a surface quasi-geostrophic problem on device dev.\n\nArguments\n\ndev: (required) CPU() or GPU(); computer architecture used to time-step problem.\n\nKeyword arguments\n\nnx: Number of grid points in x-domain.\nny: Number of grid points in y-domain.\nLx: Extent of the x-domain.\nLy: Extent of the y-domain.\nν: Small-scale (hyper)-viscosity coefficient.\nnν: (Hyper)-viscosity order, nν 1.\ndt: Time-step.\nstepper: Time-stepping method.\ncalcF: Function that calculates the Fourier transform of the forcing, F.\nstochastic: true or false; boolean denoting whether calcF is temporally stochastic.\naliased_fraction: the fraction of high-wavenumbers that are zero-ed out by dealias!().\nT: Float32 or Float64; floating point type used for problem data.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SurfaceQG.buoyancy_dissipation","page":"Functions","title":"GeophysicalFlows.SurfaceQG.buoyancy_dissipation","text":"buoyancy_dissipation(prob)\n\nReturn the domain-averaged dissipation rate of surface buoyancy variance due to small scale (hyper)-viscosity,\n\n2 ν (-1)^n_ν int b ^2n_ν b frac𝖽x 𝖽yL_x L_y = - 2 ν sum_𝐤 𝐤^2n_ν b² \n\nwhere ν the (hyper)-viscosity coefficient ν and nν the (hyper)-viscosity order. In SQG, this is identical to twice the rate of kinetic energy dissipation\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SurfaceQG.buoyancy_work","page":"Functions","title":"GeophysicalFlows.SurfaceQG.buoyancy_work","text":"buoyancy_work(prob)\nbuoyancy_work(sol, vars, grid)\n\nReturn the domain-averaged rate of work of buoyancy variance by the forcing,\n\nint 2 b F frac𝖽x 𝖽yL_x L_y = sum_𝐤 2 b F^* \n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#Private-functions-4","page":"Functions","title":"Private functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.SurfaceQG.calcN_advection!\nGeophysicalFlows.SurfaceQG.addforcing!","category":"page"},{"location":"lib/functions/#GeophysicalFlows.SurfaceQG.calcN_advection!","page":"Functions","title":"GeophysicalFlows.SurfaceQG.calcN_advection!","text":"calcN_advection!(N, sol, t, clock, vars, params, grid)\n\nCalculate the Fourier transform of the advection term, - 𝖩(ψ b) in conservative  form, i.e., - _x(_y ψ)b - _y(_x ψ)b and store it in N:\n\nN = - widehat𝖩(ψ b) = - i k_x widehatu b - i k_y widehatv b \n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.SurfaceQG.addforcing!","page":"Functions","title":"GeophysicalFlows.SurfaceQG.addforcing!","text":"addforcing!(N, sol, t, clock, vars, params, grid)\n\nWhen the problem includes forcing, calculate the forcing term F and add it to the  nonlinear term N.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#BarotropicQGQL","page":"Functions","title":"BarotropicQGQL","text":"","category":"section"},{"location":"lib/functions/#Exported-functions-6","page":"Functions","title":"Exported functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.BarotropicQGQL.Problem\nGeophysicalFlows.BarotropicQGQL.dissipation\nGeophysicalFlows.BarotropicQGQL.work\nGeophysicalFlows.BarotropicQGQL.drag","category":"page"},{"location":"lib/functions/#GeophysicalFlows.BarotropicQGQL.Problem","page":"Functions","title":"GeophysicalFlows.BarotropicQGQL.Problem","text":"Problem(dev::Device = CPU();\n                 nx = 256,\n                 ny = nx,\n                 Lx = 2π,\n                 Ly = Lx,\n                  β = 0.0,\n                eta = nothing,\n                  ν = 0.0,\n                 nν = 1,\n                  μ = 0.0,\n                 dt = 0.01,\n            stepper = \"RK4\",\n              calcF = nothingfunction,\n         stochastic = false,\n   aliased_fraction = 1/3,\n                  T = Float64)\n\nConstruct a quasi-linear barotropic quasi-geostrophic problem on device dev.\n\nArguments\n\ndev: (required) CPU() or GPU(); computer architecture used to time-step problem.\n\nKeyword arguments\n\nnx: Number of grid points in x-domain.\nny: Number of grid points in y-domain.\nLx: Extent of the x-domain.\nLy: Extent of the y-domain.\nβ: Planetary vorticity y-gradient.\neta: Topographic potential vorticity.\nν: Small-scale (hyper)-viscosity coefficient.\nnν: (Hyper)-viscosity order, nν 1.\nμ: Linear drag coefficient.\ndt: Time-step.\nstepper: Time-stepping method.\ncalcF: Function that calculates the Fourier transform of the forcing, F.\nstochastic: true or false; boolean denoting whether calcF is temporally stochastic.\naliased_fraction: the fraction of high-wavenumbers that are zero-ed out by dealias!().\nT: Float32 or Float64; floating point type used for problem data.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.BarotropicQGQL.dissipation","page":"Functions","title":"GeophysicalFlows.BarotropicQGQL.dissipation","text":"dissipation(prob)\ndissipation(sol, vars, params, grid)\n\nReturn the domain-averaged energy dissipation rate. nν must be >= 1.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.BarotropicQGQL.work","page":"Functions","title":"GeophysicalFlows.BarotropicQGQL.work","text":"work(prob)\nwork(sol, vars, params, grid)\n\nReturn the domain-averaged rate of work of energy by the forcing, params.Fh.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.BarotropicQGQL.drag","page":"Functions","title":"GeophysicalFlows.BarotropicQGQL.drag","text":"drag(prob)\ndrag(sol, vars, params, grid)\n\nReturn the extraction of domain-averaged energy by drag μ.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#Private-functions-5","page":"Functions","title":"Private functions","text":"","category":"section"},{"location":"lib/functions/","page":"Functions","title":"Functions","text":"GeophysicalFlows.BarotropicQGQL.calcN_advection!\nGeophysicalFlows.BarotropicQGQL.addforcing!","category":"page"},{"location":"lib/functions/#GeophysicalFlows.BarotropicQGQL.calcN_advection!","page":"Functions","title":"GeophysicalFlows.BarotropicQGQL.calcN_advection!","text":"calcN_advection!(N, sol, t, clock, vars, params, grid)\n\nCalculate the Fourier transform of the advection term for quasi-linear barotropic QG dynamics.\n\n\n\n\n\n","category":"function"},{"location":"lib/functions/#GeophysicalFlows.BarotropicQGQL.addforcing!","page":"Functions","title":"GeophysicalFlows.BarotropicQGQL.addforcing!","text":"addforcing!(N, sol, t, clock, vars, params, grid)\n\nWhen the problem includes forcing, calculate the forcing term F and add it to the  nonlinear term N.\n\n\n\n\n\n","category":"function"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"EditURL = \"../../../examples/singlelayerqg_betaforced.jl\"","category":"page"},{"location":"literated/singlelayerqg_betaforced/#singlelayerqg_betaforced_example","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"A simulation of forced-dissipative barotropic quasi-geostrophic turbulence on a beta plane. The dynamics include linear drag and stochastic excitation.","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Install-dependencies","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Install dependencies","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"using Pkg\npkg\"add GeophysicalFlows, CUDA, JLD2, CairoMakie, Statistics\"","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Let's-begin","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Let's begin","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"using GeophysicalFlows, CUDA, JLD2, CairoMakie, Random, Printf\n\nusing Statistics: mean\nusing LinearAlgebra: ldiv!\n\nparsevalsum = FourierFlows.parsevalsum\nrecord = CairoMakie.record                # disambiguate between CairoMakie.record and CUDA.record","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Choosing-a-device:-CPU-or-GPU","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Numerical-parameters-and-time-stepping-parameters","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Numerical parameters and time-stepping parameters","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"      n = 128            # 2D resolution: n² grid points\nstepper = \"FilteredRK4\"  # timestepper\n     dt = 0.05           # timestep\n nsteps = 8000          # total number of timesteps\n save_substeps = 10      # number of timesteps after which output is saved\n","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Physical-parameters","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Physical parameters","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"L = 2π        # domain size\nβ = 10.0      # planetary PV gradient\nμ = 0.01      # bottom drag","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Forcing","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forcing","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"We force the vorticity equation with stochastic excitation that is delta-correlated in time and while spatially homogeneously and isotropically correlated. The forcing has a spectrum with power in a ring in wavenumber space of radius k_f (forcing_wavenumber) and width δ_f (forcing_bandwidth), and it injects energy per unit area and per unit time equal to varepsilon. That is, the forcing covariance spectrum is proportional to exp-(bmk - k_f)^2  (2 δ_f^2).","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"forcing_wavenumber = 14.0 * 2π/L  # the forcing wavenumber, `k_f`, for a spectrum that is a ring in wavenumber space\nforcing_bandwidth  = 1.5  * 2π/L  # the width of the forcing spectrum, `δ_f`\nε = 0.001                         # energy input rate by the forcing\n\ngrid = TwoDGrid(dev; nx=n, Lx=L)\n\nK = @. sqrt(grid.Krsq)            # a 2D array with the total wavenumber\n\nforcing_spectrum = @. exp(-(K - forcing_wavenumber)^2 / (2 * forcing_bandwidth^2))\n@CUDA.allowscalar forcing_spectrum[grid.Krsq .== 0] .= 0 # ensure forcing has zero domain-average\n\nε0 = parsevalsum(forcing_spectrum .* grid.invKrsq / 2, grid) / (grid.Lx * grid.Ly)\n@. forcing_spectrum *= ε/ε0       # normalize forcing to inject energy at rate ε","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"We reset of the random number generator for reproducibility","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"if dev==CPU(); Random.seed!(1234); else; CUDA.seed!(1234); end","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"Next we construct function calcF! that computes a forcing realization every timestep. First we make sure that if dev=GPU(), then CUDA.rand() function is called for random numbers uniformly distributed between 0 and 1.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"random_uniform = dev==CPU() ? rand : CUDA.rand\n\nfunction calcF!(Fh, sol, t, clock, vars, params, grid)\n  T = eltype(grid)\n  @. Fh = sqrt(forcing_spectrum) * cis(2π * random_uniform(T)) / sqrt(clock.dt)\n\n  return nothing\nend","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Problem-setup","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Problem setup","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"We initialize a Problem by providing a set of keyword arguments. We use stepper = \"FilteredRK4\". Filtered timesteppers apply a wavenumber-filter at every time-step that removes enstrophy at high wavenumbers and, thereby, stabilize the problem, despite that we use the default viscosity coefficient ν=0.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"prob = SingleLayerQG.Problem(dev; nx=n, Lx=L, β, μ, dt, stepper,\n                             calcF=calcF!, stochastic=true)","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"Let's define some shortcuts.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"sol, clock, vars, params, grid = prob.sol, prob.clock, prob.vars, prob.params, prob.grid\nx,  y  = grid.x,  grid.y\nLx, Ly = grid.Lx, grid.Ly","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"First let's see how a forcing realization looks like. Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when vars live on the GPU.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"calcF!(vars.Fh, sol, 0.0, clock, vars, params, grid)\n\nfig = Figure()\n\nax = Axis(fig[1, 1],\n          xlabel = \"x\",\n          ylabel = \"y\",\n          aspect = 1,\n          title = \"a forcing realization\",\n          limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\nheatmap!(ax, x, y, Array(irfft(vars.Fh, grid.nx));\n         colormap = :balance, colorrange = (-8, 8))\n\nfig","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Setting-initial-conditions","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"Our initial condition is simply fluid at rest.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"SingleLayerQG.set_q!(prob, device_array(dev)(zeros(grid.nx, grid.ny)))","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Diagnostics","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Diagnostics","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"Create Diagnostic – energy and enstrophy are functions imported at the top.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"E = Diagnostic(SingleLayerQG.energy, prob; nsteps, freq=save_substeps)\nZ = Diagnostic(SingleLayerQG.enstrophy, prob; nsteps, freq=save_substeps)\ndiags = [E, Z] # A list of Diagnostics types passed to \"stepforward!\" will  be updated every timestep.","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Output","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Output","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"We choose folder for outputing .jld2 files and snapshots (.png files).","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"filepath = \".\"\nplotpath = \"./plots_forcedbetaturb\"\nplotname = \"snapshots\"\nfilename = joinpath(filepath, \"singlelayerqg_forcedbeta.jld2\")","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"Do some basic file management,","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"if isfile(filename); rm(filename); end\nif !isdir(plotpath); mkdir(plotpath); end","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"and then create Output.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"get_sol(prob) = Array(prob.sol) # extracts the Fourier-transformed solution\n\nfunction get_u(prob)\n  vars, grid, sol = prob.vars, prob.grid, prob.sol\n\n  @. vars.qh = sol\n\n  SingleLayerQG.streamfunctionfrompv!(vars.ψh, vars.qh, params, grid)\n\n  ldiv!(vars.u, grid.rfftplan, -im * grid.l .* vars.ψh)\n\n  return Array(vars.u)\nend\n\noutput = Output(prob, filename, (:qh, get_sol), (:u, get_u))","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"We first save the problem's grid and other parameters so we can use them later.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"saveproblem(output)","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"and then call saveoutput(output) once to save the initial state.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"saveoutput(output)","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Time-stepping-the-Problem-forward","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Time-stepping the Problem forward","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"We time-step the Problem forward in time.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"startwalltime = time()\n\nwhile clock.step <= nsteps\n  if clock.step % 50save_substeps == 0\n    cfl = clock.dt * maximum([maximum(vars.u) / grid.dx, maximum(vars.v) / grid.dy])\n\n    log = @sprintf(\"step: %04d, t: %d, cfl: %.2f, E: %.4f, Q: %.4f, walltime: %.2f min\",\n    clock.step, clock.t, cfl, E.data[E.i], Z.data[Z.i], (time()-startwalltime)/60)\n\n    println(log)\n  end\n\n  stepforward!(prob, diags, save_substeps)\n  SingleLayerQG.updatevars!(prob)\n\n  if clock.step % save_substeps == 0\n    saveoutput(output)\n  end\nend\n\nsavediagnostic(E, \"energy\", output.path)\nsavediagnostic(Z, \"enstrophy\", output.path)","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"step: 0000, t: 0, cfl: 0.00, E: 0.0000, Q: 0.0000, walltime: 0.00 min\nstep: 0500, t: 25, cfl: 0.49, E: 0.0181, Q: 2.6734, walltime: 0.03 min\nstep: 1000, t: 50, cfl: 0.75, E: 0.0294, Q: 2.9033, walltime: 0.04 min\nstep: 1500, t: 75, cfl: 0.72, E: 0.0366, Q: 2.8531, walltime: 0.06 min\nstep: 2000, t: 100, cfl: 0.76, E: 0.0405, Q: 2.8524, walltime: 0.08 min\nstep: 2500, t: 125, cfl: 0.90, E: 0.0432, Q: 2.7659, walltime: 0.10 min\nstep: 3000, t: 150, cfl: 0.74, E: 0.0461, Q: 2.8456, walltime: 0.12 min\nstep: 3500, t: 175, cfl: 0.84, E: 0.0458, Q: 2.5441, walltime: 0.14 min\nstep: 4000, t: 200, cfl: 0.83, E: 0.0463, Q: 2.6039, walltime: 0.15 min\nstep: 4500, t: 225, cfl: 0.78, E: 0.0468, Q: 2.7381, walltime: 0.17 min\nstep: 5000, t: 250, cfl: 0.95, E: 0.0475, Q: 2.7058, walltime: 0.19 min\nstep: 5500, t: 275, cfl: 0.72, E: 0.0481, Q: 2.8522, walltime: 0.21 min\nstep: 6000, t: 300, cfl: 0.83, E: 0.0481, Q: 2.8540, walltime: 0.23 min\nstep: 6500, t: 325, cfl: 0.87, E: 0.0479, Q: 2.8534, walltime: 0.25 min\nstep: 7000, t: 350, cfl: 0.81, E: 0.0474, Q: 2.7300, walltime: 0.27 min\nstep: 7500, t: 375, cfl: 0.96, E: 0.0469, Q: 2.6818, walltime: 0.29 min\nstep: 8000, t: 400, cfl: 0.74, E: 0.0466, Q: 2.6955, walltime: 0.30 min\n","category":"page"},{"location":"literated/singlelayerqg_betaforced/#Load-saved-output-and-visualize","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Load saved output and visualize","text":"","category":"section"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"We now have output from our simulation saved in singlelayerqg_forcedbeta.jld2 which we can load to create a time series for the fields we are interested in.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"file = jldopen(output.path)\n\niterations = parse.(Int, keys(file[\"snapshots/t\"]))\nt = [file[\"snapshots/t/$i\"] for i ∈ iterations]\n\nqh = [file[\"snapshots/qh/$i\"] for i ∈ iterations]\nu  = [file[\"snapshots/u/$i\"] for i ∈ iterations]\n\nE_t = file[\"diagnostics/energy/t\"]\nZ_t = file[\"diagnostics/enstrophy/t\"]\nE_data = file[\"diagnostics/energy/data\"]\nZ_data = file[\"diagnostics/enstrophy/data\"]\n\nx,  y  = file[\"grid/x\"],  file[\"grid/y\"]\nnx, ny = file[\"grid/nx\"], file[\"grid/ny\"]\nLx, Ly = file[\"grid/Lx\"], file[\"grid/Ly\"]\n\nclose(file)","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"We create a figure using Makie's Observables","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"n = Observable(1)\n\nqₙ = @lift irfft(qh[$n], nx)\nψₙ = @lift irfft(- Array(grid.invKrsq) .* qh[$n], nx)\nq̄ₙ = @lift real(ifft(qh[$n][1, :] / ny))\nūₙ = @lift vec(mean(u[$n], dims=1))\n\ntitle_q = @lift @sprintf(\"vorticity, μt = %.2f\", μ * t[$n])\n\nenergy    = Observable([Point2f(E_t[1], E_data[1])])\nenstrophy = Observable([Point2f(Z_t[1], Z_data[1])])\n\nfig = Figure(resolution=(1000, 600))\n\naxis_kwargs = (xlabel = \"x\",\n               ylabel = \"y\",\n               aspect = 1,\n               limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\naxq = Axis(fig[1, 1]; title = title_q, axis_kwargs...)\n\naxψ = Axis(fig[2, 1]; title = \"streamfunction ψ\", axis_kwargs...)\n\naxq̄ = Axis(fig[1, 2],\n           xlabel = \"zonal mean vorticity\",\n           ylabel = \"y\",\n           aspect = 1,\n           limits = ((-3, 3), (-Ly/2, Ly/2)))\n\naxū = Axis(fig[2, 2],\n           xlabel = \"zonal mean u\",\n           ylabel = \"y\",\n           aspect = 1,\n           limits = ((-0.5, 0.5), (-Ly/2, Ly/2)))\n\naxE = Axis(fig[1, 3],\n           xlabel = \"μ t\",\n           ylabel = \"energy\",\n           aspect = 1,\n           limits = ((-0.1, 4.1), (0, 0.055)))\n\naxZ = Axis(fig[2, 3],\n           xlabel = \"μ t\",\n           ylabel = \"enstrophy\",\n           aspect = 1,\n           limits = ((-0.1, 4.1), (0, 3.1)))\n\nheatmap!(axq, x, y, qₙ;\n         colormap = :balance, colorrange = (-8, 8))\n\nlevels = collect(-0.32:0.04:0.32)\n\ncontourf!(axψ, x, y, ψₙ;\n          levels, colormap = :viridis, colorrange = (-0.22, 0.22))\ncontour!(axψ, x, y, ψₙ;\n         levels, color = :black)\n\nlines!(axq̄, q̄ₙ, y; linewidth = 3)\nlines!(axq̄, 0y, y; linewidth = 1, linestyle=:dash)\n\nlines!(axū, ūₙ, y; linewidth = 3)\nlines!(axū, 0y, y; linewidth = 1, linestyle=:dash)\n\nlines!(axE, energy; linewidth = 3)\nlines!(axZ, enstrophy; linewidth = 3, color = :red)\n\nfig","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"We are now ready to animate all saved output.","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"frames = 1:length(t)\nrecord(fig, \"singlelayerqg_betaforced.mp4\", frames, framerate = 16) do i\n  n[] = i\n\n  energy[]    = push!(energy[],    Point2f(μ * E_t[i], E_data[i]))\n  enstrophy[] = push!(enstrophy[], Point2f(μ * Z_t[i], Z_data[i]))\nend","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"","category":"page"},{"location":"literated/singlelayerqg_betaforced/","page":"Forced-dissipative barotropic QG beta-plane turbulence","title":"Forced-dissipative barotropic QG beta-plane turbulence","text":"This page was generated using Literate.jl.","category":"page"},{"location":"gpu/#GPU","page":"GPU","title":"GPU","text":"","category":"section"},{"location":"gpu/","page":"GPU","title":"GPU","text":"GPU-functionality is enabled via FourierFlows.jl. For more information on how FourierFlows.jl handled with GPUs we urge you to the corresponding FourierFlows.jl documentation section .","category":"page"},{"location":"gpu/","page":"GPU","title":"GPU","text":"All GeophysicalFlows.jl modules can be run on GPU by providing GPU() as the device (dev)  argument in the problem constructors. For example,","category":"page"},{"location":"gpu/","page":"GPU","title":"GPU","text":"julia> GeophysicalFlows.TwoDNavierStokes.Problem(GPU())\nProblem\n  ├─────────── grid: grid (on GPU)\n  ├───── parameters: params\n  ├────── variables: vars\n  ├─── state vector: sol\n  ├─────── equation: eqn\n  ├────────── clock: clock\n  └──── timestepper: RK4TimeStepper","category":"page"},{"location":"gpu/#Selecting-GPU-device","page":"GPU","title":"Selecting GPU device","text":"","category":"section"},{"location":"gpu/","page":"GPU","title":"GPU","text":"FourierFlows.jl can only utilize a single GPU. If your machine has more than one GPU available,  then using functionality within CUDA.jl package enables you can choose the GPU device that  FourierFlows.jl should use. The user is referred to the CUDA.jl Documentation; in particular, CUDA.devices and CUDA.CuDevice.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"EditURL = \"../../../examples/surfaceqg_decaying.jl\"","category":"page"},{"location":"literated/surfaceqg_decaying/#surfaceqg_decaying_example","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"A simulation of decaying surface quasi-geostrophic turbulence. We reproduce here the initial value problem for an elliptical vortex as done by Held et al. (1995).","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"An example of decaying barotropic quasi-geostrophic turbulence over topography.","category":"page"},{"location":"literated/surfaceqg_decaying/#Install-dependencies","page":"Decaying Surface QG turbulence","title":"Install dependencies","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"using Pkg\npkg\"add GeophysicalFlows, CairoMakie\"","category":"page"},{"location":"literated/surfaceqg_decaying/#Let's-begin","page":"Decaying Surface QG turbulence","title":"Let's begin","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"using GeophysicalFlows, CairoMakie, Printf, Random\n\nusing Statistics: mean\nusing Random: seed!","category":"page"},{"location":"literated/surfaceqg_decaying/#Choosing-a-device:-CPU-or-GPU","page":"Decaying Surface QG turbulence","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/surfaceqg_decaying/#Numerical-parameters-and-time-stepping-parameters","page":"Decaying Surface QG turbulence","title":"Numerical parameters and time-stepping parameters","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"      n = 256                       # 2D resolution = n²\nstepper = \"FilteredETDRK4\"          # timestepper\n     dt = 0.03                      # timestep\n     tf = 60                        # length of time for simulation\n nsteps = Int(tf / dt)              # total number of time-steps\n nsubs  = round(Int, nsteps/100)    # number of time-steps for intermediate logging/plotting (nsteps must be multiple of nsubs)","category":"page"},{"location":"literated/surfaceqg_decaying/#Physical-parameters","page":"Decaying Surface QG turbulence","title":"Physical parameters","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":" L = 2π        # domain size\n ν = 1e-19     # hyper-viscosity coefficient\nnν = 4         # hyper-viscosity order","category":"page"},{"location":"literated/surfaceqg_decaying/#Problem-setup","page":"Decaying Surface QG turbulence","title":"Problem setup","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"We initialize a Problem by providing a set of keyword arguments. We use stepper = \"FilteredRK4\". Filtered timesteppers apply a wavenumber-filter at every time-step that removes enstrophy at high wavenumbers and, thereby, stabilize the problem, despite that we use the default viscosity coefficient ν=0.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"prob = SurfaceQG.Problem(dev; nx=n, Lx=L, dt, stepper, ν, nν)","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"Let's define some shortcuts.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"sol, clock, vars, params, grid = prob.sol, prob.clock, prob.vars, prob.params, prob.grid\nx,  y  = grid.x,  grid.y\nLx, Ly = grid.Lx, grid.Ly","category":"page"},{"location":"literated/surfaceqg_decaying/#Setting-initial-conditions","page":"Decaying Surface QG turbulence","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"We initialize the buoyancy equation with an elliptical vortex.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"X, Y = gridpoints(grid)\nb₀ = @. exp(-(X^2 + 4Y^2))\n\nSurfaceQG.set_b!(prob, b₀)","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"Let's plot the initial condition. Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when vars live on the GPU.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"fig = Figure(resolution = (500, 500))\n\nax = Axis(fig[1, 1],\n          xlabel = \"x\",\n          ylabel = \"y\",\n          aspect = 1,\n          title = \"buoyancy bₛ\",\n          limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\nhm = heatmap!(ax, x, y, Array(vars.b);\n              colormap = :deep, colorrange = (0, 1))\n\nColorbar(fig[1, 2], hm)\n\nfig","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"(Image: )","category":"page"},{"location":"literated/surfaceqg_decaying/#Diagnostics","page":"Decaying Surface QG turbulence","title":"Diagnostics","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"Create Diagnostics; buoyancy_variance, kinetic_energy and buoyancy_dissipation functions were imported at the top.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"B  = Diagnostic(SurfaceQG.buoyancy_variance, prob; nsteps)\nKE = Diagnostic(SurfaceQG.kinetic_energy, prob; nsteps)\nDᵇ = Diagnostic(SurfaceQG.buoyancy_dissipation, prob; nsteps)\ndiags = [B, KE, Dᵇ] # A list of Diagnostics types passed to `stepforward!`. Diagnostics are updated every timestep.","category":"page"},{"location":"literated/surfaceqg_decaying/#Output","page":"Decaying Surface QG turbulence","title":"Output","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"We choose folder for outputing .jld2 files and snapshots (.png files). Define base filename so saved data can be distinguished from other runs","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"base_filename = string(\"SurfaceQG_decaying_n_\", n)","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"\"SurfaceQG_decaying_n_256\"","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"We choose folder for outputing .jld2 files and snapshots (.png files).","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"datapath = \"./\"\nplotpath = \"./\"\n\ndataname = joinpath(datapath, base_filename)\nplotname = joinpath(plotpath, base_filename)","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"Do some basic file management,","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"if !isdir(plotpath); mkdir(plotpath); end\nif !isdir(datapath); mkdir(datapath); end","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"and then create Output.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"get_sol(prob) = prob.sol # extracts the Fourier-transformed solution\nget_u(prob) = irfft(im * prob.grid.l .* sqrt.(prob.grid.invKrsq) .* prob.sol, prob.grid.nx)\n\nout = Output(prob, dataname, (:sol, get_sol), (:u, get_u))","category":"page"},{"location":"literated/surfaceqg_decaying/#Visualizing-the-simulation","page":"Decaying Surface QG turbulence","title":"Visualizing the simulation","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"We define a function that plots the buoyancy field and the time evolution of kinetic energy and buoyancy variance.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"b = Observable(Array(vars.b))\n\nke = Observable([Point2f(KE.t[1], KE.data[1])])\nb² = Observable([Point2f(B.t[1], B.data[1])])\n\ntitle_b = Observable(\"buoyancy, t=\" * @sprintf(\"%.2f\", clock.t))\n\nfig = Figure(resolution = (900, 600))\n\naxb = Axis(fig[1:2, 1];\n           xlabel = \"x\",\n           ylabel = \"y\",\n           title = title_b,\n           aspect = 1,\n           limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\naxE = Axis(fig[1, 2];\n           xlabel = \"t\",\n           limits = ((0, tf), (0, 2e-2)))\n\nheatmap!(axb, x, y, b;\n         colormap = :deep, colorrange = (0, 1))\n\nhE  = lines!(axE, ke; linewidth = 3)\nhb² = lines!(axE, b²; linewidth = 3)\n\nLegend(fig[2, 2], [hE, hb²], [\"kinetic energy ∫½(uₛ²+vₛ²)dxdy/L²\", \"buoyancy variance ∫bₛ²dxdy/L²\"])\n\nfig","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"(Image: )","category":"page"},{"location":"literated/surfaceqg_decaying/#Time-stepping-the-Problem-forward-and-create-animation-by-updating-the-plot.","page":"Decaying Surface QG turbulence","title":"Time-stepping the Problem forward and create animation by updating the plot.","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"startwalltime = time()\n\nrecord(fig, \"sqg_ellipticalvortex.mp4\", 0:round(Int, nsteps/nsubs), framerate = 14) do j\n  if j % (500 / nsubs) == 0\n    cfl = clock.dt * maximum([maximum(vars.u) / grid.dx, maximum(vars.v) / grid.dy])\n\n    log1 = @sprintf(\"step: %04d, t: %.1f, cfl: %.3f, walltime: %.2f min\",\n          clock.step, clock.t, cfl, (time()-startwalltime)/60)\n\n    log2 = @sprintf(\"buoyancy variance: %.2e, buoyancy variance dissipation: %.2e\",\n              B.data[B.i], Dᵇ.data[Dᵇ.i])\n\n    println(log1)\n\n    println(log2)\n  end\n\n  b[] = vars.b\n\n  ke[] = push!(ke[], Point2f(KE.t[KE.i], KE.data[KE.i]))\n  b²[] = push!(b²[], Point2f(B.t[B.i], B.data[B.i]))\n\n  title_b[] = \"buoyancy, t=\" * @sprintf(\"%.2f\", clock.t)\n\n  stepforward!(prob, diags, nsubs)\n  SurfaceQG.updatevars!(prob)\nend","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"step: 0000, t: 0.0, cfl: 0.639, walltime: 0.00 min\nbuoyancy variance: 1.83e-02, buoyancy variance dissipation: 1.28e-16\nstep: 0500, t: 15.0, cfl: 0.588, walltime: 0.06 min\nbuoyancy variance: 1.83e-02, buoyancy variance dissipation: 4.07e-11\nstep: 1000, t: 30.0, cfl: 0.571, walltime: 0.10 min\nbuoyancy variance: 1.83e-02, buoyancy variance dissipation: 5.59e-09\nstep: 1500, t: 45.0, cfl: 0.577, walltime: 0.15 min\nbuoyancy variance: 1.83e-02, buoyancy variance dissipation: 1.01e-08\nstep: 2000, t: 60.0, cfl: 0.574, walltime: 0.20 min\nbuoyancy variance: 1.82e-02, buoyancy variance dissipation: 1.12e-08\n","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"(Image: )","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"Let's see how all flow fields look like at the end of the simulation.","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"fig = Figure(resolution = (800, 380))\n\naxis_kwargs = (xlabel = \"x\",\n               ylabel = \"y\",\n               aspect = 1,\n               limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\naxb = Axis(fig[1, 1]; title = \"bₛ(x, y, t=\" * @sprintf(\"%.2f\", clock.t) * \")\", axis_kwargs...)\naxu = Axis(fig[1, 2]; title = \"uₛ(x, y, t=\" * @sprintf(\"%.2f\", clock.t) * \")\", axis_kwargs...)\naxv = Axis(fig[1, 3]; title = \"vₛ(x, y, t=\" * @sprintf(\"%.2f\", clock.t) * \")\", axis_kwargs...)\n\nhb = heatmap!(axb, x, y, Array(vars.b);\n              colormap = :deep, colorrange = (0, 1))\n\nColorbar(fig[2, 1], hb, vertical = false)\n\nhu = heatmap!(axu, x, y, Array(vars.u);\n              colormap = :balance, colorrange = (-maximum(abs.(vars.u)), maximum(abs.(vars.u))))\n\nColorbar(fig[2, 2], hu, vertical = false)\n\nhv = heatmap!(axv, x, y, Array(vars.v);\n              colormap = :balance, colorrange = (-maximum(abs.(vars.v)), maximum(abs.(vars.v))))\n\nColorbar(fig[2, 3], hv, vertical = false)\n\nfig","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"(Image: )","category":"page"},{"location":"literated/surfaceqg_decaying/#Save","page":"Decaying Surface QG turbulence","title":"Save","text":"","category":"section"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"We can save the output at the end of the simulation by calling","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"saveoutput(out)","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"","category":"page"},{"location":"literated/surfaceqg_decaying/","page":"Decaying Surface QG turbulence","title":"Decaying Surface QG turbulence","text":"This page was generated using Literate.jl.","category":"page"},{"location":"#GeophysicalFlows.jl-Documentation","page":"Home","title":"GeophysicalFlows.jl Documentation","text":"","category":"section"},{"location":"#Overview","page":"Home","title":"Overview","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"GeophysicalFlows.jl is a collection of modules which leverage the  FourierFlows.jl framework to provide solvers for problems in Geophysical Fluid Dynamics, on periodic domains using Fourier-based pseudospectral methods.","category":"page"},{"location":"#Examples","page":"Home","title":"Examples","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Examples aim to demonstrate the main functionalities of each module. Have a look at our Examples collection!","category":"page"},{"location":"","page":"Home","title":"Home","text":"note: Fourier transforms normalization\nFourier-based pseudospectral methods rely on Fourier expansions. Throughout the  documentation we denote symbols with hat, e.g., hatu, to be the Fourier transform  of u like, e.g.,u(x) = sum_k_x hatu(k_x)  e^i k_x x The convention used in the modules is that the Fourier transform of a variable, e.g., u  is denoted with uh (where the trailing h is there to imply \"hat\"). Note, however,  that uh is obtained via a FFT of u and due to different normalization factors that the  FFT algorithm uses, uh is not exactly the same as hatu above. Instead,hatu(k_x) = frac𝚞𝚑n_x e^i k_x x_0 where n_x is the total number of grid points in x and x_0 is the left-most  point of our x-grid.Read more in the FourierFlows.jl Documentation; see  Grids section.","category":"page"},{"location":"","page":"Home","title":"Home","text":"info: Unicode\nOftentimes unicode symbols are used in modules for certain variables or parameters. For  example, ψ is commonly used to denote the  streamfunction of the flow, or ∂ is used  to denote partial differentiation. Unicode symbols can be entered in the Julia REPL by  typing, e.g., \\psi or \\partial followed by the tab key.Read more about Unicode symbols in the  Julia Documentation.","category":"page"},{"location":"#Developers","page":"Home","title":"Developers","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The development of GeophysicalFlows.jl started during the 21st AOFD Meeting 2017 by Navid C. Constantinou and Gregory L. Wagner. Since then various people have contributed, including Lia Siegelman, Brodie Pearson, André Palóczy (see the example in FourierFlows.jl), and others.","category":"page"},{"location":"#Citing","page":"Home","title":"Citing","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"If you use GeophysicalFlows.jl in research, teaching, or other activities, we would be grateful  if you could mention GeophysicalFlows.jl and cite our paper in JOSS:","category":"page"},{"location":"","page":"Home","title":"Home","text":"Constantinou et al., (2021). GeophysicalFlows.jl: Solvers for geophysical fluid dynamics problems in periodic domains on CPUs & GPUs. Journal of Open Source Software, 6(60), 3053, doi:10.21105/joss.03053.","category":"page"},{"location":"","page":"Home","title":"Home","text":"The bibtex entry for the paper is:","category":"page"},{"location":"","page":"Home","title":"Home","text":"@article{GeophysicalFlowsJOSS,\n  doi = {10.21105/joss.03053},\n  url = {https://doi.org/10.21105/joss.03053},\n  year = {2021},\n  publisher = {The Open Journal},\n  volume = {6},\n  number = {60},\n  pages = {3053},\n  author = {Navid C. Constantinou and Gregory LeClaire Wagner and Lia Siegelman and Brodie C. Pearson and André Palóczy},\n  title = {GeophysicalFlows.jl: Solvers for geophysical fluid dynamics problems in periodic domains on CPUs \\& GPUs},\n  journal = {Journal of Open Source Software}\n}","category":"page"},{"location":"#Papers-using-GeophysicalFlows.jl","page":"Home","title":"Papers using GeophysicalFlows.jl","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Drivas, T. D. and Elgindi, T. M. (2023). Singularity formation in the incompressible Euler equation in finite and infinite time. EMS Surv. Math. Sci., 10(1), 1–100, doi:10.4171/emss/66.\nParfenyev, V. (2023) Statistical analysis of vortex condensate motion in two-dimensional turbulence. arXiv preprint arXiv:2311.03065, doi:10.48550/arXiv.2311.03065.\nShokar, I. J. S., Kerswell, R. R., and Haynes, P. H. (2023) Stochastic latent transformer: Efficient modelling of stochastically forced zonal jets. arXiv preprint arXiv:2310.16741, doi:10.48550/arXiv.2310.16741.\nBischoff, T. and Deck, K. (2023) Unpaired downscaling of fluid flows with diffusion bridges. arXiv preprint arXiv:2305.01822, doi:10.48550/arXiv.2305.01822.\nSiegelman, L. and Young, W. R. (2023). Two-dimensional turbulence above topography: Vortices and potential vorticity homogenization. Proceedings of the National Academy of Sciences, 120(44), e2308018120, doi:10.1073/pnas.2308018120.\nBisits, J. I., Stanley G. J., and Zika, J. D. (2023). Can we accurately quantify a lateral diffusivity using a single tracer release? Journal of Physical Oceanography, 53(2), 647–659, doi:10.1175/JPO-D-22-0145.1.\nParfenyev, V. (2022) Profile of a two-dimensional vortex condensate beyond the universal limit. Phys. Rev. E, 106, 025102, doi:10.1103/PhysRevE.106.025102.\nSiegelman, L., Young, W. R., and Ingersoll, A. P. (2022). Polar vortex crystals: Emergence and structure Proceedings of the National Academy of Sciences, 119(17), e2120486119, doi:10.1073/pnas.2120486119.\nDolce, M. and Drivas, T. D. (2022). On maximally mixed equilibria of two-dimensional perfect fluids. Archive for Rational Mechanics and Analysis, 246, 735–770, doi:10.1007/s00205-022-01825-w.\nPalóczy, A. and LaCasce, J. H. (2022). Instability of a surface jet over rough topography. Journal of Physical Oceanography, 52(11), 2725-2740, doi:10.1175/JPO-D-22-0079.1.\nKarrasch, D. and Schilling, N. (2020). Fast and robust computation of coherent Lagrangian vortices on very large two-dimensional domains. The SMAI Journal of Computational Mathematics, 6, 101-124, doi:10.5802/smai-jcm.63.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"EditURL = \"../../../examples/singlelayerqg_decaying_topography.jl\"","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#singlelayerqg_decay_topography_example","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"An example of decaying barotropic quasi-geostrophic turbulence over topography.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Install-dependencies","page":"Decaying barotropic QG turbulence over topography","title":"Install dependencies","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"First let's make sure we have all required packages installed.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"using Pkg\npkg\"add GeophysicalFlows, CairoMakie\"","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Let's-begin","page":"Decaying barotropic QG turbulence over topography","title":"Let's begin","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"Let's load GeophysicalFlows.jl and some other packages we need.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"using GeophysicalFlows, CairoMakie, Printf, Random\n\nusing Statistics: mean","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Choosing-a-device:-CPU-or-GPU","page":"Decaying barotropic QG turbulence over topography","title":"Choosing a device: CPU or GPU","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"dev = CPU()     # Device (CPU/GPU)","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Numerical-parameters-and-time-stepping-parameters","page":"Decaying barotropic QG turbulence over topography","title":"Numerical parameters and time-stepping parameters","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"      n = 128            # 2D resolution = n²\nstepper = \"FilteredRK4\"  # timestepper\n     dt = 0.05           # timestep\n nsteps = 2000           # total number of time-steps\n nsubs  = 10             # number of time-steps for intermediate logging/plotting (nsteps must be multiple of nsubs)","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Physical-parameters","page":"Decaying barotropic QG turbulence over topography","title":"Physical parameters","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"L = 2π        # domain size","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"Define the topographic potential vorticity, eta = f_0 h(x y)H. The topography here is an elliptical mount at (x y) = (1 1), and an elliptical depression at (x y) = (-1 -1).","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"σx, σy = 0.4, 0.8\ntopographicPV(x, y) = 3exp(-(x - 1)^2 / 2σx^2 - (y - 1)^2 / 2σy^2) - 2exp(- (x + 1)^2 / 2σx^2 - (y + 1)^2 / 2σy^2)","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Problem-setup","page":"Decaying barotropic QG turbulence over topography","title":"Problem setup","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"We initialize a Problem by providing a set of keyword arguments. We use stepper = \"FilteredRK4\". Filtered timesteppers apply a wavenumber-filter at every time-step that removes enstrophy at high wavenumbers and, thereby, stabilize the problem, despite that we use the default viscosity coefficient ν=0. Thus, we choose not to do any dealiasing by providing aliased_fraction=0.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"The topophic PV is prescribed via keyword argument eta.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"prob = SingleLayerQG.Problem(dev; nx=n, Lx=L, eta=topographicPV,\n                             dt, stepper, aliased_fraction=0)","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"and define some shortcuts","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"sol, clock, vars, params, grid = prob.sol, prob.clock, prob.vars, prob.params, prob.grid\nx,  y  = grid.x,  grid.y\nLx, Ly = grid.Lx, grid.Ly","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"and let's plot the topographic PV. Note that when plotting, we decorate the variable to be plotted with Array() to make sure it is brought back on the CPU when the variable lives on the GPU.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"η = Array(params.eta)\n\nfig = Figure()\nax = Axis(fig[1, 1];\n          xlabel = \"x\",\n          ylabel = \"y\",\n          title = \"topographic PV η=f₀h/H\",\n          limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\ncontourf!(ax, x, y, η;\n          levels = collect(-3:0.4:3), colormap = :balance, colorrange = (-3, 3))\n\nfig","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Setting-initial-conditions","page":"Decaying barotropic QG turbulence over topography","title":"Setting initial conditions","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"Our initial condition consist of a flow that has power only at wavenumbers with 6  fracL2pi sqrtk_x^2 + k_y^2  12 and initial energy E_0. device_array() function returns the array type appropriate for the device, i.e., Array for dev = CPU() and CuArray for dev = GPU().","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"E₀ = 0.04 # energy of initial condition\n\nK = @. sqrt(grid.Krsq)                             # a 2D array with the total wavenumber\n\nRandom.seed!(1234)\nqih = device_array(dev)(randn(Complex{eltype(grid)}, size(sol)))\n@. qih = ifelse(K < 6  * 2π/L, 0, qih)\n@. qih = ifelse(K > 12 * 2π/L, 0, qih)\nqih *= sqrt(E₀ / SingleLayerQG.energy(qih, vars, params, grid))  # normalize qi to have energy E₀\nqi = irfft(qih, grid.nx)\n\nSingleLayerQG.set_q!(prob, qi)","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"Let's plot the initial vorticity and streamfunction.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"q = Observable(Array(vars.q))\nψ = Observable(Array(vars.ψ))\n\nfig = Figure(resolution=(800, 380))\n\naxis_kwargs = (xlabel = \"x\",\n               ylabel = \"y\",\n               aspect = 1,\n               limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))\n\ntitle_q = Observable(\"initial vorticity ∂v/∂x-∂u/∂y\")\naxq = Axis(fig[1, 1]; title = title_q, axis_kwargs...)\n\ntitle_ψ = Observable(\"initial streamfunction ψ\")\naxψ = Axis(fig[1, 3]; title = title_ψ, axis_kwargs...)\n\nhm = heatmap!(axq, x, y, q;\n              colormap = :balance, colorrange = (-8, 8))\n\nColorbar(fig[1, 2], hm)\n\nlevels = collect(range(-0.28, stop=0.28, length=11))\n\nhc = contourf!(axψ, x, y, ψ;\n               levels, colormap = :viridis, colorrange = (-0.28, 0.28),\n               extendlow = :auto, extendhigh = :auto)\ncontour!(axψ, x, y, ψ;\n         levels, color = :black)\n\nColorbar(fig[1, 4], hc)\n\nfig","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Diagnostics","page":"Decaying barotropic QG turbulence over topography","title":"Diagnostics","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"Create Diagnostics – energy and enstrophy functions are imported at the top.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"E = Diagnostic(SingleLayerQG.energy, prob; nsteps)\nZ = Diagnostic(SingleLayerQG.enstrophy, prob; nsteps)\ndiags = [E, Z] # A list of Diagnostics types passed to \"stepforward!\" will  be updated every timestep.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Output","page":"Decaying barotropic QG turbulence over topography","title":"Output","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"We choose folder for outputing .jld2 files.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"filepath = \".\"\nfilename = joinpath(filepath, \"decayingbetaturb.jld2\")","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"Do some basic file management,","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"if isfile(filename); rm(filename); end","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"and then create Output.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"get_sol(prob) = prob.sol # extracts the Fourier-transformed solution\nout = Output(prob, filename, (:sol, get_sol))","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Visualizing-the-simulation","page":"Decaying barotropic QG turbulence over topography","title":"Visualizing the simulation","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"We modify the figure with the initial state slightly by adding the topography contours and mark the time in the title.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"contour!(axq, x, y, η;\n         levels = collect(0.5:0.5:3), linewidth = 2, color = (:black, 0.5))\n\ncontour!(axq, x, y, η;\n         levels = collect(-2:0.5:-0.5), linewidth = 2, color = (:grey, 0.7), linestyle = :dash)\n\ntitle_q[] = \"vorticity, t=\" * @sprintf(\"%.2f\", clock.t)\ntitle_ψ[] = \"streamfunction ψ\"\n","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/#Time-stepping-the-Problem-forward","page":"Decaying barotropic QG turbulence over topography","title":"Time-stepping the Problem forward","text":"","category":"section"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"We step the Problem forward in time.","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"startwalltime = time()\n\nrecord(fig, \"singlelayerqg_decaying_topography.mp4\", 0:round(Int, nsteps/nsubs), framerate = 12) do j\n  if j % (1000 / nsubs) == 0\n    cfl = clock.dt * maximum([maximum(vars.u) / grid.dx, maximum(vars.v) / grid.dy])\n\n    log = @sprintf(\"step: %04d, t: %d, cfl: %.2f, E: %.4f, Q: %.4f, walltime: %.2f min\",\n      clock.step, clock.t, cfl, E.data[E.i], Z.data[Z.i], (time()-startwalltime)/60)\n\n    println(log)\n  end\n\n  q[] = vars.q\n  ψ[] = vars.ψ\n\n  title_q[] = \"vorticity, t=\"*@sprintf(\"%.2f\", clock.t)\n  title_ψ[] = \"streamfunction ψ\"\n\n  stepforward!(prob, diags, nsubs)\n  SingleLayerQG.updatevars!(prob)\nend","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"step: 0000, t: 0, cfl: 0.76, E: 0.0385, Q: 3.1410, walltime: 0.00 min\nstep: 1000, t: 50, cfl: 0.67, E: 0.0375, Q: 0.6276, walltime: 0.25 min\nstep: 2000, t: 100, cfl: 0.70, E: 0.0374, Q: 0.3566, walltime: 0.46 min\n","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"(Image: )","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"","category":"page"},{"location":"literated/singlelayerqg_decaying_topography/","page":"Decaying barotropic QG turbulence over topography","title":"Decaying barotropic QG turbulence over topography","text":"This page was generated using Literate.jl.","category":"page"},{"location":"assets/README/#a-placeholder-directory-for-output-generated-by-Docs","page":"-","title":"a placeholder directory for output generated by Docs","text":"","category":"section"}]
}
