<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MultiLayerQG Â· GeophysicalFlows.jl</title><meta name="title" content="MultiLayerQG Â· GeophysicalFlows.jl"/><meta property="og:title" content="MultiLayerQG Â· GeophysicalFlows.jl"/><meta property="twitter:title" content="MultiLayerQG Â· GeophysicalFlows.jl"/><meta name="description" content="Documentation for GeophysicalFlows.jl."/><meta property="og:description" content="Documentation for GeophysicalFlows.jl."/><meta property="twitter:description" content="Documentation for GeophysicalFlows.jl."/><meta property="og:url" content="https://fourierflows.github.io/GeophysicalFlowsDocumentation/stable/modules/multilayerqg/"/><meta property="twitter:url" content="https://fourierflows.github.io/GeophysicalFlowsDocumentation/stable/modules/multilayerqg/"/><link rel="canonical" href="https://fourierflows.github.io/GeophysicalFlowsDocumentation/stable/modules/multilayerqg/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GeophysicalFlows.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../../aliasing/">Aliasing</a></li><li><a class="tocitem" href="../../gpu/">GPU</a></li><li><a class="tocitem" href="../../visualize/">Visualize output</a></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">TwoDNavierStokes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../literated/twodnavierstokes_decaying/">2D decaying turbulence</a></li><li><a class="tocitem" href="../../literated/twodnavierstokes_stochasticforcing/">2D forced-dissipative turbulence</a></li><li><a class="tocitem" href="../../literated/twodnavierstokes_stochasticforcing_budgets/">2D forced-dissipative turbulence budgets</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">SingleLayerQG</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../literated/singlelayerqg_betadecay/">Decaying barotropic QG beta-plane turbulence</a></li><li><a class="tocitem" href="../../literated/singlelayerqg_betaforced/">Forced-dissipative barotropic QG beta-plane turbulence</a></li><li><a class="tocitem" href="../../literated/singlelayerqg_decaying_topography/">Decaying barotropic QG turbulence over topography</a></li><li><a class="tocitem" href="../../literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/">SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">BarotropicQGQL</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../literated/barotropicqgql_betaforced/">Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">MultiLayerQG</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../literated/multilayerqg_2layer/">Phillips model of Baroclinic Instability</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-5" type="checkbox"/><label class="tocitem" for="menuitem-6-5"><span class="docs-label">SurfaceQG</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../literated/surfaceqg_decaying/">Decaying Surface QG turbulence</a></li></ul></li></ul></li><li><span class="tocitem">Modules</span><ul><li><a class="tocitem" href="../twodnavierstokes/">TwoDNavierStokes</a></li><li><a class="tocitem" href="../singlelayerqg/">SingleLayerQG</a></li><li><a class="tocitem" href="../barotropicqgql/">BarotropicQGQL</a></li><li class="is-active"><a class="tocitem" href>MultiLayerQG</a><ul class="internal"><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li></ul></li><li><a class="tocitem" href="../surfaceqg/">SurfaceQG</a></li></ul></li><li><a class="tocitem" href="../../stochastic_forcing/">Stochastic forcing</a></li><li><a class="tocitem" href="../../contributing/">Contributor&#39;s guide</a></li><li><a class="tocitem" href="../../references/">References</a></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/types/">Private types</a></li><li><a class="tocitem" href="../../lib/functions/">Functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Modules</a></li><li class="is-active"><a href>MultiLayerQG</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>MultiLayerQG</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/FourierFlows/GeophysicalFlows.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/main/docs/src/modules/multilayerqg.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="MultiLayerQG"><a class="docs-heading-anchor" href="#MultiLayerQG">MultiLayerQG</a><a id="MultiLayerQG-1"></a><a class="docs-heading-anchor-permalink" href="#MultiLayerQG" title="Permalink"></a></h1><h3 id="Basic-Equations"><a class="docs-heading-anchor" href="#Basic-Equations">Basic Equations</a><a id="Basic-Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Equations" title="Permalink"></a></h3><p>This module solves the layered Boussinesq quasi-geostrophic equations on a beta plane of variable fluid  depth <span>$H - h(x, y)$</span>. The flow in each layer is obtained through a streamfunction <span>$\psi_j$</span> as  <span>$(u_j, v_j) = (-\partial_y \psi_j, \partial_x \psi_j)$</span>, <span>$j = 1, \dots, n$</span>, where <span>$n$</span>  is the number of fluid layers.</p><p>The QGPV in each layer is</p><p class="math-container">\[\mathrm{QGPV}_j = q_j + \underbrace{f_0 + \beta y}_{\textrm{planetary PV}} + \delta_{j, n} \underbrace{\frac{f_0 h}{H_n}}_{\textrm{topographic PV}}, \quad j = 1, \dots, n .\]</p><p>where <span>$q_j$</span> incorporates the relative vorticity in each layer <span>$\nabla^2 \psi_j$</span> and the  vortex stretching terms:</p><p class="math-container">\[\begin{aligned}
q_1 &amp;= \nabla^2 \psi_1 + F_{3/2, 1} (\psi_2 - \psi_1) ,\\
q_j &amp;= \nabla^2 \psi_j + F_{j-1/2, j} (\psi_{j-1} - \psi_j) + F_{j+1/2, j} (\psi_{j+1} - \psi_j) , \quad j = 2, \dots, n-1 ,\\
q_n &amp;= \nabla^2 \psi_n + F_{n-1/2, n} (\psi_{n-1} - \psi_n) .
\end{aligned}\]</p><p>with</p><p class="math-container">\[F_{j+1/2, k} = \frac{f_0^2}{g&#39;_{j+1/2} H_k} \quad \text{and} \quad
g&#39;_{j+1/2} = b_j - b_{j+1} ,\]</p><p>where</p><p class="math-container">\[b_{j} = - g \frac{\delta \rho_j}{\rho_0}\]</p><p>is the Boussinesq buoyancy in each layer, with <span>$\rho = \rho_0 + \delta \rho$</span> the total density, <span>$\rho_0$</span> a constant reference density, and <span>$|\delta \rho| \ll \rho_0$</span> the perturbation density.</p><p>In view of the relationships above, when we convert to Fourier space <span>$q$</span>&#39;s and <span>$\psi$</span>&#39;s are  related via the matrix equation</p><p class="math-container">\[\begin{pmatrix} \widehat{q}_{ğ¤, 1}\\\vdots\\\widehat{q}_{ğ¤, n} \end{pmatrix} =
\underbrace{\left(-|ğ¤|^2 \mathbb{1} + \mathbb{F} \right)}_{\equiv \mathbb{S}_{ğ¤}}
\begin{pmatrix} \widehat{\psi}_{ğ¤, 1}\\\vdots\\\widehat{\psi}_{ğ¤, n} \end{pmatrix}\]</p><p>where</p><p class="math-container">\[\mathbb{F} \equiv \begin{pmatrix}
 -F_{3/2, 1} &amp;              F_{3/2, 1}  &amp;   0   &amp;  \cdots    &amp; 0\\
  F_{3/2, 2} &amp; -(F_{3/2, 2}+F_{5/2, 2}) &amp; F_{5/2, 2} &amp;       &amp; \vdots\\
 0           &amp;                  \ddots  &amp;   \ddots   &amp; \ddots &amp; \\
 \vdots      &amp;                          &amp;            &amp;        &amp;  0 \\
 0           &amp;       \cdots             &amp;   0   &amp; F_{n-1/2, n} &amp; -F_{n-1/2, n}
\end{pmatrix} .\]</p><p>Including an imposed zonal flow <span>$U_j(y)$</span> in each layer, the equations of motion are:</p><p class="math-container">\[\partial_t q_j + \mathsf{J}(\psi_j, q_j ) + (U_j - \partial_y\psi_j) \partial_x Q_j +  U_j \partial_x q_j  + (\partial_y Q_j)(\partial_x \psi_j) = -\delta_{j, n} \mu \nabla^2 \psi_n - \nu (-1)^{n_\nu} \nabla^{2 n_\nu} q_j ,\]</p><p>with</p><p class="math-container">\[\begin{aligned}
\partial_y Q_j &amp;\equiv \beta - \partial_y^2 U_j - (1-\delta_{j,1}) F_{j-1/2, j} (U_{j-1} - U_j) - (1 - \delta_{j,n}) F_{j+1/2, j} (U_{j+1} - U_j) + \delta_{j,n} \partial_y \eta , \\
\partial_x Q_j &amp; \equiv \delta_{j, n} \partial_x \eta ,
\end{aligned}\]</p><p>the background PV gradient components in each layer and with <span>$\mathsf{J}(a, b) = (\partial_x a)(\partial_y b)-(\partial_y a)(\partial_x b)$</span> is the  two-dimensional Jacobian. On the right hand side, <span>$\mu$</span> is linear bottom drag, and <span>$\nu$</span> is hyperviscosity of order <span>$n_\nu$</span>. Plain old viscosity corresponds to <span>$n_\nu = 1$</span>.</p><h3 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h3><p>Matrices <span>$\mathbb{S}_{ğ¤}$</span> as well as <span>$\mathbb{S}^{-1}_{ğ¤}$</span> are included in <code>params</code> as  <code>params.S</code> and <code>params.Sâ»Â¹</code> respectively. Additionally, the background PV gradients  <span>$\partial_x Q$</span> and <span>$\partial_y Q$</span> are also included in the <code>params</code> as <code>params.Qx</code> and  <code>params.Qy</code>.</p><p>One can get the <span>$\widehat{\psi}_j$</span> from <span>$\widehat{q}_j$</span> via  <code>streamfunctionfrompv!(psih, qh, params, grid)</code>, while the inverse, i.e. obtain <span>$\widehat{q}_j$</span> from <span>$\widehat{\psi}_j$</span>, is done via  <code>pvfromstreamfunction!(qh, psih, params, grid)</code>.</p><p>The equations of motion are time-stepped forward in Fourier space:</p><p class="math-container">\[\partial_t \widehat{q}_j = - \widehat{\mathsf{J}(\psi_j, q_j)}  - \widehat{U_j \partial_x Q_j} - \widehat{U_j \partial_x q_j}
+ \widehat{(\partial_y \psi_j) \partial_x Q_j}  - \widehat{(\partial_x \psi_j)(\partial_y Q_j)} + \delta_{j, n} \mu |ğ¤|^{2} \widehat{\psi}_n - \nu |ğ¤|^{2n_\nu} \widehat{q}_j .\]</p><p>In doing so the Jacobian is computed in the conservative form: <span>$\mathsf{J}(f,g) = \partial_y [ (\partial_x f) g] - \partial_x[ (\partial_y f) g]$</span>.</p><p>The state variable <code>sol</code> consists of the Fourier transforms of <span>$q_j$</span> at each layer, i.e.,  <a href="../../lib/types/#GeophysicalFlows.MultiLayerQG.Vars"><code>qh</code></a>.</p><p>The linear operator is constructed in <code>Equation</code></p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="GeophysicalFlows.MultiLayerQG.Equation" href="#GeophysicalFlows.MultiLayerQG.Equation"><code>GeophysicalFlows.MultiLayerQG.Equation</code></a> â€” <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Equation(params, grid)</code></pre><p>Return the equation for a multi-layer quasi-geostrophic problem with <code>params</code> and <code>grid</code>. The linear opeartor <span>$L$</span> includes only (hyper)-viscosity and is computed via <code>hyperviscosity(params, grid)</code>.</p><p>The nonlinear term is computed via function <code>calcN!</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/6639f95d0f39facdb85cf13eed34835939df68ce/src/multilayerqg.jl#L363-L371">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="GeophysicalFlows.MultiLayerQG.hyperviscosity" href="#GeophysicalFlows.MultiLayerQG.hyperviscosity"><code>GeophysicalFlows.MultiLayerQG.hyperviscosity</code></a> â€” <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">hyperviscosity(params, grid)</code></pre><p>Return the linear operator <code>L</code> that corresponds to (hyper)-viscosity of order <span>$n_Î½$</span> with coefficient <span>$Î½$</span> for <span>$n$</span> fluid layers.</p><p class="math-container">\[L_j = - Î½ |ğ¤|^{2 n_Î½}, \ j = 1, ..., n .\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/6639f95d0f39facdb85cf13eed34835939df68ce/src/multilayerqg.jl#L328-L336">source</a></section></article><p>The nonlinear terms are computed via</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="GeophysicalFlows.MultiLayerQG.calcN!" href="#GeophysicalFlows.MultiLayerQG.calcN!"><code>GeophysicalFlows.MultiLayerQG.calcN!</code></a> â€” <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">calcN!(N, sol, t, clock, vars, params, grid)</code></pre><p>Compute the nonlinear term, that is the advection term, the bottom drag, and the forcing:</p><p class="math-container">\[N_j = - \widehat{ğ–©(Ïˆ_j, q_j)} - \widehat{U_j âˆ‚_x Q_j} - \widehat{U_j âˆ‚_x q_j}
 + \widehat{(âˆ‚_y Ïˆ_j)(âˆ‚_x Q_j)} - \widehat{(âˆ‚_x Ïˆ_j)(âˆ‚_y Q_j)} + Î´_{j, n} Î¼ |ğ¤|^2 ÏˆÌ‚_n + FÌ‚_j .\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/6639f95d0f39facdb85cf13eed34835939df68ce/src/multilayerqg.jl#L640-L649">source</a></section></article><p>which in turn calls <a href="../../lib/functions/#GeophysicalFlows.MultiLayerQG.calcN_advection!"><code>calcN_advection!</code></a>  and <a href="../../lib/functions/#GeophysicalFlows.MultiLayerQG.addforcing!"><code>addforcing!</code></a>.</p><div class="admonition is-success"><header class="admonition-header">Linearized MultiLayerQG dynamics</header><div class="admonition-body"><p>The <code>MultiLayerQG</code> module includes also a linearized version of the dynamics about a base flow <span>$U_j(y)$</span>, <span>$j = 1, \dots, n$</span>; see <a href="../../lib/functions/#GeophysicalFlows.MultiLayerQG.LinearEquation"><code>LinearEquation</code></a>,  <a href="../../lib/functions/#GeophysicalFlows.MultiLayerQG.calcNlinear!"><code>calcNlinear!</code></a>, and  <a href="../../lib/functions/#GeophysicalFlows.MultiLayerQG.calcN_linearadvection!"><code>calcN_linearadvection!</code></a>.</p></div></div><h3 id="Parameters-and-Variables"><a class="docs-heading-anchor" href="#Parameters-and-Variables">Parameters and Variables</a><a id="Parameters-and-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters-and-Variables" title="Permalink"></a></h3><p>All required parameters are included inside <a href="../../lib/types/#GeophysicalFlows.MultiLayerQG.Params"><code>Params</code></a> and all module variables are included inside <a href="../../lib/types/#GeophysicalFlows.MultiLayerQG.Vars"><code>Vars</code></a>.</p><p>For the decaying case (no forcing, <span>$F=0$</span>), <code>vars</code> can be constructed with <a href="../../lib/types/#GeophysicalFlows.MultiLayerQG.DecayingVars"><code>DecayingVars</code></a>.  For the forced case (<span>$F \ne 0$</span>) the <code>vars</code> struct is with <a href="../../lib/types/#GeophysicalFlows.MultiLayerQG.ForcedVars"><code>ForcedVars</code></a> or <a href="../../lib/types/#GeophysicalFlows.MultiLayerQG.StochasticForcedVars"><code>StochasticForcedVars</code></a>.</p><h3 id="Helper-functions"><a class="docs-heading-anchor" href="#Helper-functions">Helper functions</a><a id="Helper-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Helper-functions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="GeophysicalFlows.MultiLayerQG.set_q!" href="#GeophysicalFlows.MultiLayerQG.set_q!"><code>GeophysicalFlows.MultiLayerQG.set_q!</code></a> â€” <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_q!(sol, params, vars, grid, q)
set_q!(prob, q)</code></pre><p>Set the solution <code>prob.sol</code> as the transform of <code>q</code> and update variables.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/6639f95d0f39facdb85cf13eed34835939df68ce/src/multilayerqg.jl#L826-L831">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="GeophysicalFlows.MultiLayerQG.set_Ïˆ!" href="#GeophysicalFlows.MultiLayerQG.set_Ïˆ!"><code>GeophysicalFlows.MultiLayerQG.set_Ïˆ!</code></a> â€” <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_Ïˆ!(params, vars, grid, sol, Ïˆ)
set_Ïˆ!(prob, Ïˆ)</code></pre><p>Set the solution <code>prob.sol</code> to the transform <code>qh</code> that corresponds to streamfunction <code>Ïˆ</code> and update variables.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/6639f95d0f39facdb85cf13eed34835939df68ce/src/multilayerqg.jl#L854-L860">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="GeophysicalFlows.MultiLayerQG.updatevars!" href="#GeophysicalFlows.MultiLayerQG.updatevars!"><code>GeophysicalFlows.MultiLayerQG.updatevars!</code></a> â€” <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">updatevars!(vars, params, grid, sol)
updatevars!(prob)</code></pre><p>Update all problem variables using <code>sol</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/6639f95d0f39facdb85cf13eed34835939df68ce/src/multilayerqg.jl#L801-L806">source</a></section></article><h3 id="Diagnostics"><a class="docs-heading-anchor" href="#Diagnostics">Diagnostics</a><a id="Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics" title="Permalink"></a></h3><p>The eddy kinetic energy in each layer and the eddy potential energy that corresponds to each  fluid interface is computed via <code>energies</code>:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="GeophysicalFlows.MultiLayerQG.energies" href="#GeophysicalFlows.MultiLayerQG.energies"><code>GeophysicalFlows.MultiLayerQG.energies</code></a> â€” <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">energies(vars, params, grid, sol)
energies(prob)</code></pre><p>Return the kinetic energy of each fluid layer KE<span>$_1, ...,$</span> KE<span>$_{n}$</span>, and the potential energy of each fluid interface PE<span>$_{3/2}, ...,$</span> PE<span>$_{n-1/2}$</span>, where <span>$n$</span> is the number of layers in the fluid. (When <span>$n=1$</span>, only the kinetic energy is returned.)</p><p>The kinetic energy at the <span>$j$</span>-th fluid layer is</p><p class="math-container">\[ğ–ªğ–¤_j = \frac{H_j}{H} \int \frac1{2} |{\bf âˆ‡} Ïˆ_j|^2 \frac{ğ–½x ğ–½y}{L_x L_y} = \frac1{2} \frac{H_j}{H} \sum_{ğ¤} |ğ¤|Â² |ÏˆÌ‚_j|Â², \ j = 1, ..., n ,\]</p><p>while the potential energy that corresponds to the interface <span>$j+1/2$</span> (i.e., the interface between the <span>$j$</span>-th and <span>$(j+1)$</span>-th fluid layer) is</p><p class="math-container">\[ğ–¯ğ–¤_{j+1/2} = \int \frac1{2} \frac{fâ‚€^2}{g&#39;_{j+1/2} H} (Ïˆ_j - Ïˆ_{j+1})^2 \frac{ğ–½x ğ–½y}{L_x L_y} = \frac1{2} \frac{fâ‚€^2}{g&#39;_{j+1/2} H} \sum_{ğ¤} |ÏˆÌ‚_j - ÏˆÌ‚_{j+1}|Â², \ j = 1, ..., n-1 .\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/6639f95d0f39facdb85cf13eed34835939df68ce/src/multilayerqg.jl#L885-L905">source</a></section></article><p>The lateral eddy fluxes in each layer and the vertical fluxes across fluid interfaces are computed via <code>fluxes</code>:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="GeophysicalFlows.MultiLayerQG.fluxes" href="#GeophysicalFlows.MultiLayerQG.fluxes"><code>GeophysicalFlows.MultiLayerQG.fluxes</code></a> â€” <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fluxes(vars, params, grid, sol)
fluxes(prob)</code></pre><p>Return the lateral eddy fluxes within each fluid layer, lateralfluxes<span>$_1,...,$</span>lateralfluxes<span>$_n$</span> and also the vertical eddy fluxes at each fluid interface, verticalfluxes<span>$_{3/2},...,$</span>verticalfluxes<span>$_{n-1/2}$</span>, where <span>$n$</span> is the total number of layers in the fluid. (For a single fluid layer, i.e., when <span>$n=1$</span>, only the lateral fluxes are returned.)</p><p>The lateral eddy fluxes within the <span>$j$</span>-th fluid layer are</p><p class="math-container">\[\textrm{lateralfluxes}_j = \frac{H_j}{H} \int U_j v_j âˆ‚_y u_j
\frac{ğ–½x ğ–½y}{L_x L_y} , \  j = 1, ..., n ,\]</p><p>while the vertical eddy fluxes at the <span>$j+1/2$</span>-th fluid interface (i.e., interface between the <span>$j$</span>-th and <span>$(j+1)$</span>-th fluid layer) are</p><p class="math-container">\[\textrm{verticalfluxes}_{j+1/2} = \int \frac{fâ‚€Â²}{g&#39;_{j+1/2} H} (U_j - U_{j+1}) \,
v_{j+1} Ïˆ_{j} \frac{ğ–½x ğ–½y}{L_x L_y} , \ j = 1, ..., n-1.\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/6639f95d0f39facdb85cf13eed34835939df68ce/src/multilayerqg.jl#L941-L964">source</a></section></article><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><ul><li><a href="../../literated/multilayerqg_2layer/#multilayerqg_2layer_example"><code>examples/multilayerqg_2layer.jl</code></a>: Simulate the growth and equilibration of baroclinic eddy turbulence in the Phillips 2-layer model.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../barotropicqgql/">Â« BarotropicQGQL</a><a class="docs-footer-nextpage" href="../surfaceqg/">SurfaceQG Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Saturday 8 February 2025 01:10">Saturday 8 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
