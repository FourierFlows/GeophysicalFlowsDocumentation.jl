<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stochastic forcing ¬∑ GeophysicalFlows.jl</title><meta name="title" content="Stochastic forcing ¬∑ GeophysicalFlows.jl"/><meta property="og:title" content="Stochastic forcing ¬∑ GeophysicalFlows.jl"/><meta property="twitter:title" content="Stochastic forcing ¬∑ GeophysicalFlows.jl"/><meta name="description" content="Documentation for GeophysicalFlows.jl."/><meta property="og:description" content="Documentation for GeophysicalFlows.jl."/><meta property="twitter:description" content="Documentation for GeophysicalFlows.jl."/><meta property="og:url" content="https://fourierflows.github.io/GeophysicalFlowsDocumentation/stable/stochastic_forcing/"/><meta property="twitter:url" content="https://fourierflows.github.io/GeophysicalFlowsDocumentation/stable/stochastic_forcing/"/><link rel="canonical" href="https://fourierflows.github.io/GeophysicalFlowsDocumentation/stable/stochastic_forcing/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">GeophysicalFlows.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../aliasing/">Aliasing</a></li><li><a class="tocitem" href="../gpu/">GPU</a></li><li><a class="tocitem" href="../visualize/">Visualize output</a></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">TwoDNavierStokes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../literated/twodnavierstokes_decaying/">2D decaying turbulence</a></li><li><a class="tocitem" href="../literated/twodnavierstokes_stochasticforcing/">2D forced-dissipative turbulence</a></li><li><a class="tocitem" href="../literated/twodnavierstokes_stochasticforcing_budgets/">2D forced-dissipative turbulence budgets</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">SingleLayerQG</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../literated/singlelayerqg_betadecay/">Decaying barotropic QG beta-plane turbulence</a></li><li><a class="tocitem" href="../literated/singlelayerqg_betaforced/">Forced-dissipative barotropic QG beta-plane turbulence</a></li><li><a class="tocitem" href="../literated/singlelayerqg_decaying_topography/">Decaying barotropic QG turbulence over topography</a></li><li><a class="tocitem" href="../literated/singlelayerqg_decaying_barotropic_equivalentbarotropic/">SingleLayerQG decaying 2D turbulence with and without finite Rossby radius of deformation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">BarotropicQGQL</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../literated/barotropicqgql_betaforced/">Quasi-Linear forced-dissipative barotropic QG beta-plane turbulence</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">MultiLayerQG</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../literated/multilayerqg_2layer/">Phillips model of Baroclinic Instability</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-5" type="checkbox"/><label class="tocitem" for="menuitem-6-5"><span class="docs-label">SurfaceQG</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../literated/surfaceqg_decaying/">Decaying Surface QG turbulence</a></li></ul></li></ul></li><li><span class="tocitem">Modules</span><ul><li><a class="tocitem" href="../modules/twodnavierstokes/">TwoDNavierStokes</a></li><li><a class="tocitem" href="../modules/singlelayerqg/">SingleLayerQG</a></li><li><a class="tocitem" href="../modules/barotropicqgql/">BarotropicQGQL</a></li><li><a class="tocitem" href="../modules/multilayerqg/">MultiLayerQG</a></li><li><a class="tocitem" href="../modules/surfaceqg/">SurfaceQG</a></li></ul></li><li class="is-active"><a class="tocitem" href>Stochastic forcing</a><ul class="internal"><li><a class="tocitem" href="#Stochastic-Differential-Equations-(SDEs)"><span>Stochastic Differential Equations (SDEs)</span></a></li><li><a class="tocitem" href="#A-simple-Stochastic-Differential-Equation:-the-Ornstein‚ÄìUhlenbeck-process"><span>A simple Stochastic Differential Equation: the Ornstein‚ÄìUhlenbeck process</span></a></li><li><a class="tocitem" href="#A-simple-Stochastic-Partial-Differential-Equation-(SPDE)"><span>A simple Stochastic Partial Differential Equation (SPDE)</span></a></li><li><a class="tocitem" href="#A-bit-more-elaborate-SPDE"><span>A bit more elaborate SPDE</span></a></li></ul></li><li><a class="tocitem" href="../contributing/">Contributor&#39;s guide</a></li><li><a class="tocitem" href="../references/">References</a></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../lib/types/">Private types</a></li><li><a class="tocitem" href="../lib/functions/">Functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Stochastic forcing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stochastic forcing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/FourierFlows/GeophysicalFlows.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/FourierFlows/GeophysicalFlows.jl/blob/main/docs/src/stochastic_forcing.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Stochastic-Forcing"><a class="docs-heading-anchor" href="#Stochastic-Forcing">Stochastic Forcing</a><a id="Stochastic-Forcing-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-Forcing" title="Permalink"></a></h1><p>Forcing terms are implemented in various modules. Forcing can be either deterministic or  stochastic (random). For deterministic forcing the implementation is straightforward; for  stochastic forcing there are two main train of thoughts: It√¥ calculus and Stratonovich calculus.</p><p>Both stochastic calculi give the same results. But once we decide to use one of the two calculi  we have to remain consistent and use that calculus throughout. There can be a lot of confusion  and oftentimes confusion stems from mixing the two different stochastic calculi in a single  computation instead of using one of the two consistently all along.</p><div class="admonition is-info"><header class="admonition-header">It√¥ or Stratonovich in GeophysicalFlows.jl?</header><div class="admonition-body"><p>All modules included in GeophysicalFlows.jl use <strong>Stratonovich calculus</strong>.</p></div></div><p>The choice of Stratonovich calculus for GeophysicalFlows.jl was made since this calculus &quot;works  the same&quot; with both stochastic and deterministic forcing, i.e., with Stratonovich calculus we have the same chain rules for differentiation for stochastic functions as the chain rules we  learn in normal-deterministic calculus). Therefore, with the Stratonovich calculus the code  does not really &quot;care&quot; whether the user implement deterministic or stochastic forcing.</p><p>If you are interested in learning more regarding the two stochastic calculi and how they are  numerically implemented then read on; otherwise you can skip this section of the documentation.</p><h2 id="Stochastic-Differential-Equations-(SDEs)"><a class="docs-heading-anchor" href="#Stochastic-Differential-Equations-(SDEs)">Stochastic Differential Equations (SDEs)</a><a id="Stochastic-Differential-Equations-(SDEs)-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-Differential-Equations-(SDEs)" title="Permalink"></a></h2><p>A differential equation:</p><p class="math-container">\[	\frac{\mathrm{d} x}{\mathrm{d} t} = f(x) , \quad x(t_0) = 0,\]</p><p>can also be equivalently written in an integral form:</p><p class="math-container">\[	x(t) = \int_{t_0}^t f(x(s)) \, \mathrm{d} s.\]</p><p>In a similar manner, a stochastic differential equation (SDE),</p><p class="math-container">\[	\mathrm{d} x = f(x) \, \mathrm{d} t + g(x) \, \mathrm{d} W_t , \quad x(t_0) = 0 ,\]</p><p>with <span>$W_t$</span> a Brownian motion or Wiener process, can be written in an integral form as:</p><p class="math-container">\[	x(t) = \int_{t_0}^{t} f(x(s)) \, \mathrm{d} s + \int_{t_0}^{t} g(x(s)) \, \mathrm{d} W_s .\]</p><div class="admonition is-success"><header class="admonition-header">Wiener process</header><div class="admonition-body"><p>A Wiener process is a random variable <span>$W_t$</span> that depends continuously on <span>$t \ge 0$</span> and satisfies the following properties:</p><ol><li>Independence. For <span>$0 \le s \le t$</span> the increment <span>$W_t - W_s$</span> is independent of any prior values, i.e., independent of all <span>$W_\tau$</span>, <span>$\tau \le s$</span>.</li><li>Stationarity. The statistical distribution of the increment <span>$W_{t+s} ‚àí W_s$</span> does not depend on  <span>$s$</span> (and so is identical in distribution to <span>$W_t$</span>).</li><li>Gaussianity. <span>$W_t$</span> is a Gaussian process with mean <span>$\langle W_t \rangle = 0$</span> and covariance <span>$\langle W_t W_s \rangle = \min(t, s)$</span>.</li></ol></div></div><div class="admonition is-success"><header class="admonition-header">Notation</header><div class="admonition-body"><p>It&#39;s common to use notation <span>$x_t$</span> to denote explicit <span>$t$</span>-dependence of variable <span>$x$</span>. Not to be confused with the other common usage of subscripts for denoting partial differentiation.</p></div></div><p>The last integral in the integral representation of a SDE expression above is a stochastic integral  (it involves a stochastic differential, <span>$\mathrm{d} W_t$</span>). There is not a single straight-forward  way for computing the value of a stochastic integral. The various ways we can approximate the  value of a stochastic integral as a Riemannian sum each lead to a different answer. The two most  popular ways for computing such stochastic integrals are:</p><p class="math-container">\[\begin{aligned}
{\color{Green} \text{It√¥}} &amp;: {\color{Green}\int_{t_0}^{t} g(x(s)) \, \mathrm{d} W_s \approx \sum_{j} g \left ( x(t_j) \right )(W_{j+1} - W_j)} , \\
{\color{Magenta} \text{Stratonovich}} &amp;: {\color{Magenta} \int_{t_0}^{t} g(x(s)) \, \mathrm{d} W_s \approx \sum_{j} g \left (x \left (\tfrac{1}{2}(t_j + t_{j+1}) \right ) \right)(W_{j+1} - W_j)} .
\end{aligned}\]</p><p>The difference in the two calculi above lies in the point at which we choose to evaluate <span>$g(x)$</span>: we take the start of the time-interval for <span>${\color{Green} \text{It√¥, } t_j}$</span>, while we use the mid-point for <span>${\color{Magenta}\text{Stratonovich, } \tfrac{1}{2}(t_j+t_{j+1})}$</span>. In the case the  stochastic noise is additive, i.e., its prefactor <span>$g$</span> does not depend on the state <span>$x_t$</span>, then the two interpretations coincide. When the noise does depend on the state of the system,  i.e., <span>$g=g(x(t))$</span>, then the two interpretations above give thoroughly different results. This happens because the white noise process is not continuous and, therefore, the two interpretations of the stochastic integrals above do not converge to the same result.</p><p>To overcome this apparent inconsistency, the two choices above come together with different  chain rules, i.e., chain rules that are not necessarily the same as those in plain old calculus. Let us see how different choices for computing the stochastic integrals bring about the need  for different chain rules.</p><p>An SDE can be written also in differential form. Because we cannot formally form the derivative <span>$\mathrm{d} W / \mathrm{d} t$</span>, since <span>$W$</span> is nowhere differentiable, we write an SDE in  differential form as:</p><p class="math-container">\[\begin{aligned}
{\color{Green}\text{It√¥}} &amp;: {\color{Green}\mathrm{d} x_t = f(x_t) \mathrm{d} t + g(x_t) \mathrm{d} W_t} , \\
{\color{Magenta}\text{Stratonovich}} &amp;: {\color{Magenta}\mathrm{d} x_t = f(x_t) \mathrm{d} t + g(x_t) \circ \mathrm{d} W_t} .
\end{aligned}\]</p><p>The circle in the term <span>${\color{Magenta}g(x_t) \circ \mathrm{d} W_t}$</span> is used to differentiate  between It√¥ and Stratonovich calculus.</p><p>Let&#39;s now assume we perform a variable change <span>$y = G(x)$</span>. It turns out that according to  which interpretation of the stochastic integral one chooses to use, then the following chain  rule must be used:</p><p class="math-container">\[\begin{aligned}
{\color{Green}\text{It√¥}} &amp;: {\color{Green}\mathrm{d} y_t = \frac{\mathrm{d} G}{\mathrm{d} x} \mathrm{d} x_t + \frac{1}{2} g(x_t)^2 \frac{\mathrm{d}^2 G}{\mathrm{d} x^2} \mathrm{d} t = \left[ \frac{\mathrm{d} G}{\mathrm{d} x} f(x_t) + \frac{1}{2} g(x_t)^2 \frac{\mathrm{d}^2 G}{\mathrm{d} x^2} \right] \mathrm{d} t + \frac{\mathrm{d} G}{\mathrm{d} x} g(x_t) \mathrm{d} W_t} , \\
{\color{Magenta}\text{Stratonovich}} &amp;: {\color{Magenta}\mathrm{d} y_t  = \frac{\mathrm{d} G}{\mathrm{d} x} \mathrm{d} x_t = \frac{\mathrm{d} G}{\mathrm{d} x} f(x_t) \mathrm{d} t + \frac{\mathrm{d} G}{\mathrm{d} x} g(x_t) \circ \mathrm{d} W_t} .
\end{aligned}\]</p><p>The above are the so-called <em>stochastic chain rules</em>. All derivatives of <span>$G$</span> are evaluated  at <span>$x_t$</span>. For Stratonovich calculus, the chain rule resembles the usual chain rule one learns in calculus; for ItoÃÇ there exists an additional term, often referred to as the &quot;drift-term&quot;:  <span>${\color{Green}\tfrac{1}{2} g^2 \, \mathrm{d}^2G / \mathrm{d} x^2}$</span>.</p><p>It&#39;s easy to see that the extra drift-term in It√¥&#39;s interpretation of the stochastic integral,  is <em>exactly</em> equal to the ensemble mean  over forcing realizations of the Stratonovich  stochastic integral. That&#39;s because the It√¥ stochastic integral has, by construction, zero  ensemble mean since at every instant the noise is multiplied with <span>$g$</span> which is  evaluated  at a time instance before the action of the noise; <span>$g$</span> and <span>$\mathrm{d} W$</span> are uncorrelated  and thus:</p><p class="math-container">\[{\color{Green} \left \langle g(x_t) \mathrm{d} W_t \right \rangle = 0} \quad \text{while} \quad {\color{Magenta} \left \langle g(x_t) \circ \mathrm{d} W_t \right \rangle \ne 0} .\]</p><p>The above is demonstrated by evaluating the simple stochastic integral:</p><p class="math-container">\[\begin{aligned}
{\color{Green} \text{It√¥}} &amp;: {\color{Green} \left \langle \int_{t_0}^{t} W_s \, \mathrm{d} W_s \right \rangle \approx \sum_{j} \left \langle W_j (W_{j+1} - W_j) \right \rangle} \\
&amp; \hspace{7.3em} {\color{Green} = \sum_j \left \langle W_j W_{j+1} \right \rangle - \left \langle W_j W_j \right \rangle \sim \sum_{j} t_j - t_j = 0} , \\
{\color{Magenta}\text{Stratonovich}} &amp;: {\color{Magenta}\left \langle \int_{t_0}^{t} W_s \circ \mathrm{d} W_s \right \rangle \approx \sum_j \left \langle \frac1{2}(W_j + W_{j+1}) (W_{j+1} - W_j)\right \rangle} \\
&amp; \hspace{7.3em} {\color{Magenta} = \frac1{2} \sum_j \left \langle W_{j+1} W_{j+1} \right \rangle - \left \langle W_j W_j \right \rangle  \sim \frac1{2} \sum_j t_{j+1} - t_j = \frac{t}{2}} .
\end{aligned}\]</p><p>SDEs rarely can be solved in closed form; most often numerical solution of SDEs is brought to  the rescue. It√¥ calculus has the advantage that is very easily implemented numerically. On  the other hand, the chain rule in Stratonovich calculus coincides with that in normal calculus.  This stems from the fact that in the Stratonovich interpretation the white noise process is as  a series of colored noise processes with the de-correlation time tending to zero. This made  Stratonovich calculus more popular in the physics community. A nice discussion on the differences  and similarities between the two calculi is given by <a href="../references/#vanKampen-1981">Van Kampen (1981)</a>.</p><h2 id="A-simple-Stochastic-Differential-Equation:-the-Ornstein‚ÄìUhlenbeck-process"><a class="docs-heading-anchor" href="#A-simple-Stochastic-Differential-Equation:-the-Ornstein‚ÄìUhlenbeck-process">A simple Stochastic Differential Equation: the Ornstein‚ÄìUhlenbeck process</a><a id="A-simple-Stochastic-Differential-Equation:-the-Ornstein‚ÄìUhlenbeck-process-1"></a><a class="docs-heading-anchor-permalink" href="#A-simple-Stochastic-Differential-Equation:-the-Ornstein‚ÄìUhlenbeck-process" title="Permalink"></a></h2><p>One of the simplest SDEs is the Ornstein‚ÄìUhlenbeck process, a variation of which is:</p><p class="math-container">\[x(t) = - \int_{t_0}^{t} \mu x(s) \, \mathrm{d} s + \int_{t_0}^{t} \sqrt{\sigma} \, \mathrm{d} W_s . \tag{1}\]</p><p>Note that in differential form (1) is written as:</p><p class="math-container">\[\mathrm{d} x_t = - \mu x_t \, \mathrm{d} t + \sqrt{\sigma} \, \mathrm{d} W_t . \tag{2}\]</p><p>Luckily, for (2) we don&#39;t need to distinguish between It√¥ and Stratonovich, since <span>$g$</span> is  independent of <span>$x(t)$</span>. But note that often this is not the case; that <span>$g$</span> is independent  of <span>$x(t)$</span> is only a fortuitous coincident for this particular SDE.</p><p>How do we time-step SDE (2) numerically? Let us assume a discretization of time into time-steps of duration <span>$\tau$</span>, i.e., <span>$t_j = (j-1) \tau$</span>, <span>$j=1, 2, \dots$</span>. (What follows is easily  generalized to non-uniform time discretizations.) With that in mind, we denote <span>$x_j \equiv x(t_j)$</span>.  Then the Euler‚ÄìMayorama time-stepping scheme for (2) is</p><p class="math-container">\[	x_{j+1} = x_j + (-\mu x_j) \tau + \sqrt{\sigma} (W_{j+1} - W_j) .\]</p><p>Now let us ask the following question: How can we compute the work done by the noise? In other words, if we are interested in the evolution of the &quot;energy&quot;, defined as <span>$E \equiv \tfrac{1}{2} x^2$</span>, then how does the noise term attribute in the growth of <span>$E$</span>?  To answer that we first have to find the SDE that energy <span>$E$</span> obeys. But, in doing so, it  is important to adopt a single interpretation for computing stochastic integrals as now a  transformation of variables is needed. That is, depending on whether we choose to interpret  the stochastic integrals according to It√¥ or to Stratonovich calculus, <span>$E$</span> evolves according to:</p><p class="math-container">\[\hspace{3.35em} {\color{Green} \text{It√¥}} : {\color{Green} \mathrm{d} E_t = \left ( -2 \mu E_t + \tfrac{1}{2} \sigma \right ) \mathrm{d} t + x_t \sqrt{\sigma} \mathrm{d} W_t} , \tag{3}\]</p><p class="math-container">\[\hspace{-3.35em} {\color{Magenta} \text{Stratonovich}} : {\color{Magenta} \mathrm{d} E_t = -2 \mu E_t \mathrm{d} t + x_t \circ \sqrt{\sigma} \mathrm{d} W_t} . \tag{4}\]</p><p>The term <span>$-2 \mu E_t$</span> in both cases is the dissipation of energy by the <span>$\mu$</span> term; the  rest of the terms involve the noise. How do we compute the work <span>$P$</span> done by the noise?  Well, it follows that:</p><p class="math-container">\[\begin{aligned}
{\color{Green} \text{It√¥}} &amp;: {\color{Green} P_t = \tfrac{1}{2} \sigma \mathrm{d} t + \sqrt{\sigma} x_t \mathrm{d} W_t \approx \tfrac{1}{2} \sigma \, \mathrm{d}t + \sqrt{\sigma} x_j (W_{j+1} - W_j)} , \\
{\color{Magenta} \text{Stratonovich}} &amp;: {\color{Magenta} P_t =  x_t \circ \sqrt{\sigma} \mathrm{d} W_t \approx \sqrt{\sigma} x \left ( \tfrac{1}{2} (t_j + t_{j+1}) \right ) (W_{j+1} - W_j)} .
\end{aligned}\]</p><p>Now let&#39;s assume for a moment that we didn&#39;t know the rules for transforming Stratonovich to  It√¥ and we were wondering what is the extra drift term we have to include in the It√¥ formulations,  i.e., the <span>$\tfrac{1}{2} \sigma$</span> term. We can compute the It√¥&#39;s drift-term using the fact that  it is exactly equal to <span>$\langle x_t \circ \sqrt{\sigma} \mathrm{d} W_t \rangle$</span>; and for the  latter we can use the &quot;usual&quot; calculus. That is, we rewrite (1) as:</p><p class="math-container">\[\dot{x} = -\mu x + \xi , \tag{5}\]</p><p>where <span>$\xi(t)$</span> is understood to be the &quot;continuous&quot; version of the white-noise process (which  is formally only understood in terms of distributions). The forcing <span>$\xi$</span> has the properties:</p><p class="math-container">\[\left \langle \xi(t) \right \rangle = 0 \quad \text{and} \quad \left \langle \xi(t) \xi(t&#39;) \right \rangle = \sigma \delta(t - t&#39;) .\]</p><p>Thus we need to compute <span>$\langle P_t \rangle = \langle x(t) \xi(t) \rangle$</span>. But (5) formally has the solution:</p><p class="math-container">\[x(t) = e^{-\mu t} x(0) + \int_0^t e^{-\mu (t - s)} \xi(s) \, \mathrm{d} s .\]</p><p>and using this solution we get</p><p class="math-container">\[\langle P_t \rangle = \langle x(t) \xi(t) \rangle =  e^{-\mu t} \underbrace{\langle x(0) \xi(t) \rangle}_{=0} + \int_0^t e^{-\mu (t - s)} \langle \xi(t) \xi(s) \rangle \, \mathrm{d} s = \sigma \int_0^t e^{- \mu (t - s)} \delta(t - s) \, \mathrm{d} s = \frac{\sigma}{2} .\]</p><p>Above we used that <span>$\int_0^t \delta(t - s) \mathrm{d} s = \tfrac{1}{2}$</span>, which is consistent  with the Stratonovich symmetric interpretation of stochastic integrals.</p><h3 id="Numerical-implementation"><a class="docs-heading-anchor" href="#Numerical-implementation">Numerical implementation</a><a id="Numerical-implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-implementation" title="Permalink"></a></h3><p>How do we time-step the equation for <span>$E$</span>? In the case of ItoÃÇ&#39;s interpretation, (3), we use  the Euler‚ÄìMaruyama time-stepping scheme:</p><p class="math-container">\[	E_{j+1} = E_j + \left ( -2 \mu E_j + \frac{\sigma}{2} \right ) \tau + \sqrt{\sigma} x_j (W_{j+1} - W_j).\]</p><p>However, we cannot use Euler‚ÄìMaruyama for time-stepping the corresponding Stratonovich  version of (4), since the Euler‚ÄìMaruyama scheme involves &quot;It√¥&quot;-thinking. To time-step (4) we  have to approximate <span>$g$</span> in the middle of the time-step. There are many ways to do that, one  of which is the, so called, Euler‚ÄìHeun method:</p><p class="math-container">\[\begin{aligned}
\widetilde{E}_{j+1} &amp;= E_j + (- 2\mu E_j) \tau + \sqrt{\sigma} x_j (W_{j+1} - W_j), \\
E_{j+1} &amp;= E_j + \left( -2 \mu \frac{E_j + \widetilde{E}_{j + 1}}{2} \right)\tau + \sqrt{\sigma}\frac{x_j + x_{j+1}}{2} (W_{j+1} - W_j) .
\end{aligned}\]</p><p>Let&#39;s apply not Euler‚ÄìMaruyama and Euler‚ÄìHeun schemes to time-step (3) and (4) respectively and compare the results with those obtained from time-stepping (2) and computing <span>$E$</span> a  posteriori. </p><p>Figure below compares the energy evolution as predicted by:</p><ul><li>direct computation from the <span>$x_t$</span> time-series: <span>$\tfrac{1}{2} x_t^2$</span>,</li><li>time-integration of (3) using Euler‚ÄìMaruyama, and</li><li>time-integration of (4) using Euler‚ÄìHeun.</li></ul><pre><code class="language-julia hljs">using CairoMakie
using Statistics: mean
using Random: randn, seed!
seed!(1234) # for reproducing the same plots

                Œº = 0.2
                œÉ = 0.2    # noise strength
               dt = 0.01   # timestep
           nsteps = 2001   # total timesteps
   n_realizations = 1000   # how many forcing realizations
some_realizations = 20     # used for plotting to illustrate convergence

t = 0:dt:(nsteps-1)*dt 	# time

ŒîW = randn(nsteps, n_realizations) * sqrt(dt) # noise

# Numerical calculation
x = zeros(size(ŒîW))
E_ito = zeros(size(ŒîW))
E_str = zeros(size(ŒîW))
E_numerical = zeros(size(ŒîW))

for j = 2:nsteps # time step the equations

  # time-step dx = - Œº x dt + ‚àöœÉ dW
  @. x[j, :] = x[j-1, :] - Œº * x[j-1, :] * dt + sqrt(œÉ) * ŒîW[j-1, :]

  # time-step dE = (- 2Œº E + ¬ΩœÉ) dt + ‚àöœÉ x dW
  @. E_ito[j, :] = E_ito[j-1, :] + (-2Œº * E_ito[j-1, :]
	                   + œÉ/2) * dt + sqrt(œÉ) * x[j-1, :] * ŒîW[j-1, :]

  # time-step dE = - 2Œº E dt + ‚àöœÉ x ‚àò dW
  xbar = @. x[j-1, :] - Œº * x[j-1, :] * dt + sqrt(œÉ) * ŒîW[j-1, :]
  Ebar = @. E_str[j-1, :] + (-2Œº * E_str[j-1, :]) * dt + sqrt(œÉ) * x[j-1, :] * ŒîW[j-1, :]
  @. E_str[j, :] = E_str[j-1, :] + (-2Œº * (E_str[j-1, :]
		+ Ebar) / 2) * dt + sqrt(œÉ) * (x[j-1, :] + xbar) / 2 * ŒîW[j-1, :]
end

# direct computation of E from x
@. E_numerical = 0.5 * x^2

# compare the three E(t) solutions
fig = Figure()
ax = Axis(fig[1, 1];
          xlabel = &quot;Œº t&quot;,
          ylabel = &quot;E&quot;,
          title = &quot;comparison of E(t) for single realization&quot;)

hl1 = lines!(ax, Œº * t, E_numerical[:, 1];
             linewidth = 3, linestyle = :solid)
hl2 = lines!(ax, Œº * t, E_ito[:, 1];
             linewidth = 2, linestyle = :dash)
hl3 = lines!(ax, Œº * t, E_str[:, 1];
             linewidth = 1, linestyle = :dashdot)

Legend(fig[1, 2], [hl1, hl2, hl3], [&quot;¬Ω x‚Çú¬≤&quot;, &quot;E‚Çú (Ito)&quot;, &quot;E‚Çú (Stratonovich)&quot;])</code></pre><p><img src="../assets/energy_comparison.svg" alt="energy_comparison"/></p><p>Now we can further compute the &quot;energy&quot; budgets, i.e., the work done by the noise versus the energy loss by the <span>$Œº$</span> term, using It√¥ and Stratonovich formalisms. Figures below show  the ensemble mean energy budgets (using 1000 ensemble members) as computed using It√¥ and Stratonovich calculus. For the energy budget to close we have to be consistent: if we time-step  the  energy equation based on Stratonovich calculus then we must compute the work also according  to Stratonovich and vice versa.</p><pre><code class="language-julia hljs"># theoretical results for ‚ü®E‚ü© and d‚ü®E‚ü©/dt
   E_theory = @. œÉ/4Œº * (1 - exp(-2Œº * t))
dEdt_theory = @. œÉ/2  * exp(-2Œº * t)

# compute d‚ü®E‚ü©/dt numerically
dEdt_ito = mean(E_ito[2:nsteps, :] .- E_ito[1:nsteps-1, :], dims=2) / dt

# compute the work and dissipation
work_ito = mean(sqrt(œÉ) * ŒîW[1:nsteps-1, :] / dt .* x[1:nsteps-1, :] .+ œÉ/2, dims=2)
diss_ito = 2Œº * (mean(E_ito[1:nsteps-1, :], dims=2))

# Ensemble mean energy budgets from the It√¥ integration

fig = Figure()

ax1 = Axis(fig[1, 1];
           xlabel = &quot;Œº t&quot;,
           ylabel = &quot;E&quot;,
           title = &quot;Ito: ùñΩE‚Çú = (-2Œº E‚Çú + ¬ΩœÉ) ùñΩt + x‚Çú ‚àöœÉ ùñΩW‚Çú&quot;)

hl1 = lines!(ax1, Œº * t, E_theory;
             linewidth = 3)
hl2 = lines!(ax1, Œº * t, vec(mean(E_ito[:, 1:some_realizations], dims=2));
             linewidth = 2)
hl3 = lines!(ax1, Œº * t, vec(mean(E_ito, dims=2)),
             linewidth = 1)

Legend(fig[1, 2], [hl1, hl2, hl3],
                  [&quot;theoretical ‚ü®E‚ü©&quot;, &quot;‚ü®E‚ü© from $some_realizations ensemble members&quot;, &quot;‚ü®E‚ü© from $n_realizations ensemble members&quot;])

ax2 = Axis(fig[2, 1];
           xlabel = &quot;Œº t&quot;,
           ylabel = &quot;dE/dt&quot;)

hl1 = lines!(ax2, Œº * t[1:nsteps-1], vec(dEdt_ito);
             linewidth = 2, linestyle = :dash)
hl2 = lines!(ax2, Œº * t[1:nsteps-1], vec(work_ito .- diss_ito);
             linewidth = 1, linestyle = :dashdot)
hl3 = lines!(ax2, Œº * t[1:nsteps-1], dEdt_theory[1:nsteps-1];
             linewidth = 3, linestyle = :solid)

Legend(fig[2, 2], [hl1, hl2, hl3],
                  [&quot;numerical ùñΩ‚ü®E‚ü©/ùñΩt&quot;, &quot;‚ü®work - dissipation‚ü©&quot;, &quot;theoretical ùñΩ‚ü®E‚ü©/ùñΩt&quot;])</code></pre><p><img src="../assets/energy_budgets_Ito.svg" alt="energy_budgets_Ito"/></p><pre><code class="language-julia hljs"># compute d‚ü®E‚ü©/dt numerically
dEdt_str = mean(E_str[2:nsteps, :] .- E_str[1:nsteps-1, :], dims=2) / dt

# compute the work and dissipation
work_str = mean(sqrt(œÉ) * ŒîW[1:nsteps-1, :] / dt .* (x[1:nsteps-1, :] .+ x[2:nsteps, :])/2, dims=2)
diss_str = 2Œº * (mean(E_str[1:nsteps-1, :], dims=2))

fig = Figure()

ax1 = Axis(fig[1, 1];
           xlabel = &quot;Œº t&quot;,
           ylabel = &quot;E&quot;,
           title = &quot;Stratonovich: ùñΩE‚Çú = -2Œº E‚Çú ùñΩt + x‚Çú ‚àò ‚àöœÉ ùñΩW‚Çú&quot;)

hl1 = lines!(ax1, Œº * t, E_theory;
             linewidth = 3)
hl2 = lines!(ax1, Œº * t, vec(mean(E_str[:, 1:some_realizations], dims=2));
             linewidth = 2)
hl3 = lines!(ax1, Œº * t, vec(mean(E_str, dims=2)),
             linewidth = 1)

Legend(fig[1, 2], [hl1, hl2, hl3],
                  [&quot;theoretical ‚ü®E‚ü©&quot;, &quot;‚ü®E‚ü© from $some_realizations ensemble members&quot;, &quot;‚ü®E‚ü© from $n_realizations ensemble members&quot;])

ax2 = Axis(fig[2, 1];
           xlabel = &quot;Œº t&quot;,
           ylabel = &quot;dE/dt&quot;)

hl1 = lines!(ax2, Œº * t[1:nsteps-1], vec(dEdt_str);
             linewidth = 2, linestyle = :dash)
hl2 = lines!(ax2, Œº * t[1:nsteps-1], vec(work_str .- diss_str);
             linewidth = 1, linestyle = :dashdot)
hl3 = lines!(ax2, Œº * t[1:nsteps-1], dEdt_theory[1:nsteps-1];
             linewidth = 3, linestyle = :solid)

Legend(fig[2, 2], [hl1, hl2, hl3],
                  [&quot;numerical ùñΩ‚ü®E‚ü©/ùñΩt&quot;, &quot;‚ü®work - dissipation‚ü©&quot;, &quot;theoretical ùñΩ‚ü®E‚ü©/ùñΩt&quot;])</code></pre><p><img src="../assets/energy_budgets_Stratonovich.svg" alt="energy_budgets_Stratonovich"/></p><h2 id="A-simple-Stochastic-Partial-Differential-Equation-(SPDE)"><a class="docs-heading-anchor" href="#A-simple-Stochastic-Partial-Differential-Equation-(SPDE)">A simple Stochastic Partial Differential Equation (SPDE)</a><a id="A-simple-Stochastic-Partial-Differential-Equation-(SPDE)-1"></a><a class="docs-heading-anchor-permalink" href="#A-simple-Stochastic-Partial-Differential-Equation-(SPDE)" title="Permalink"></a></h2><p>We would like now to transfer all the knowledge we got from the previous sections to PDEs.  In particular we&#39;ll start by focussing on the simple SPDE:</p><p class="math-container">\[\partial_t \nabla^2 \psi(\bm{x}, t) =  - \mu \nabla^2 \psi(\bm{x}, t) + \xi(\bm{x}, t) , \tag{6}\]</p><p>with periodic boundary conditions in both <span>$x$</span> and <span>$y$</span>. SPDE (6) is also equivalently written as:</p><p class="math-container">\[\mathrm{d} \nabla^2 \psi_{t}(\bm{x}) = - \mu \nabla^2 \psi_{t} (\bm{x}) \mathrm{d} t + \sqrt{\sigma} \mathrm{d} W_{t} (\bm{x}) .\]</p><p>The form (6) is the continuous version, similar to (2). In this SPDE, since the forcing is  purely additive, i.e., it does not depend on the state of the system, both ItoÃÇ and Stratonovich  interpretations coincide.</p><p>The forcing <span>$\xi$</span> obeys:</p><p class="math-container">\[\langle \xi(\bm{x}, t) \rangle = 0 \quad \text{and} \quad \langle \xi(\bm{x}, t) \xi(\bm{x}&#39;, t&#39;) \rangle = Q(\bm{x} - \bm{x}&#39;) \delta(t - t&#39;) ,\]</p><p>that is, the forcing is white in time but spatially correlated; its spatial correlation is  prescribed by the function <span>$Q$</span> which is, necessarily, homogeneous in all its arguments (see discussion by <a href="../references/#Constantinou-2015-phd">Constantinou (2015)</a>; Appendix A).</p><p>Equation (6) above describes the vorticity evolution of a two-dimensional fluid <span>$\nabla^2 \psi$</span>  that is stochastically forced while dissipated by linear drag <span>$\mu$</span>. The energy of the  fluid is:</p><p class="math-container">\[E = \tfrac{1}{2} \overline{|\bm{\nabla} \psi|^2}^{x, y} = -\tfrac{1}{2} \overline{\psi \nabla^2 \psi}^{x, y} ,\]</p><p>where the overbar denotes average over <span>$x$</span> and <span>$y$</span> and an integration-by-parts was carried through in the last equality. To obtain the energy equation we multiply (6) with <span>$-\psi$</span> and  average over the whole domain. Thus, the work done by the forcing is given by:</p><p class="math-container">\[P = - \, \overline{\psi \, \xi}^{x, y} ,\]</p><p>but the above is a stochastic integral and it is meaningless without a rule for computing the stochastic integral.</p><p>Numerically, the work done by the forcing at the <span>$j$</span>-th timestep can be obtained  Stratonovich-wise via:</p><p class="math-container">\[\begin{aligned}
P_j = - \, \overline{\frac{\psi(\bm{x}, t_j) + \psi(\bm{x}, t_{j+1})}{2}  \xi(\bm{x}, t_{j+1}) }^{x,y} ,
\end{aligned}\]</p><p>or It√¥-wise as</p><p class="math-container">\[\begin{aligned}
P_j = -\, \overline{ \psi(\bm{x}, t_j) \xi(\bm{x}, t_{j+1}) }^{x,y} + \text{drift} .
\end{aligned}\]</p><p>But how much is the It√¥ drift term in this case? As in the previous section, the drift is  <em>precisely</em> the ensemble mean of the Stratonovich work, i.e.:</p><p class="math-container">\[\textrm{Ito drift}= - \overline{\langle \underbrace{\psi(\bm{x}, t) \circ  \xi(\bm{x}, t)}_{\textrm{Stratonovich}} \rangle}^{x, y} .\]</p><p>But again, the above can be computed using the &quot;formal&quot; solution of (6):</p><p class="math-container">\[\psi(\bm{x}, t) = e^{-\mu t} \psi(\bm{x}, 0) + \int_0^t e^{- \mu (t - s)} \nabla^{-2} \xi(\bm{x}, s) \, \mathrm{d} s ,\]</p><p>which implies</p><p class="math-container">\[\begin{aligned}
\text{drift} &amp; = -\overline{e^{- \mu t} \underbrace{\left \langle \psi(\bm{x}, 0) \xi(\bm{x}, t) \right \rangle}_{=0}}^{x, y} - \int_0^t e^{- \mu (t - s)} \overline{\nabla^{-2} \left \langle \xi(\bm{x}, s) \xi(\bm{x}, t) \right\rangle}^{x, y} \, \mathrm{d} s \\
&amp; = - \int_0^t e^{-\mu(t - s)} \overline{\underbrace{\left [ \nabla^{-2} Q (\bm{x}) \right ] \big|_{\bm{x}=0}}_{\text{independent of }x, y} \, \delta(t - s)}^{x,y} \, \mathrm{d} s \\
&amp; = - \frac1{2} \nabla^{-2} Q(\bm{x}) \big|_{\bm{x}=0} \\
&amp; = - \frac1{2} \left [ \nabla^{-2} \int \frac{\mathrm{d}^2 \bm{k}}{(2\pi)^2} \widehat{Q}(\bm{k}) \, e^{i \bm{k} \bm{\cdot} \bm{x}} \right ]_{\bm{x}=0} \\
&amp; = \int \frac{\mathrm{d}^2 \bm{k}}{(2\pi)^2} \frac{\widehat{Q}(\bm{k})}{2 |\bm{k}|^2} .
\end{aligned}\]</p><p>Thus, the drift, or in this case the mean energy input rate by the stochastic forcing, is  precisely determined from the spatial correlation of the forcing, <span>$Q$</span>. Let us denote the  drift as:</p><p class="math-container">\[\varepsilon \equiv \int \frac{\mathrm{d}^2 \bm{k}}{(2\pi)^2} \frac{\widehat{Q}(\bm{k})}{2 |\bm{k}|^2} . \tag{7}\]</p><p>Using the above, the work for a single forcing realization at the <span>$j$</span>-th timestep is numerically  computed as:</p><p class="math-container">\[{\color{Green} \text{It√¥}} : {\color{Green} P_j = -\overline{\psi(\bm{x}, t_j) \xi(\bm{x}, t_{j+1})}^{x, y} + \varepsilon} , \tag{8}\]</p><p class="math-container">\[{\color{Magenta} \text{Stratonovich}} : {\color{Magenta} P_j = -\overline{\frac{\psi(\bm{x}, t_j) + \psi(\bm{x}, t_{j+1})}{2} \xi(\bm{x}, t_{j+1})}^{x, y}} . \tag{9}\]</p><p>Remember, previously the work done by the stochastic forcing was:</p><p class="math-container">\[\mathrm{d} P_t = {\color{Green} \frac{\sigma}{2}\mathrm{d} t + \sqrt{\sigma} x_t \mathrm{d} W_t} = {\color{Magenta} \sqrt{\sigma} x_t \circ \mathrm{d} W_t} ,\]</p><p>and by sampling over various forcing realizations:</p><p class="math-container">\[\langle \mathrm{d} P_t \rangle = \frac{\sigma}{2} \mathrm{d} t = \langle \sqrt{\sigma} x_t \circ \mathrm{d} W_t \rangle .\]</p><p>All modules in GeophysicalFlows.jl use Stratonovich calculus. For example, the domain-averaged  energy injected per unit time by the forcing in the <code>TwoDNavierStokes</code> module is computed  using (9) via the <a href="../lib/functions/#GeophysicalFlows.TwoDNavierStokes.energy_work"><code>energy_work</code></a> function.</p><h2 id="A-bit-more-elaborate-SPDE"><a class="docs-heading-anchor" href="#A-bit-more-elaborate-SPDE">A bit more elaborate SPDE</a><a id="A-bit-more-elaborate-SPDE-1"></a><a class="docs-heading-anchor-permalink" href="#A-bit-more-elaborate-SPDE" title="Permalink"></a></h2><p>It turns out everything carries through if in our SPDE above for the 2D vorticity equation we  also include the nonlinear advection terms:</p><p class="math-container">\[\partial_t \nabla^2 \psi(\bm{x}, t) + \mathsf{J}(\psi, \nabla^2 \psi) = - \mu \nabla^2 \psi(\bm{x}, t) + \xi(\bm{x}, t) . \tag{10}\]</p><p>The nonlinearity does not alter the It√¥ drift; thus the ensemble mean energy input by the  stochastic forcing, remains the same. We can easily verify this from the &quot;formal&quot; solution  of (10):</p><p class="math-container">\[\psi(\bm{x}, t) = e^{- \mu t} \psi(\bm{x}, 0) + \int_0^t e^{- \mu (t - s)} \nabla^{-2} \xi(\bm{x}, s) \, \mathrm{d} s - \int_0^t \nabla^{-2} \mathsf{J} \left ( \psi(\bm{x}, s), \nabla^2 \psi(\bm{x}, s) \right ) \mathrm{d} s .\]</p><p>When multiplied with <span>$\xi(\bm{x}, t)$</span> the last term vanishes since its only non-zero  contribution comes from the point <span>$s = t$</span>, which is of measure zero (in the integrated sense). </p><p>A demonstration of how the energy budgets can be computed when we have stochastic forcing is  illustrated in an <a href="../literated/twodnavierstokes_stochasticforcing_budgets/#twodnavierstokes_stochasticforcing_budgets_example">example of the TwoDNavierStokes</a>  module.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../modules/surfaceqg/">¬´ SurfaceQG</a><a class="docs-footer-nextpage" href="../contributing/">Contributor&#39;s guide ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 29 January 2025 20:34">Wednesday 29 January 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
